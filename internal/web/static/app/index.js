import{o as h,c as x,a as e,u as Y,i as j,b as $,w as A,d as U,t as l,e as n,R as re,f as oe,g as J,h as q,n as P,r as w,F as G,j as Q,k as Ue,l as B,m as se,p as he,q as be,s as ce,v as xe,x as we,D as W,y as Fe,z as Me,A as je,B as Ve,C as Be,S as He,E as Xe,G as qe}from"./vendor.js";const We=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function u(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function c(a){if(a.ep)return;a.ep=!0;const i=u(a);fetch(a.href,i)}};We();var Z=(s,t)=>{const u=s.__vccOpts||s;for(const[c,a]of t)u[c]=a;return u};const Je={},Ke={width:"512",height:"512",version:"1.1",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},Ge=e("path",{d:"m114.6 507.3c13.82-0.8729 90.06-3.083 106.2-3.079h13.49l2.639-5.293c5.191-10.41 10.35-29.57 13.13-48.74 1.811-12.5 1.488-16.68-1.826-23.56-2.528-5.249-11.04-13.06-20.54-18.86-28.38-17.32-51.21-34.77-76.05-58.12-6.673-6.272-9.377-8.209-16.08-11.53-12.37-6.124-20.36-12.88-29.19-24.7-1.45-1.941-1.795-2.038-4.695-1.334-1.722 0.4182-7.18 0.8166-12.13 0.8854-19.6 0.2722-38.18-7.715-52.49-22.56-15.97-16.57-23.43-35.49-23.41-59.37 0.01786-16.86 3.547-29.88 11.93-44 9.617-16.19 27.39-30.13 43.89-34.41 2.517-0.653 4.748-1.36 4.958-1.571 0.2103-0.2107-0.05169-3.078-0.5816-6.371-1.41-8.759-0.556-21.84 1.997-30.61 7.023-24.1 24.96-41.95 48.52-48.31 11.42-3.082 29.45-2.167 40.42 2.049 0.919 0.3533 1.637-0.7202 2.994-4.474 6.21-17.18 18.79-33.75 33.11-43.62 35.65-24.56 80.99-19.9 111.3 11.44l5.539 5.719 5.025-1.229c2.764-0.6762 9.075-1.428 14.02-1.672 16.17-0.7944 31.64 3.865 45.31 13.64l5.1 3.647 12.55 0.1171c9.984 0.09312 13.77 0.4491 18.49 1.739 29.1 7.945 50.37 32.58 56 64.86 1.354 7.764 1.096 21.6-0.5502 29.5l-0.916 4.394 5.367 7.086c20.1 26.54 25.52 61.05 14.68 93.52-7.862 23.55-24.99 43.53-46.38 54.11-10.16 5.023-23.1 8.587-31.28 8.613-3.79 0.0118-4.555 0.333-8.217 3.446-6.958 5.916-20.59 13.71-28.3 16.17-1.722 0.551-4.011 1.599-5.087 2.328-1.076 0.7297-8.119 4.802-15.65 9.05-18.57 10.47-37.53 22.69-48.72 31.39-13.27 10.32-16.83 22.63-14.72 50.94 2.648 35.64 8.059 59.41 16.33 71.75l2.89 4.313 29.4 0.4963c34.14 0.5764 92.53 2.291 93.01 2.731 0.1793 0.166-74.3 0.2503-165.5 0.1877-91.21-0.0631-161.4-0.392-156-0.732zm130.9-101.8c-0.1092-1.007-3.147-5.947-6.75-10.98-7.889-11.01-19.71-28.99-22.37-34.01-1.594-3.014-2.402-3.727-4.695-4.139-7.259-1.304-17.91-5.324-27.58-10.41-1.809-0.9509 5.669 20.15 9.032 25.49 4.859 7.714 27.69 24.94 45.08 34 5.177 2.7 7.575 2.715 7.285 0.0442zm6.168-19.46c0.8235-0.9976 1.074-4.638 1.074-15.62 0-7.875-0.1764-14.5-0.3923-14.71-0.2158-0.2163-2.307 0.1044-4.647 0.7128-2.34 0.6082-7 1.335-10.35 1.616-7.067 0.5907-6.896 0-2.984 10.28 2.73 7.17 6.328 12.81 10.4 16.3 3.513 3.013 5.293 3.38 6.908 1.424zm49.91-15.13c3.913-2 11.37-9.412 15.96-15.85 3.982-5.592 8.688-15 8.214-16.42-0.1628-0.49-3.275-1.75-6.916-2.799-3.641-1.049-9.568-3.501-13.17-5.449l-6.551-3.541-2.173 2.087c-2.148 2.062-2.179 2.234-2.645 14.37-0.2592 6.754-0.6282 15.17-0.8198 18.7-0.3026 5.572-0.1405 6.682 1.232 8.43 1.896 2.415 2.946 2.489 6.867 0.484zm-118.1-5.725c-2.19-4.729-6.256-17.66-6.256-19.89 0-0.8683-1.901-1.089-9.391-1.089-5.165 0-9.391 0.2195-9.391 0.488 0 1.561 25.33 25.39 26.99 25.39 0.1762 0-0.7011-2.206-1.949-4.901zm149.8-9.536c5.487-3.687 19.46-14.65 19.07-14.96-0.126-0.1032-4.197-0.3888-9.046-0.6338l-8.816-0.4452-3.967 5.891c-4.284 6.363-7.088 11.99-6.473 12.98 0.9066 1.47 4.434 0.3864 9.228-2.836z",fill:"#13ad73"},null,-1),Ye=e("path",{d:"m253.9 167.7c-0.2579 0.0513-1.238 0.5454-4.691 0.5216-3.625-0.0248 4.941 9.227 6.934 34.4-8.031-0.4678-8.408-3.285-24.81-5.999-15.88-2.627-25.28 5.883-29.57 18.88-3.429 10.39-3.592 23.66-1.19 36.39 2.348 12.45 7.148 24.39 13.74 32.65 6.909 8.654 14.05 10.96 20.49 10.82 8.459-0.1842 15.7-4.599 19.58-4.407 6.726 0.3331 13.29 8.894 28.17 2.151 6.047-2.741 12.03-7.819 17.08-14.81 4.984-6.907 9.051-15.68 11.35-25.91 2.018-8.972 2.678-19.07 1.41-30-1.616-13.93-7.519-20.42-14.9-23.01-8.286-2.905-18.43-0.8896-26.46 1.032-4.71 1.127-8.69 2.223-11.14 2.273-0.155 3e-3 -0.2829-4.1e-4 -0.4335 2e-3 -0.01-0.0695-0.0197-0.1385-0.0323-0.2078-2.249-11.58-4.704-29.29-5.401-33.64-0.152-0.9486 0.0845-1.177-0.1162-1.137z",fill:"#f2ac05","fill-rule":"evenodd"},null,-1),Qe=[Ge,Ye];function Ze(s,t){return h(),x("svg",Ke,Qe)}var et=Z(Je,[["render",Ze]]);const tt={},nt={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},lt=e("path",{d:"m12 0c-6.624 0-12 5.376-12 12s5.376 12 12 12 12-5.376 12-12-5.376-12-12-12zm0 3.6c1.992 0 3.6 1.608 3.6 3.6s-1.608 3.6-3.6 3.6-3.6-1.608-3.6-3.6 1.608-3.6 3.6-3.6zm0 17.04c-3 0-5.652-1.536-7.2-3.864 0.036-2.388 4.8-3.696 7.2-3.696 2.388 0 7.164 1.308 7.2 3.696-1.548 2.328-4.2 3.864-7.2 3.864z"},null,-1),at=[lt];function ot(s,t){return h(),x("svg",nt,at)}var st=Z(tt,[["render",ot]]);const it={},ut={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},rt=e("path",{d:"m12 0-2.115 2.115 8.37 8.385h-18.255v3h18.255l-8.37 8.385 2.115 2.115 12-12z"},null,-1),ct=[rt];function dt(s,t){return h(),x("svg",ut,ct)}var ye=Z(it,[["render",dt]]);const mt=e("div",{id:"app-name"},[e("span",null,"Hey"),e("span",null,[U("Apple"),e("sup",null,"beta")])],-1),vt={id:"nav-main"},ft={id:"nav-user"},ht={href:"https://docs.heyapple.org",target:"_blank"},pt={setup(s){const{t}=Y(),u=j("csrfToken");function c(i){i.preventDefault(),fetch("/auth/local",{method:"DELETE",headers:{"X-CSRF-Token":u}}).then(r=>{r.ok?window.location="/":window.dispatchEvent(new CustomEvent("error",{detail:{msg:t("signout.err"+r.status)}}))})}function a(i){i.stopPropagation(),document.querySelector("header nav").classList.toggle("open")}return document.addEventListener("click",function(){document.querySelector("header nav").classList.remove("open")}),(i,r)=>(h(),x("header",null,[$(et,{id:"logo"}),mt,e("nav",null,[e("button",{onClick:a},[$(ye)]),e("ul",vt,[e("li",null,[$(n(re),{to:"/"},{default:A(()=>[U(l(n(t)("nav.diary")),1)]),_:1})]),e("li",null,[$(n(re),{to:"/food"},{default:A(()=>[U(l(n(t)("nav.food")),1)]),_:1})]),e("li",null,[$(n(re),{to:"/recipes"},{default:A(()=>[U(l(n(t)("nav.recipes")),1)]),_:1})]),e("li",null,[$(n(re),{to:"/shopping"},{default:A(()=>[U(l(n(t)("nav.shopping")),1)]),_:1})])]),e("ul",ft,[e("li",null,[$(n(re),{to:"/profile"},{default:A(()=>[U(l(n(t)("nav.profile")),1)]),_:1})]),e("li",null,[$(n(re),{to:"/settings"},{default:A(()=>[U(l(n(t)("nav.settings")),1)]),_:1})]),e("li",null,[e("a",ht,l(n(t)("nav.help")),1)]),e("li",null,[e("a",{href:"#",onClick:c},l(n(t)("nav.signout")),1)])])]),e("button",{onClick:a},[$(st)])]))}},_t={},gt={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},bt=e("path",{d:"m7.6364 17.318-5.7273-5.7273-1.9091 1.9091 7.6364 7.6364 16.364-16.364-1.9091-1.9091z"},null,-1),yt=[bt];function $t(s,t){return h(),x("svg",gt,yt)}var $e=Z(_t,[["render",$t]]);const kt={},wt={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},xt=e("path",{d:"m12 1.6364-12 20.727h24zm0 4.353 8.2159 14.192h-16.43zm-1.0909 4.3743v5.4545h2.1818v-5.4545zm0 6.5455v2.1818h2.1818v-2.1818z"},null,-1),Ct=[xt];function St(s,t){return h(),x("svg",wt,Ct)}var Lt=Z(kt,[["render",St]]);const It={props:["msg"],emits:["timeout"],setup(s,{emit:t}){const u=s;return oe(()=>{setTimeout(function(){t("timeout",u.msg.id)},u.msg.time)}),(c,a)=>(h(),x("div",{class:P(["message",[s.msg.type,s.msg.id]])},[s.msg.type=="message"?(h(),J($e,{key:0})):q("",!0),s.msg.type!="message"?(h(),J(Lt,{key:1})):q("",!0),e("p",null,l(s.msg.msg),1)],2))}};const Tt={id:"messages"},Et={setup(s){const t=w([]);let u=0;function c(i){t.value.push({id:u++,type:i.type,msg:i.detail.msg,time:i.detail.timeout})}function a(i){t.value=t.value.filter(r=>r.id!=i)}return oe(()=>{window.addEventListener("message",c),window.addEventListener("warning",c),window.addEventListener("error",c)}),(i,r)=>(h(),x("div",Tt,[(h(!0),x(G,null,Q(t.value,o=>(h(),J(It,{key:o.id,msg:o,onTimeout:a},null,8,["msg"]))),128))]))}};const Ft={setup(s){return oe(()=>{document.querySelector("body > .spinner-container").remove()}),(t,u)=>(h(),x(G,null,[$(pt),$(n(Ue)),$(Et)],64))}},Mt={},Dt={version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},zt=e("path",{id:"path-top",d:"m0 3v2h24v-2z"},null,-1),Rt=e("path",{id:"path-mid",d:"m0 13h24v-2h-24z"},null,-1),Ot=e("path",{id:"path-bottom",d:"m0 21h24v-2h-24z"},null,-1),Pt=[zt,Rt,Ot];function At(s,t){return h(),x("svg",Dt,Pt)}var Nt=Z(Mt,[["render",At]]);const Ut={},jt={width:"512",height:"512",version:"1.1",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},Vt=e("path",{d:"m251.2 4.007c-17.24-0.2277-34.69 4.924-50.29 15.67-14.33 9.866-26.9 26.43-33.11 43.62-1.357 3.754-2.073 4.828-2.992 4.475-10.97-4.217-29-5.131-40.42-2.049-23.57 6.359-41.5 24.22-48.52 48.31-2.553 8.761-3.407 21.84-1.997 30.6 0.5299 3.293 0.7902 6.162 0.5799 6.372-0.2104 0.2108-2.439 0.9186-4.956 1.572-16.5 4.283-34.28 18.21-43.89 34.41-8.382 14.11-11.91 27.14-11.93 44-0.02401 23.88 7.433 42.79 23.41 59.36 14.31 14.85 32.89 22.84 52.49 22.56 4.95-0.0689 10.41-0.4681 12.13-0.8863 2.9-0.7045 3.245-0.6061 4.695 1.334 8.833 11.82 16.82 18.58 29.19 24.7 6.707 3.32 9.412 5.257 16.09 11.53 24.85 23.35 47.68 40.8 76.05 58.12 9.503 5.8 18.01 13.61 20.54 18.86 3.313 6.878 3.637 11.06 1.825 23.56-2.778 19.18-7.936 38.33-13.13 48.74l-2.639 5.295h-13.49c-16.17-3e-3 -92.41 2.205-106.2 3.077l0.01-3e-3c-5.381 0.3399 64.84 0.6684 156 0.7315 91.2 0.0625 165.7-0.0216 165.5-0.1878-0.4753-0.4399-58.86-2.155-93-2.731l-29.4-0.4942-2.89-4.313c-8.274-12.35-13.68-36.12-16.33-71.76-2.105-28.31 1.454-40.62 14.72-50.94 11.18-8.699 30.14-20.92 48.72-31.39 7.533-4.248 14.57-8.318 15.65-9.048 1.076-0.7296 3.366-1.779 5.087-2.33 7.71-2.467 21.34-10.26 28.3-16.17 3.662-3.113 4.427-3.435 8.218-3.446 8.183-0.0267 21.12-3.59 31.28-8.613 21.39-10.58 38.52-30.56 46.38-54.11 10.84-32.47 5.42-66.98-14.68-93.52l-5.364-7.084 0.916-4.395c1.646-7.896 1.904-21.74 0.5502-29.5-5.632-32.29-26.9-56.92-56-64.86-4.726-1.29-8.51-1.647-18.49-1.74l-12.55-0.1186-5.101-3.647c-13.67-9.776-29.15-14.43-45.31-13.64-4.95 0.2432-11.26 0.9944-14.02 1.671l-5.028 1.229-5.539-5.72c-17.07-17.63-38.89-26.81-61.05-27.1zm2.728 163.7c0.2008-0.0398-0.0367 0.1881 0.1154 1.137 0.6972 4.35 3.151 22.06 5.4 33.64 0.0118 0.0694 0.0228 0.138 0.0328 0.2076 0.1506-2e-3 0.2799 9e-5 0.4349-3e-3 2.448-0.0501 6.427-1.143 11.14-2.27 8.028-1.922 18.18-3.94 26.46-1.035 7.379 2.587 13.28 9.078 14.9 23.01 1.268 10.94 0.6106 21.03-1.407 30-2.301 10.23-6.37 19.01-11.35 25.91-5.045 6.991-11.03 12.07-17.07 14.81-14.87 6.743-21.44-1.818-28.16-2.152-3.88-0.1922-11.12 4.224-19.58 4.409-6.437 0.1402-13.58-2.169-20.49-10.82-6.596-8.262-11.39-20.2-13.74-32.65-2.402-12.73-2.24-26 1.189-36.39 4.29-13 13.69-21.51 29.58-18.88 16.41 2.714 16.78 5.532 24.81 6-1.993-25.18-10.56-34.43-6.936-34.4 3.453 0.0238 4.434-0.4726 4.692-0.5239zm45.16 159.1 6.55 3.542c3.603 1.947 9.529 4.401 13.17 5.45 3.641 1.049 6.753 2.307 6.916 2.797 0.4733 1.423-4.232 10.83-8.214 16.42-4.588 6.442-12.05 13.85-15.96 15.86-3.919 2.004-4.971 1.93-6.867-0.4843-1.372-1.748-1.532-2.86-1.229-8.432 0.1916-3.529 0.558-11.94 0.8171-18.7 0.4657-12.13 0.4983-12.3 2.646-14.37zm35.38 12.77 8.817 0.4448c4.849 0.245 8.919 0.5294 9.045 0.6326 0.3835 0.315-13.58 11.27-19.07 14.96-4.795 3.222-8.322 4.307-9.229 2.837-0.6151-0.9971 2.187-6.619 6.471-12.98zm-166.7 4.596c7.489 0 9.391 0.219 9.391 1.087 0 2.234 4.067 15.16 6.257 19.89 1.248 2.694 2.123 4.9 1.947 4.9-1.66 0-26.99-23.83-26.99-25.39 0-0.2685 4.226-0.4876 9.391-0.4876zm16.13 1.727c0.0388-0.0118 0.0851-6e-3 0.1417 0.0231 9.674 5.087 20.32 9.107 27.58 10.41 2.293 0.4121 3.101 1.124 4.695 4.138 2.657 5.026 14.48 23 22.37 34.02 3.603 5.03 6.639 9.968 6.748 10.98 0.2897 2.671-2.108 2.658-7.285-0.0429-17.39-9.068-40.22-26.29-45.07-34.01-3.258-5.172-10.38-25.14-9.173-25.52zm67.9 9.71c0.263-9e-3 0.4337 9e-3 0.4876 0.0625 0.2159 0.2154 0.3921 6.837 0.3921 14.71 0 10.98-0.2506 14.62-1.074 15.62-1.615 1.956-3.397 1.59-6.909-1.423-4.068-3.49-7.665-9.13-10.4-16.3-3.912-10.28-4.082-9.686 2.985-10.28 3.355-0.2804 8.013-1.006 10.35-1.615 1.755-0.4562 3.373-0.7502 4.162-0.7776z"},null,-1),Bt=[Vt];function Ht(s,t){return h(),x("svg",jt,Bt)}var Xt=Z(Ut,[["render",Ht]]);const qt={},Wt={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Jt=e("path",{d:"m12 6c1.65 0 3-1.35 3-3s-1.35-3-3-3-3 1.35-3 3 1.35 3 3 3zm0 3c-1.65 0-3 1.35-3 3s1.35 3 3 3 3-1.35 3-3-1.35-3-3-3zm0 9c-1.65 0-3 1.35-3 3s1.35 3 3 3 3-1.35 3-3-1.35-3-3-3z"},null,-1),Kt=[Jt];function Gt(s,t){return h(),x("svg",Wt,Kt)}var De=Z(qt,[["render",Gt]]);const Yt={id:"filter"},Qt=U(" This is the main search & filter area"),Zt={id:"main"},en={class:"controls"},tn=e("span",{class:"spacer"},null,-1),nn={class:"content"},ln=U("This is the main area"),an={id:"details"},on={class:"controls"},sn=e("span",{class:"spacer"},null,-1),un={class:"placeholder"},de={emits:["detailVisibility"],setup(s,{expose:t,emit:u}){const{t:c}=Y(),a=j("prefs"),i=w(!1),r=w(!1),o=B(()=>({"open-filter":i.value,"open-details":r.value,"neutral-charts":a.value.ui.neutralCharts}));function p(){i.value?i.value=!1:(i.value=!0,r.value=!1,u("detailVisibility"))}function v(){u("detailVisibility"),r.value?r.value=!1:(r.value=!0,i.value=!1)}function C(){u("detailVisibility"),r.value||(r.value=!0,i.value=!1)}return t({showDetails:C}),(k,L)=>(h(),x("main",{class:P(n(o))},[e("div",Yt,[se(k.$slots,"filter",{},()=>[Qt])]),e("div",Zt,[e("div",en,[e("button",{onClick:p,class:"open-filter icon"},[$(Nt)]),se(k.$slots,"controls",{},()=>[tn]),e("button",{onClick:v,class:"open-details icon"},[$(De)])]),e("div",nn,[se(k.$slots,"main",{},()=>[ln])])]),e("div",an,[e("div",on,[se(k.$slots,"head-details"),sn,e("button",{onClick:v,class:"open-details icon"},[$(ye)])]),se(k.$slots,"details",{},()=>[e("div",un,[$(Xt),e("p",null,l(n(c)("details.noitem")),1)])])])],2))}},rn=["placeholder"],cn=U("Additional filters"),ze={props:["data","placeholder"],emits:["result"],setup(s,{emit:t}){const u=s;var c=void 0;function a(r){r.preventDefault(),clearTimeout(c),c=setTimeout(function(){i(r.target.closest("form"))},500)}function i(r){let o=new FormData(r),p=u.data.filter(v=>{let C=v.size||1;for(let k of o.keys()){if(k=="name"){let z=o.get(k).toLowerCase();if(!v[k].toLowerCase().includes(z))return!1;continue}let[L,E]=o.getAll(k).map(z=>parseFloat(z));if(!isNaN(L)&&!isNaN(E)&&(v[k]/C<L||E<v[k]/C))return!1}return!0});t("result",p)}return(r,o)=>(h(),x("form",null,[e("input",{type:"text",name:"name",autocomplete:"off",placeholder:s.placeholder,onInput:a},null,40,rn),se(r.$slots,"default",{confirm:a},()=>[cn])]))}};const dn={class:"slider"},mn=["name","value"],vn=U(" \xA0\u2013\xA0 "),fn=["name","value"],hn={class:"bar"},pn={class:"slide"},_n=e("div",{class:"interact-area"},null,-1),gn=[_n],bn=e("div",{class:"interact-area"},null,-1),yn=[bn],K={props:["label","name","unit","min","max","frac"],emits:["input"],setup(s,{emit:t}){const u=s,{t:c}=Y(),a=w(parseFloat(u.min).toFixed(u.frac)),i=w(parseFloat(u.max).toFixed(u.frac)),r=w(0),o=w(100);he(()=>u.min,(m,F)=>p(m)),he(()=>u.max,(m,F)=>v(m));function p(m){let F=parseFloat(u.min)||0,I=parseFloat(m)||F;a.value=I,i.value=Math.max(a.value,i.value);let _=parseFloat(u.max)||0;r.value=(I-F)*100/(_-F),o.value=Math.max(r.value,o.value)}function v(m){let F=parseFloat(u.max)||0,I=parseFloat(m)||F;i.value=I,a.value=Math.min(a.value,i.value);let _=parseFloat(u.min)||0;o.value=(I-_)*100/(F-_),r.value=Math.min(r.value,o.value)}function C(m){m.target.blur(),p(m.target.value),t("input",m)}function k(m){m.target.blur(),v(m.target.value),t("input",m)}function L(m){let I=m.target.closest(".slide").getBoundingClientRect(),_=m.pageX!==void 0?m.pageX:m.changedTouches[0].pageX;_=Math.min(Math.max(_-I.left,0),I.width);let d=_*100/I.width,g=parseFloat(u.min)||0,S=parseFloat(u.max)||0,D=d/100*(S-g)+g;m.target.closest("button").classList.contains("min")?(a.value=D.toFixed(u.frac),i.value=Math.max(a.value,i.value),r.value=d,o.value=Math.max(r.value,o.value)):(i.value=D.toFixed(u.frac),a.value=Math.min(a.value,i.value),o.value=d,r.value=Math.min(r.value,o.value)),t("input",m)}function E(m){let F=m.target.closest("button");F.addEventListener("mousemove",L),F.addEventListener("touchmove",L),F.addEventListener("mouseup",z),F.addEventListener("touchend",z),F.addEventListener("mouseleave",z),F.addEventListener("touchcancel",z),F.classList.add("active")}function z(m){let F=m.target.closest("button");F.removeEventListener("mousemove",L),F.removeEventListener("touchmove",L),F.removeEventListener("mouseup",z),F.removeEventListener("touchend",z),F.removeEventListener("mouseleave",z),F.removeEventListener("touchcancel",z),F.classList.remove("active")}return(m,F)=>(h(),x("div",dn,[e("label",null,[e("span",null,l(s.label)+" ("+l(n(c)("unit."+s.unit))+")",1),e("input",{type:"number",name:s.name,value:a.value,onChange:C},null,40,mn),vn,e("input",{type:"number",name:s.name,value:i.value,onChange:k},null,40,fn)]),e("div",hn,[e("div",pn,[e("div",{class:"overlay",style:be({left:r.value+"%",right:100-o.value+"%"})},null,4),e("button",{type:"button",class:"handle min",style:be({left:r.value+"%"}),onMousedown:E,onTouchstart:E},gn,36),e("button",{type:"button",class:"handle max",style:be({left:o.value+"%"}),onMousedown:E,onTouchstart:E},yn,36)])])]))}};const $n={class:"clickable-input"},kn=["placeholder"],wn=["value"],Re={props:["label","placeholder"],emits:["confirm"],setup(s,{emit:t}){const u=w("");function c(a){a.preventDefault(),t("confirm",u.value),u.value=""}return(a,i)=>(h(),x("form",$n,[ce(e("input",{type:"text",autocomplete:"off","onUpdate:modelValue":i[0]||(i[0]=r=>u.value=r),placeholder:s.placeholder},null,8,kn),[[xe,u.value]]),e("input",{type:"submit",onClick:c,value:s.label},null,8,wn)]))}};const xn={class:"clickable-select"},Cn={value:"0",selected:""},Sn=["value"],Ln=["disabled"],In={props:["label","placeholder","items","disabled"],emits:["confirm"],setup(s,{emit:t}){const u=s,{locale:c}=Y(),a=w(0),i=new Intl.Collator(c.value,{numeric:!0}),r=B(()=>[...u.items].sort((p,v)=>i.compare(p.name,v.name)));function o(p){p.preventDefault(),a.value&&t("confirm",a.value)}return(p,v)=>(h(),x("form",xn,[ce(e("select",{"onUpdate:modelValue":v[0]||(v[0]=C=>a.value=C)},[e("option",Cn,l(s.placeholder),1),(h(!0),x(G,null,Q(n(r),C=>(h(),x("option",{key:C.id,value:C.id},l(C.name),9,Sn))),128))],512),[[we,a.value]]),e("button",{type:"submit",class:"async",onClick:o,disabled:s.disabled},l(s.label),9,Ln)]))}};const Tn={class:"clickable-date"},En=["value"],Fn=["value"],Mn=["disabled"],Oe={props:["label","date","time","disabled"],emits:["confirm"],setup(s,{emit:t}){function u(c){c.preventDefault();let a=new FormData(c.target.closest("form"));t("confirm",a.get("date"),a.get("time"))}return(c,a)=>(h(),x("form",Tn,[e("input",{type:"date",name:"date",value:s.date},null,8,En),e("input",{type:"time",name:"time",value:s.time},null,8,Fn),e("button",{type:"submit",class:"async",onClick:u,disabled:s.disabled},l(s.label),9,Mn)]))}};const Dn={},zn={class:"icon sort-arrow"};function Rn(s,t){return h(),x("span",zn)}var ae=Z(Dn,[["render",Rn]]);const On=["onClick"],Pn={class:"name"},An={class:"num"},Nn={class:"unit"},Un={class:"m num"},jn={class:"unit"},Vn={class:"m num"},Bn={class:"unit"},Hn={class:"m num"},Xn={class:"unit"},Pe={props:["items"],emits:"selected",setup(s,{emit:t}){const u=s,{t:c,locale:a}=Y(),i=w("name"),r=w("asc"),o=new Intl.Collator(a.value,{numeric:!0}),p=B(()=>r.value=="asc"?[...u.items].sort((k,L)=>o.compare(k[i.value],L[i.value])):[...u.items].sort((k,L)=>-o.compare(k[i.value],L[i.value])));function v(k,L,E=1){return L?+parseFloat(k/L).toFixed(E):k}function C(k){let L=k.target.dataset.sort;i.value==L?r.value=r.value=="asc"?"desc":"asc":i.value=L}return(k,L)=>(h(),x("table",null,[e("thead",null,[e("tr",{class:P(r.value)},[e("th",{class:P(["name sort",{active:i.value=="name"}]),onClick:C,"data-sort":"name"},[U(l(n(c)("food.name"))+" ",1),$(ae)],2),e("th",{class:P(["num sort",{active:i.value=="kcal"}]),onClick:C,"data-sort":"kcal"},[$(ae),U(" "+l(n(c)("food.energy")),1)],2),e("th",{class:P(["m num sort",{active:i.value=="fat"}]),onClick:C,"data-sort":"fat"},[$(ae),U(" "+l(n(c)("food.fat")),1)],2),e("th",{class:P(["m num sort",{active:i.value=="carb"}]),onClick:C,"data-sort":"carb"},[$(ae),U(" "+l(n(c)("food.carbs2")),1)],2),e("th",{class:P(["m num sort",{active:i.value=="prot"}]),onClick:C,"data-sort":"prot"},[$(ae),U(" "+l(n(c)("food.protein")),1)],2)],2)]),e("tbody",null,[(h(!0),x(G,null,Q(n(p),E=>(h(),x("tr",{key:E.id,onClick:z=>k.$emit("selected",E.id)},[e("td",Pn,l(E.name),1),e("td",An,[U(l(v(E.kcal,E.size,0))+" ",1),e("span",Nn,l(n(c)("unit.cal")),1)]),e("td",Un,[U(l(v(E.fat,E.size))+" ",1),e("span",jn,l(n(c)("unit.g")),1)]),e("td",Vn,[U(l(v(E.carb,E.size))+" ",1),e("span",Bn,l(n(c)("unit.g")),1)]),e("td",Hn,[U(l(v(E.prot,E.size))+" ",1),e("span",Xn,l(n(c)("unit.g")),1)])],8,On))),128))])]))}};const Ae={props:["item"],setup(s){const t=s,{t:u,locale:c}=Y(),a=new Intl.Collator(c.value,{numeric:!0}),i=4096,r=B(()=>{let o=[];for(let p=1;p<=i;p*=2)(t.item.flags&p)==p&&o.push({id:p,name:u("tag."+p)});return o.sort((p,v)=>a.compare(p.name,v.name))});return(o,p)=>(h(!0),x(G,null,Q(n(r),v=>(h(),x("span",{class:P(["tag no-edit-mode","tag-"+v.id]),key:v.id},l(v.name),3))),128))}},qn={},Wn={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Jn=e("path",{d:"m-7.5e-8 19.001v4.9993h4.9993l14.745-14.745-4.9993-4.9993zm23.61-13.611c0.51993-0.51993 0.51993-1.3598 0-1.8797l-3.1196-3.1196c-0.51993-0.51993-1.3598-0.51993-1.8797 0l-2.4397 2.4397 4.9993 4.9993z"},null,-1),Kn=[Jn];function Gn(s,t){return h(),x("svg",Wn,Kn)}var Ce=Z(qn,[["render",Gn]]);const Yn={key:0,class:"new-item"},Qn=e("hr",null,null,-1),Zn={class:"subtitle"},el={class:"tags"},tl=["disabled"],nl=e("hr",null,null,-1),ll={class:"tracking no-edit-mode"},al={class:"tracking-amount"},ol={class:"unit"},sl=e("hr",null,null,-1),il={class:"nutrient-block"},ul=["disabled"],rl=["value"],cl={class:"unit"},dl=["value"],ml={class:"unit"},vl=["value"],fl={class:"unit"},hl=["value"],pl={class:"unit"},_l=["value"],gl={class:"unit"},bl=["disabled"],yl=["value"],$l={class:"unit"},kl=["value"],wl={class:"unit"},xl=["value"],Cl={class:"unit"},Sl=["value"],Ll={class:"unit"},Il=["value"],Tl={class:"unit"},El={setup(s){const{t}=Y(),u=j("log"),c=j("csrfToken"),a=j("perms"),i=j("food"),r=j("recipes"),o=j("diary"),p=w([]),v=w(null),C=w(!1),k=w(!1),L=w(!1),E=w(!1),z=w(100),m=w(W.now().toISODate()),F=w(W.now().toLocaleString(W.TIME_24_SIMPLE)),I=w(null),_=w(null);function d(b){fetch("/api/v1/food",{method:"POST",headers:{"X-CSRF-Token":c}}).then(f=>{if(!f.ok)throw t("createfood.err"+f.status);return f.json()}).then(f=>{f.name=b,f.cat="",i.value.push(f),p.value.push(f),u.msg(t("createfood.ok")),X(f.id)}).catch(f=>u.err(f))}function g(){k.value=!0;let b=v.value.id;fetch("/api/v1/food/"+b,{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":c},body:new URLSearchParams(new FormData(_.value))}).then(f=>{if(!f.ok)throw t("savefood.err"+f.status);return C.value=!1,fetch("/api/v1/food/"+b)}).then(f=>f.json()).then(f=>{f.name=t(f.id.toString()),f.cat=t("cat."+f.cat),i.value=i.value.map(y=>f.id==y.id?f:y),p.value=p.value.map(y=>f.id==y.id?f:y),v.value=v.value.id==f.id?f:v.value,u.msg(t("savefood.ok"))}).catch(f=>u.err(f)).finally(()=>{setTimeout(function(){k.value=!1},500)})}function S(b){L.value=!0,fetch(`/api/v1/recipe/${b}/ingredient/${v.value.id}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":c},body:new URLSearchParams({amount:z.value})}).then(f=>{if(!f.ok)throw t("addfood.err"+f.status);return fetch("/api/v1/recipe/"+b)}).then(f=>f.json()).then(f=>{r.value=r.value.map(y=>f.id==y.id?f:y),z.value=100,u.msg(t("addfood.ok"))}).catch(f=>u.err(f)).finally(()=>{setTimeout(function(){L.value=!1},500)})}function D(b,f){E.value=!0,m.value=b,F.value=f,fetch(`/api/v1/diary/${b}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":c},body:new URLSearchParams({id:v.value.id,amount:z.value,time:f,recipe:""})}).then(y=>{if(!y.ok)throw t("savediary.err"+y.status);return fetch("/api/v1/diary/"+b.replaceAll("-","/"))}).then(y=>y.json()).then(y=>{o.value[b]=y[0],z.value=100,u.msg(t("savediary.ok"))}).catch(y=>u.err(y)).finally(()=>{setTimeout(function(){E.value=!1},500)})}function N(b){p.value=b,v.value&&p.value.filter(f=>f.id==v.value.id).length==0&&(v.value=null)}function X(b){v.value=p.value.filter(f=>f.id==b)[0],I.value.showDetails()}function V(){C.value?g():C.value=!0}function T(b){b.target.blur(),isNaN(parseFloat(b.target.value))&&(b.target.value=v.value[b.target.name])}return(b,f)=>(h(),J(de,{ref_key:"main",ref:I,onDetailVisibility:f[1]||(f[1]=y=>C.value=!1),class:P({"edit-mode":C.value})},Fe({filter:A(()=>[n(a).canCreateFood?(h(),x("section",Yn,[e("h2",null,l(n(t)("aria.headnew")),1),$(Re,{label:n(t)("btn.new"),placeholder:n(t)("food.hintnew"),onConfirm:d},null,8,["label","placeholder"])])):q("",!0),Qn,e("section",null,[e("h2",null,l(n(t)("aria.headsearch")),1),$(ze,{data:n(i),placeholder:n(t)("food.hintsearch"),onResult:N},{default:A(y=>[e("fieldset",null,[e("legend",null,l(n(t)("aria.headmacro1")),1),$(K,{label:n(t)("food.energy"),onInput:y.confirm,name:"kcal",unit:"cal",min:"0",max:"900",frac:"0"},null,8,["label","onInput"]),$(K,{label:n(t)("food.fat"),onInput:y.confirm,name:"fat",unit:"g",min:"0",max:"100",frac:"0"},null,8,["label","onInput"]),$(K,{label:n(t)("food.carbs"),onInput:y.confirm,name:"carb",unit:"g",min:"0",max:"100",frac:"0"},null,8,["label","onInput"]),$(K,{label:n(t)("food.protein"),onInput:y.confirm,name:"prot",unit:"g",min:"0",max:"89",frac:"0"},null,8,["label","onInput"]),$(K,{label:n(t)("food.fiber"),onInput:y.confirm,name:"fib",unit:"g",min:"0",max:"71",frac:"0"},null,8,["label","onInput"])]),e("fieldset",null,[e("legend",null,l(n(t)("aria.headmacro2")),1),$(K,{label:n(t)("food.fatsat"),onInput:y.confirm,name:"fatsat",unit:"g",min:"0",max:"83",frac:"0"},null,8,["label","onInput"]),$(K,{label:n(t)("food.fato3"),onInput:y.confirm,name:"fato3",unit:"g",min:"0",max:"54",frac:"0"},null,8,["label","onInput"]),$(K,{label:n(t)("food.fato6"),onInput:y.confirm,name:"fato6",unit:"g",min:"0",max:"70",frac:"0"},null,8,["label","onInput"]),$(K,{label:n(t)("food.sugar"),onInput:y.confirm,name:"sug",unit:"g",min:"0",max:"100",frac:"0"},null,8,["label","onInput"]),$(K,{label:n(t)("food.salt"),onInput:y.confirm,name:"salt",unit:"g",min:"0",max:"100",frac:"0"},null,8,["label","onInput"])])]),_:1},8,["data","placeholder"])])]),main:A(()=>[$(Pe,{items:p.value,onSelected:X},null,8,["items"])]),_:2},[v.value?{name:"head-details",fn:A(()=>[e("h2",null,l(v.value.name),1)])}:void 0,v.value?{name:"details",fn:A(()=>[e("section",Zn,l(v.value.cat),1),e("section",el,[$(Ae,{item:v.value},null,8,["item"]),n(a).canCreateFood||n(a).canEditFood?(h(),x("button",{key:0,class:"icon async",disabled:k.value,onClick:V},[C.value?q("",!0):(h(),J(Ce,{key:0})),C.value?(h(),J($e,{key:1})):q("",!0)],8,tl)):q("",!0)]),nl,e("section",ll,[e("h2",null,l(n(t)("aria.headtrack")),1),e("fieldset",al,[e("div",null,[e("label",null,l(n(t)("food.amount")),1),ce(e("input",{type:"number","onUpdate:modelValue":f[0]||(f[0]=y=>z.value=y),name:"amount"},null,512),[[xe,z.value]]),e("span",ol,l(n(t)("unit.g")),1)])]),e("fieldset",null,[e("label",null,l(n(t)("food.torec")),1),$(In,{label:n(t)("btn.add"),placeholder:n(t)("food.hintrec"),items:n(r),disabled:L.value,onConfirm:S},null,8,["label","placeholder","items","disabled"])]),e("fieldset",null,[e("label",null,l(n(t)("food.todiary")),1),$(Oe,{label:n(t)("btn.add"),time:F.value,date:m.value,disabled:E.value,onConfirm:D},null,8,["label","time","date","disabled"])])]),sl,e("section",null,[e("h2",null,l(n(t)("aria.headnutrients")),1),e("form",{ref_key:"form",ref:_},[e("div",il,[e("fieldset",{disabled:!C.value,class:"col50"},[e("div",null,[e("label",null,l(n(t)("food.energy")),1),e("input",{type:"number",value:v.value.kcal,name:"kcal",onChange:T},null,40,rl),e("span",cl,l(n(t)("unit.cal")),1)]),e("div",null,[e("label",null,l(n(t)("food.fat")),1),e("input",{type:"number",value:v.value.fat,name:"fat",onChange:T},null,40,dl),e("span",ml,l(n(t)("unit.g")),1)]),e("div",null,[e("label",null,l(n(t)("food.carbs2")),1),e("input",{type:"number",value:v.value.carb,name:"carb",onChange:T},null,40,vl),e("span",fl,l(n(t)("unit.g")),1)]),e("div",null,[e("label",null,l(n(t)("food.protein")),1),e("input",{type:"number",value:v.value.prot,name:"prot",onChange:T},null,40,hl),e("span",pl,l(n(t)("unit.g")),1)]),e("div",null,[e("label",null,l(n(t)("food.fiber")),1),e("input",{type:"number",value:v.value.fib,name:"fib",onChange:T},null,40,_l),e("span",gl,l(n(t)("unit.g")),1)])],8,ul),e("fieldset",{disabled:!C.value,class:"col50"},[e("div",null,[e("label",null,l(n(t)("food.fatsat")),1),e("input",{type:"number",value:v.value.fatsat,name:"fatsat",onChange:T},null,40,yl),e("span",$l,l(n(t)("unit.g")),1)]),e("div",null,[e("label",null,l(n(t)("food.fato3")),1),e("input",{type:"number",value:v.value.fato3,name:"fato3",onChange:T},null,40,kl),e("span",wl,l(n(t)("unit.g")),1)]),e("div",null,[e("label",null,l(n(t)("food.fato6")),1),e("input",{type:"number",value:v.value.fato6,name:"fato6",onChange:T},null,40,xl),e("span",Cl,l(n(t)("unit.g")),1)]),e("div",null,[e("label",null,l(n(t)("food.sugar")),1),e("input",{type:"number",value:v.value.sug,name:"sug",onChange:T},null,40,Sl),e("span",Ll,l(n(t)("unit.g")),1)]),e("div",null,[e("label",null,l(n(t)("food.salt")),1),e("input",{type:"number",value:v.value.salt,name:"salt",onChange:T},null,40,Il),e("span",Tl,l(n(t)("unit.g")),1)])],8,bl)])],512)])])}:void 0]),1032,["class"]))}};const Fl=["disabled"],Ml=["value"],Dl={class:"unit"},zl=["value"],Rl={props:["items","disabled"],setup(s,{expose:t}){const u=s,{t:c,locale:a}=Y(),i=w("name"),r=w(null),o=new Intl.Collator(a.value,{numeric:!0}),p=B(()=>u.items.map(L=>({id:L.id,amount:L.amount,name:c(L.id.toString())})).sort((L,E)=>o.compare(L[i.value],E[i.value])));function v(k){k.target.blur();let L=parseFloat(k.target.value);(isNaN(L)||L<0)&&(k.target.value=0)}function C(){let k=new FormData(r.value),L=k.getAll("id"),E=k.getAll("amount"),z=[];return u.items.forEach(m=>{let F=parseInt(L.indexOf(m.id.toString())),I=parseFloat(E[F]);I!=m.amount&&z.push({id:m.id,amount:I})}),z}return t({getDiff:C}),(k,L)=>(h(),x("form",{class:"ingredients",ref_key:"form",ref:r},[e("fieldset",{disabled:s.disabled},[(h(!0),x(G,null,Q(n(p),E=>(h(),x("div",{key:E.id},[e("label",null,l(E.name),1),e("input",{type:"number",name:"amount",value:E.amount,onChange:v},null,40,Ml),e("span",Dl,l(n(c)("unit.g")),1),e("input",{type:"hidden",name:"id",value:E.id},null,8,zl)]))),128))],8,Fl)],512))}},Ol={},Pl={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Al=e("path",{d:"m0 18.316h2.5263v0.63158h-1.2632v1.2632h1.2632v0.63158h-2.5263v1.2632h3.7895v-5.0526h-3.7895zm1.2632-11.368h1.2632v-5.0526h-2.5263v1.2632h1.2632zm-1.2632 3.7895h2.2737l-2.2737 2.6526v1.1368h3.7895v-1.2632h-2.2737l2.2737-2.6526v-1.1368h-3.7895zm6.3158-7.5789v2.5263h17.684v-2.5263zm0 17.684h17.684v-2.5263h-17.684zm0-7.5789h17.684v-2.5263h-17.684z"},null,-1),Nl=[Al];function Ul(s,t){return h(),x("svg",Pl,Nl)}var jl=Z(Ol,[["render",Ul]]);const Vl={class:"new-item"},Bl=e("hr",null,null,-1),Hl=["disabled"],Xl=["value"],ql=["innerHTML"],Wl={class:"tags"},Jl=["disabled"],Kl=e("hr",null,null,-1),Gl={key:0,class:"tracking no-edit-mode"},Yl={class:"tracking-amount"},Ql={class:"unit"},Zl=e("hr",null,null,-1),ea=["innerHTML"],ta=e("hr",null,null,-1),na={class:"no-edit-mode"},la={class:"nutrient-block"},aa={class:"col50"},oa={class:"unit"},sa={class:"unit"},ia={class:"col50"},ua={class:"unit"},ra={class:"unit"},ca=e("hr",null,null,-1),da={class:"prep"},ma=["disabled"],va={class:"prep-size"},fa=["value"],ha=["disabled"],pa=["value"],_a={class:"unit"},ga=["value"],ba={class:"unit"},ya=["value"],$a={class:"unit"},ka=["value"],wa={class:"unit"},xa={class:"placeholder"},Ca={setup(s){const{t}=Y(),u=j("log"),c=j("csrfToken");j("perms");const a=j("recipes"),i=j("diary"),r=w([]),o=w(null),p=w(!1),v=w(!1),C=w(!1),k=w(1),L=w("&nbsp;"),E=w(W.now().toISODate()),z=w(W.now().toLocaleString(W.TIME_24_SIMPLE)),m=w(null),F=w(null),I=w(null);function _(M,R=2){return+parseFloat(M/(o.value.size||1)).toFixed(R)}function d(M){return Math.min.apply(Math,a.value.map(R=>Math.floor(R[M]/R.size)))}function g(M){return Math.max.apply(Math,a.value.map(R=>Math.ceil(R[M]/R.size)))}function S(M){fetch("/api/v1/recipe",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":c},body:new URLSearchParams({name:M})}).then(R=>{if(!R.ok)throw t("createrec.err"+R.status);return R.json()}).then(R=>{R.isowner=!0,a.value.push(R),r.value.push(R),u.msg(t("createrec.ok")),V(R.id)}).catch(R=>u.err(R))}function D(){v.value=!0;let M=o.value.id,R=o.value.owner,H=o.value.isowner;fetch("/api/v1/recipe/"+M,{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":c},body:new URLSearchParams(new FormData(F.value))}).then(O=>{if(!O.ok)throw t("saverec.err"+O.status);return N(M)}).then(()=>fetch("/api/v1/recipe/"+M)).then(O=>O.json()).then(O=>{O.owner=R,O.isowner=H,a.value=a.value.map(le=>O.id==le.id?O:le),r.value=r.value.map(le=>O.id==le.id?O:le),o.value=o.value.id==O.id?O:o.value,u.msg(t("saverec.ok"))}).catch(O=>u.err(O)).finally(()=>{setTimeout(function(){v.value=!1},500)})}function N(M){let R=I.value.getDiff();return R.length==0?new Promise(H=>{p.value=!1,H()}):new Promise((H,O)=>{let le=0,ke;R.forEach(Se=>{fetch(`/api/v1/recipe/${M}/ingredient/${Se.id}`,{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":c},body:new URLSearchParams({amount:Se.amount})}).then(ge=>{if(++le,!ge.ok)throw t("saverec.err"+ge.status)}).catch(ge=>ke=ge).finally(()=>{le==R.length&&(ke?O(ke):(p.value=!1,H()))})})})}function X(M,R){C.value=!0,E.value=M,z.value=R;let H=new URLSearchParams;o.value.items.forEach(O=>{H.append("id",O.id),H.append("amount",_(O.amount)*k.value),H.append("time",R),H.append("recipe",o.value.name)}),fetch(`/api/v1/diary/${M}`,{method:"POST",body:H,headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":c}}).then(O=>{if(!O.ok)throw t("savediary.err"+O.status);return fetch("/api/v1/diary/"+M.replaceAll("-","/"))}).then(O=>O.json()).then(O=>{i.value[M]=O[0],k.value=1,u.msg(t("savediary.ok"))}).catch(O=>u.err(O)).finally(()=>{setTimeout(function(){C.value=!1},500)})}function V(M){o.value=r.value.filter(R=>R.id==M)[0],m.value.showDetails(),"isowner"in o.value?b():T()}function T(){fetch(`/api/v1/recipe/${o.value.id}/owner`).then(M=>{if(!M.ok)throw M;return M.json()}).then(M=>{o.value.isowner=M.isowner,o.value.owner=M.owner,b()}).catch(()=>{u.err(t("recowner.err")),L.value="&nbsp;"})}function b(){o.value.isowner?L.value=t("recipe.isowner"):o.value.owner?L.value=t("recipe.owner",{name:o.value.owner}):L.value=t("recipe.ispublic")}function f(M){r.value=M,o.value&&r.value.filter(R=>R.id==o.value.id).length==0&&(o.value=null)}function y(){p.value?D():p.value=!0}function ee(M){M.target.blur(),isNaN(parseFloat(M.target.value))&&(M.target.value=o.value[M.target.name])}return oe(()=>r.value=[...a.value]),(M,R)=>(h(),J(de,{ref_key:"main",ref:m,onDetailVisibility:R[1]||(R[1]=H=>p.value=!1),class:P({"edit-mode":p.value})},Fe({filter:A(()=>[e("section",Vl,[e("h2",null,l(n(t)("aria.headnewrec")),1),$(Re,{label:n(t)("btn.new"),placeholder:n(t)("recipe.hintnew"),onConfirm:S},null,8,["label","placeholder"])]),Bl,e("section",null,[e("h2",null,l(n(t)("aria.headsearch")),1),$(ze,{data:n(a),placeholder:n(t)("recipe.hintsearch"),onResult:f},{default:A(H=>[e("fieldset",null,[$(K,{label:n(t)("food.energy"),min:d("kcal"),max:g("kcal"),onInput:H.confirm,name:"kcal",unit:"cal",frac:"0"},null,8,["label","min","max","onInput"]),$(K,{label:n(t)("food.fat"),min:d("fat"),max:g("fat"),onInput:H.confirm,name:"fat",unit:"g",frac:"0"},null,8,["label","min","max","onInput"]),$(K,{label:n(t)("food.carbs"),min:d("carb"),max:g("carb"),onInput:H.confirm,name:"carb",unit:"g",frac:"0"},null,8,["label","min","max","onInput"]),$(K,{label:n(t)("food.protein"),min:d("prot"),max:g("prot"),onInput:H.confirm,name:"prot",unit:"g",frac:"0"},null,8,["label","min","max","onInput"])])]),_:1},8,["data","placeholder"])])]),main:A(()=>[$(Pe,{items:r.value,onSelected:V},null,8,["items"])]),_:2},[o.value?{name:"head-details",fn:A(()=>[e("form",{ref_key:"form",ref:F,autocomplete:"off",id:"form-recipe"},[e("fieldset",{disabled:!p.value},[e("input",{type:"text",name:"name",value:o.value.name},null,8,Xl)],8,Hl)],512)])}:void 0,o.value?{name:"details",fn:A(()=>[e("section",{class:"subtitle no-edit-mode",innerHTML:L.value},null,8,ql),e("section",Wl,[$(Ae,{item:o.value},null,8,["item"]),o.value.isowner?(h(),x("button",{key:0,class:"icon async",disabled:v.value,onClick:y},[p.value?q("",!0):(h(),J(Ce,{key:0})),p.value?(h(),J($e,{key:1})):q("",!0)],8,Jl)):q("",!0)]),Kl,o.value.items.length?(h(),x("section",Gl,[e("h2",null,l(n(t)("aria.headtrack")),1),e("fieldset",Yl,[e("div",null,[e("label",null,l(n(t)("food.amount")),1),ce(e("input",{type:"number","onUpdate:modelValue":R[0]||(R[0]=H=>k.value=H),name:"amount"},null,512),[[xe,k.value]]),e("span",Ql,l(n(t)("recipe.size",k.value)),1)])]),e("fieldset",null,[e("label",null,l(n(t)("food.todiary")),1),$(Oe,{label:n(t)("btn.add"),time:z.value,date:E.value,disabled:C.value,onConfirm:X},null,8,["label","time","date","disabled"])])])):q("",!0),Zl,e("section",null,[e("h2",null,l(n(t)("aria.headingred")),1),o.value.items.length?q("",!0):(h(),x("p",{key:0,class:"msg-noitems",innerHTML:n(t)("recipe.noitems")},null,8,ea)),$(Rl,{ref_key:"ingredients",ref:I,items:o.value.items,disabled:!p.value},null,8,["items","disabled"])]),ta,e("section",na,[e("h2",null,l(n(t)("aria.headnutrients")),1),e("div",la,[e("div",aa,[e("div",null,[e("label",null,l(n(t)("food.energy")),1),e("span",null,l(_(o.value.kcal,1)),1),e("span",oa,l(n(t)("unit.cal")),1)]),e("div",null,[e("label",null,l(n(t)("food.fat")),1),e("span",null,l(_(o.value.fat,1)),1),e("span",sa,l(n(t)("unit.g")),1)])]),e("div",ia,[e("div",null,[e("label",null,l(n(t)("food.carbs2")),1),e("span",null,l(_(o.value.carb,1)),1),e("span",ua,l(n(t)("unit.g")),1)]),e("div",null,[e("label",null,l(n(t)("food.protein")),1),e("span",null,l(_(o.value.prot,1)),1),e("span",ra,l(n(t)("unit.g")),1)])])])]),ca,e("section",da,[e("h2",null,l(n(t)("aria.headprep")),1),e("div",null,[e("fieldset",{disabled:!p.value,class:"col50"},[e("div",va,[e("label",null,l(n(t)("recipe.size",2)),1),e("input",{type:"number",name:"size",form:"form-recipe",value:o.value.size,onChange:ee},null,40,fa),e("label",null,l(n(t)("recipe.size",o.value.size)),1)])],8,ma),e("fieldset",{disabled:!p.value,class:"col50"},[e("div",null,[e("label",null,l(n(t)("recipe.time")),1),e("input",{type:"number",disabled:"",value:o.value.preptime+o.value.cooktime+o.value.misctime},null,8,pa),e("span",_a,l(n(t)("unit.min")),1)]),e("div",null,[e("label",null,l(n(t)("recipe.preptime")),1),e("input",{type:"number",name:"preptime",form:"form-recipe",value:o.value.preptime,onChange:ee},null,40,ga),e("span",ba,l(n(t)("unit.min")),1)]),e("div",null,[e("label",null,l(n(t)("recipe.cooktime")),1),e("input",{type:"number",name:"cooktime",form:"form-recipe",value:o.value.cooktime,onChange:ee},null,40,ya),e("span",$a,l(n(t)("unit.min")),1)]),e("div",null,[e("label",null,l(n(t)("recipe.misctime")),1),e("input",{type:"number",name:"misctime",form:"form-recipe",value:o.value.misctime,onChange:ee},null,40,ka),e("span",wa,l(n(t)("unit.min")),1)])],8,ha)]),e("div",xa,[$(jl),e("p",null,l(n(t)("todo.instructions")),1)])])])}:void 0]),1032,["class"]))}};const Sa=["disabled"],La={value:"1"},Ia={value:"2"},Ta={value:"3"},Ea={value:"4"},Fa={value:"5"},Ma={value:"6"},Da={value:"7"},za={value:"8"},Ra={value:"9"},Oa={value:"10"},Pa={value:"11"},Aa={value:"12"},Na=["value"],Ua=["disabled"],Ne={props:["mode","items","storage"],emits:["selection"],setup(s,{expose:t,emit:u}){const c=s,{t:a}=Y(),i=w(W.now().month),r=w(W.now().year),o=w([]),p=w(null),v=B(()=>{let _=c.items.map(d=>parseInt(d.split("-")[0])).filter((d,g,S)=>S.indexOf(d)===g);return _.length==0&&(_=[W.now().year]),[Math.min(..._)-1,..._,Math.max(..._)+1]}),C=B(()=>r.value!=v.value[0]||i.value>1),k=B(()=>r.value!=v.value[v.value.length-1]||i.value<12);he(()=>c.items,()=>{p.value.querySelectorAll("td>button").forEach(_=>{c.items.indexOf(_.dataset.date)!=-1?_.parentNode.classList.add("has-entries"):_.parentNode.classList.remove("has-entries")})});function L(){let _=W.now().toISODate(),d=W.local(r.value,i.value);d=d.minus({days:d.weekday-1}),p.value.querySelectorAll("td").forEach(g=>{let S=d.toISODate();g.firstElementChild.textContent=d.day,g.firstElementChild.dataset.date=S,d.month!=i.value?g.classList.add("outside"):g.classList.remove("outside"),S==_?g.classList.add("today"):g.classList.remove("today"),c.items.indexOf(S)!=-1?g.classList.add("has-entries"):g.classList.remove("has-entries"),o.value.indexOf(S)!=-1?g.classList.add("active"):g.classList.remove("active"),d=d.plus({days:1})})}function E(){--i.value<1&&(i.value=12,--r.value),L()}function z(){++i.value>12&&(i.value=1,++r.value),L()}function m(_){let d=_.target.dataset.date;if(c.mode=="toggle"){let g=o.value.indexOf(d);g==-1?o.value.push(d):o.value.splice(g,1)}else o.value=[d];p.value.querySelectorAll("td>button").forEach(g=>{o.value.indexOf(g.dataset.date)!=-1?g.parentNode.classList.add("active"):g.parentNode.classList.remove("active")}),F(),u("selection",o.value)}function F(){if(c.storage){let _=JSON.stringify(o.value);window.localStorage.setItem(c.storage,_)}}function I(){if(c.storage){let _=window.localStorage.getItem(c.storage);o.value=JSON.parse(_)||[]}!o.value.length&&c.mode!="toggle"&&(o.value=[W.now().toISODate()])}return t({onDay:m,selection:o}),Me(()=>{I()}),oe(()=>{L()}),(_,d)=>(h(),x("div",{class:P(["calendar",[s.mode]])},[e("div",null,[e("button",{class:"prev icon",onClick:E,disabled:!n(C)},[$(ye)],8,Sa),e("div",null,[ce(e("select",{class:"month","onUpdate:modelValue":d[0]||(d[0]=g=>i.value=g),onChange:L},[e("option",La,l(n(a)("month.1")),1),e("option",Ia,l(n(a)("month.2")),1),e("option",Ta,l(n(a)("month.3")),1),e("option",Ea,l(n(a)("month.4")),1),e("option",Fa,l(n(a)("month.5")),1),e("option",Ma,l(n(a)("month.6")),1),e("option",Da,l(n(a)("month.7")),1),e("option",za,l(n(a)("month.8")),1),e("option",Ra,l(n(a)("month.9")),1),e("option",Oa,l(n(a)("month.10")),1),e("option",Pa,l(n(a)("month.11")),1),e("option",Aa,l(n(a)("month.12")),1)],544),[[we,i.value,void 0,{number:!0}]]),ce(e("select",{class:"year","onUpdate:modelValue":d[1]||(d[1]=g=>r.value=g),onChange:L},[(h(!0),x(G,null,Q(n(v),g=>(h(),x("option",{value:g},l(g),9,Na))),256))],544),[[we,r.value,void 0,{number:!0}]])]),e("button",{class:"next icon",onClick:z,disabled:!n(k)},[$(ye)],8,Ua)]),e("table",{ref_key:"calendar",ref:p},[e("thead",null,[e("tr",null,[e("th",null,l(n(a)("day.cal1")),1),e("th",null,l(n(a)("day.cal2")),1),e("th",null,l(n(a)("day.cal3")),1),e("th",null,l(n(a)("day.cal4")),1),e("th",null,l(n(a)("day.cal5")),1),e("th",null,l(n(a)("day.cal6")),1),e("th",null,l(n(a)("day.cal7")),1)])]),e("tbody",null,[e("tr",null,[e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})])]),e("tr",null,[e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})])]),e("tr",null,[e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})])]),e("tr",null,[e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})])]),e("tr",null,[e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})])]),e("tr",null,[e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})]),e("td",null,[e("button",{onClick:m})])])])],512)],2))}};const ja={class:"unit"},Va=["disabled"],Ba=["value"],Ha={class:"unit"},Xa=["value"],qa=["value"],Wa=["value"],Ja=["value","disabled"],Ka={class:"unit"},Ga=["value"],Ya=["value"],Qa=["value"],Za={key:0},eo={key:1},to={props:["entries","nutrient","disabled"],setup(s,{expose:t}){const u=s,{t:c}=Y(),a=j("food"),i=j("prefs"),r=w("hour"),o=w("relative"),p=w(null),v=B(()=>{switch(r.value){case"hour":return k();case"day":return L();default:return[]}}),C=B(()=>{if(o.value=="relative")return"%";switch(u.nutrient){case"kcal":return" "+c("unit.cal");case"fat":case"carb":case"prot":return" "+c("unit.g");default:return" "+c("unit.mg")}});function k(){let d=[];if(u.entries){let g={};u.entries.forEach(S=>{let D=parseInt(S.time),N=W.fromObject({hours:D-D%2}),X=N.toFormat("t")+" - "+N.plus({hours:2}).toFormat("t");X in g||(g[X]={name:X,entries:[]});let V={id:S.food.id,name:c(S.food.id.toString()),amount:S.food.amount,nutrient:E(S.food),recipe:S.recipe,time:S.time,isrec:!1};if(S.recipe){let T=!1;g[X].entries.every(b=>b.isrec&&b.name==S.recipe?(b.entries.push(V),b.amount+=V.amount,b.nutrient+=V.nutrient,T=!0,!1):!0),T||g[X].entries.push({name:S.recipe,isrec:!0,amount:V.amount,nutrient:V.nutrient,entries:[V]})}else g[X].entries.push(V)}),d=Object.values(g)}return d}function L(){return[{name:"Morning",entries:[{type:"recipe"},{type:"single"}]},{name:"Noon",entries:[{type:"recipe"},{type:"single"}]}]}function E(d){let S=a.value.filter(N=>N.id==d.id)[0][u.nutrient]*d.amount*.01;if(o.value=="metric")return Math.round(S);let D=i.value.rdi[u.nutrient];return Math.round(S*100/D)}function z(){o.value=="relative"?o.value="metric":o.value=="metric"&&(o.value="relative")}function m(d){d.target.closest("div").classList.toggle("open")}function F(d){d.key=="Enter"&&(d.preventDefault(),I(d))}function I(d){d.target.blur();let g=parseFloat(d.target.value);(isNaN(g)||g<0)&&(d.target.value=0)}function _(){let d=new FormData(p.value),g=d.getAll("id"),S=d.getAll("amount"),D=d.getAll("recipe"),N=d.getAll("time"),X=[];return u.entries.forEach(V=>{for(let T=0;T<g.length;++T)if(g[T]==V.food.id&&D[T]==V.recipe&&N[T]==V.time){S[T]!=V.food.amount&&X.push({id:g[T],amount:S[T],recipe:D[T],time:N[T]});break}}),X}return t({getDiff:_}),(d,g)=>(h(),x("form",{class:"diary-entry-list",ref_key:"form",ref:p},[(h(!0),x(G,null,Q(n(v),S=>(h(),x("fieldset",{key:S.name},[e("legend",null,l(S.name),1),(h(!0),x(G,null,Q(S.entries,D=>(h(),x("div",{class:P({recipe:D.isrec})},[D.isrec?(h(),x(G,{key:0},[e("label",null,l(D.name),1),e("button",{class:"icon",type:"button",onClick:m},[$(De)]),e("span",null,l(D.amount),1),e("span",ja,l(n(c)("unit.g")),1),e("span",{class:P(["nutrient",[s.nutrient,o.value]])},l(D.nutrient)+l(n(C)),3),e("fieldset",{disabled:s.disabled,style:be({"--max-height":D.entries.length*41+"px"})},[(h(!0),x(G,null,Q(D.entries,N=>(h(),x("div",{key:N.id},[e("label",null,l(N.name),1),e("input",{type:"number",name:"amount",value:N.amount,onKeydown:F,onChange:I},null,40,Ba),e("span",Ha,l(n(c)("unit.g")),1),e("span",{class:P(["nutrient",[s.nutrient,o.value]])},l(N.nutrient)+l(n(C)),3),e("input",{type:"hidden",name:"id",value:N.id},null,8,Xa),e("input",{type:"hidden",name:"recipe",value:N.recipe},null,8,qa),e("input",{type:"hidden",name:"time",value:N.time},null,8,Wa)]))),128))],12,Va)],64)):(h(),x(G,{key:1},[e("label",null,l(D.name),1),e("input",{type:"number",name:"amount",value:D.amount,disabled:s.disabled,onKeydown:F,onChange:I},null,40,Ja),e("span",Ka,l(n(c)("unit.g")),1),e("span",{class:P(["nutrient",[s.nutrient,o.value]])},l(D.nutrient)+l(n(C)),3),e("input",{type:"hidden",name:"id",value:D.id},null,8,Ga),e("input",{type:"hidden",name:"recipe",value:D.recipe},null,8,Ya),e("input",{type:"hidden",name:"time",value:D.time},null,8,Qa)],64))],2))),256))]))),128)),e("button",{type:"button",class:"nutrient-mode-switch icon",onClick:z},[o.value=="relative"?(h(),x("span",Za,"%")):q("",!0),o.value=="metric"?(h(),x("span",eo,"g")):q("",!0)])],512))}};const no={class:"pie-chart"},lo={viewBox:"0 0 256 256"},ao=["transform","stroke-dasharray"],oo=["stroke-dasharray","transform"],so=["stroke-dasharray","transform"],io=e("hr",null,null,-1),fe={props:["start","range","value","max","label","unit","frac"],setup(s){const t=s,u=112,c=B(()=>+(parseFloat(t.value)||0).toFixed(t.frac||0)),a=B(()=>+(parseFloat(t.max)||0).toFixed(t.frac||0)),i=B(()=>`rotate(${-90+(parseFloat(t.start)||0)} 128 128)`),r=B(()=>{let v=(parseFloat(t.range)||0)/360;return Math.PI*2*u*v+" 710"}),o=B(()=>{let v=(parseFloat(t.value)||0)/(parseFloat(t.max)||1),C=parseFloat(t.range)||0,k=Math.min(v,1)*C/360;return Math.PI*2*u*k+" 710"}),p=B(()=>{let v=(parseFloat(t.value)||0)/(parseFloat(t.max)||1),C=parseFloat(t.range)||0,k=Math.min(Math.max(0,v-1),1)*C/360;return Math.PI*2*u*k+" 710"});return(v,C)=>(h(),x("figure",no,[(h(),x("svg",lo,[e("circle",{class:"base",r:"112",cx:"128",cy:"128",transform:n(i),"stroke-dasharray":n(r)},null,8,ao),e("circle",{class:"good",r:"112",cx:"128",cy:"128","stroke-dasharray":n(o),transform:n(i)},null,8,oo),e("circle",{class:"bad",r:"112",cx:"128",cy:"128","stroke-dasharray":n(p),transform:n(i)},null,8,so)])),e("div",null,[se(v.$slots,"details",{},()=>[e("span",null,l(n(c))+" "+l(s.unit),1),io,e("span",null,l(n(a))+" "+l(s.unit),1)])]),e("figcaption",null,l(s.label),1)]))}};const uo=e("hr",null,null,-1),ro=e("section",null,null,-1),co={id:"charts-week"},mo=["data-date"],vo={id:"charts-macro"},fo={class:"no-edit-mode"},ho={class:"subtitle no-edit-mode"},po={class:"tabs"},_o=["disabled"],go=e("hr",null,null,-1),bo={key:0},yo=["innerHTML"],$o={setup(s){const{t}=Y(),u=j("log"),c=j("csrfToken"),a=j("diary"),i=j("prefs"),r=w(null),o=w(W.now()),p=w("kcal"),v=w(!1),C=w(!1),k=w(null),L=w(null),E=w(null),z=B(()=>Object.keys(a.value)),m=B(()=>{let T=[],b=W.now().toISODate(),f=o.value.toISODate(),y=o.value.minus({days:o.value.weekday-1});for(let ee=0;ee<7;++ee){let M=y.toISODate();T.push({weekday:t("day.cal"+y.weekday),calday:y.day,date:M,active:M==f,today:M==b,value:a.value[M]?a.value[M].kcal:0}),y=y.plus({days:1})}return T});let F=!1;function I(T){T.stopPropagation(),T.preventDefault(),d(T.target.closest("ul"),T.movementX),F=!0}function _(T){T.stopPropagation(),T.preventDefault();let b=Math.max(-16,Math.min(-T.deltaY,16));d(T.target.closest("ul"),b)}function d(T,b){let f=parseInt(T.style.getPropertyValue("--offset"))||0,y=Math.max(T.clientWidth-T.scrollWidth,Math.min(f+b,0));T.style.setProperty("--offset",y+"px")}function g(T){let b=T.target.closest("ul");b.addEventListener("pointermove",I),b.addEventListener("mouseup",S),b.addEventListener("touchend",S),b.addEventListener("mouseleave",S),b.addEventListener("touchcancel",S),F=!1}function S(T){let b=T.target.closest("ul");b.removeEventListener("pointermove",I),b.removeEventListener("mouseup",S),b.removeEventListener("touchend",S),b.removeEventListener("mouseleave",S),b.removeEventListener("touchcancel",S)}function D(T){F||(p.value=T.target.dataset.name)}function N(){r.value&&r.value.entries&&(C.value?X():C.value=!0)}function X(){let T=L.value.getDiff();if(T.length==0){C.value=!1;return}v.value=!0;let b=r.value.date,f=new URLSearchParams;T.forEach(y=>{f.append("id",y.id),f.append("amount",y.amount),f.append("time",y.time),f.append("recipe",y.recipe)}),fetch(`/api/v1/diary/${b}`,{method:"PUT",body:f,headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":c}}).then(y=>{if(!y.ok)throw t("savediary.err"+y.status);return C.value=!1,fetch("/api/v1/diary/"+b.replaceAll("-","/"))}).then(y=>y.json()).then(y=>{y[0]&&y[0].kcal?a.value[b]=y[0]:delete a.value[b],V([b]),u.msg(t("savediary.ok"))}).catch(y=>u.err(y)).finally(()=>{setTimeout(function(){v.value=!1},500)})}function V(T){o.value=W.fromISO(T[0]);let b=o.value.toISODate();if(!a.value[b]){r.value={date:b};return}if(a.value[b].entries){r.value=a.value[b];return}fetch(`/api/v1/diary/${b.replaceAll("-","/")}/entries`).then(f=>f.json()).then(f=>{f.forEach(y=>y.time=y.date.split("T")[1].slice(0,5)),f.sort((y,ee)=>y.time<ee.time?-1:ee.time<y.time?1:0),a.value[b].entries=f}).catch(f=>u.err(f)).finally(()=>r.value=a.value[b])}return oe(()=>{V(k.value.selection)}),(T,b)=>(h(),J(de,{ref_key:"main",ref:E,class:P(["diary",{"edit-mode":C.value}]),onDetailVisibility:b[1]||(b[1]=f=>C.value=!1)},{filter:A(()=>[e("section",null,[e("h2",null,l(n(t)("aria.headcal")),1),$(Ne,{ref_key:"calendar",ref:k,storage:"caldiary",items:n(z),onSelection:V},null,8,["items"])]),uo,ro]),main:A(()=>[e("section",co,[(h(!0),x(G,null,Q(n(m),f=>(h(),x("button",{"data-date":f.date,class:P({today:f.today,active:f.active}),onClick:b[0]||(b[0]=(...y)=>k.value.onDay&&k.value.onDay(...y))},[$(fe,{range:"360",value:f.value,max:n(i).rdi.kcal},{details:A(()=>[e("span",null,l(f.weekday),1),e("span",null,l(f.calday),1)]),_:2},1032,["value","max"])],10,mo))),256))]),e("section",vo,[$(fe,{class:"kcal",start:"225",range:"270",frac:"0",label:n(t)("food.energy"),unit:n(t)("unit.cal"),value:r.value?r.value.kcal:0,max:n(i).rdi.kcal},null,8,["label","unit","value","max"]),$(fe,{class:"fat",start:"225",range:"270",frac:"0",label:n(t)("food.fat"),unit:n(t)("unit.g"),value:r.value?r.value.fat:0,max:n(i).rdi.fat},null,8,["label","unit","value","max"]),$(fe,{class:"carb",start:"225",range:"270",frac:"0",label:n(t)("food.carbs2"),unit:n(t)("unit.g"),value:r.value?r.value.carb:0,max:n(i).rdi.carb},null,8,["label","unit","value","max"]),$(fe,{class:"prot",start:"225",range:"270",frac:"0",label:n(t)("food.protein"),unit:n(t)("unit.g"),value:r.value?r.value.prot:0,max:n(i).rdi.prot},null,8,["label","unit","value","max"])])]),"head-details":A(()=>[e("h2",fo,l(o.value.weekdayLong),1)]),details:A(()=>[e("section",ho,l(o.value.toLocaleString(n(W).DATE_FULL)),1),e("section",po,[e("div",null,[e("ul",{onMousedown:g,onTouchstart:g,onWheel:_},[e("li",{class:P({active:p.value=="kcal"})},[e("button",{"data-name":"kcal",onClick:D},l(n(t)("food.energy")),1)],2),e("li",{class:P({active:p.value=="fat"})},[e("button",{"data-name":"fat",onClick:D},l(n(t)("food.fat")),1)],2),e("li",{class:P({active:p.value=="carb"})},[e("button",{"data-name":"carb",onClick:D},l(n(t)("food.carbs2")),1)],2),e("li",{class:P({active:p.value=="prot"})},[e("button",{"data-name":"prot",onClick:D},l(n(t)("food.protein")),1)],2)],32)]),e("button",{class:"icon async",disabled:v.value,onClick:N},[C.value?q("",!0):(h(),J(Ce,{key:0})),C.value?(h(),J($e,{key:1})):q("",!0)],8,_o)]),go,r.value?(h(),x("section",bo,[e("h2",null,l(n(t)("aria.headlog")),1),r.value.entries?q("",!0):(h(),x("p",{key:0,class:"msg-noitems",innerHTML:n(t)("diary.noitems")},null,8,yo)),r.value.entries?(h(),J(to,{key:1,ref_key:"entries",ref:L,entries:r.value.entries,nutrient:p.value,disabled:!C.value},null,8,["entries","nutrient","disabled"])):q("",!0)])):q("",!0)]),_:1},8,["class"]))}};const ko=["checked"],wo=e("div",null,null,-1),Le={props:["checked"],emits:["change","click"],setup(s,{emit:t}){function u(a){t("change",a)}function c(a){t("click",a)}return(a,i)=>(h(),x("label",null,[e("input",{type:"checkbox",checked:s.checked,onChange:u,onClick:c},null,40,ko),wo]))}},xo={class:"select"},Co={class:"select"},So=["innerHTML"],Lo=["onClick"],Io={class:"subtitle"},To={class:"s"},Eo={props:["items","offline"],emits:"selected",setup(s,{expose:t,emit:u}){const c=s,{t:a,locale:i}=Y();j("log");const r=j("csrfToken"),o=w("amount"),p=w("desc"),v=new Intl.Collator(i.value,{numeric:!0}),C=B(()=>p.value=="asc"?[...c.items].sort((I,_)=>v.compare(I[o.value],_[o.value])):[...c.items].sort((I,_)=>-v.compare(I[o.value],_[o.value]))),k=B(()=>c.items&&c.items.length?c.items.length==c.items.filter(I=>I.done).length:!1);he(()=>c.offline,z);function L(I){if(I.amount>999)var _=+parseFloat(I.amount*.001).toFixed(1),d=a("unit.kg");else var _=I.amount,d=a("unit.g");return`${_} <span class="unit">${d}</span>`}function E(I,_){I&&_?(o.value=I,p.value=_):o.value==I?p.value=p.value=="asc"?"desc":"asc":o.value=I}function z(){if(!c.offline){let I=new URLSearchParams;c.items.forEach(_=>{_.local&&(I.append("id",_.id),I.append("done",_.done))}),I.has("id")&&fetch("/api/v1/list/diary/done",{method:"PUT",body:I,headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":r}}).then(_=>{_.ok&&c.items.forEach(d=>d.local=!1)}).catch(()=>{})}}function m(I){let _=I.target.checked,d=new URLSearchParams;c.items.forEach(g=>{g.done=_,g.local=c.offline,d.append("id",g.id),d.append("done",g.done)}),c.offline||fetch("/api/v1/list/diary/done",{method:"PUT",body:d,headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":r}}).catch(()=>{})}function F(I){let _=I.target.closest("label").dataset.id,d=I.target.checked,g=c.items.filter(S=>S.id==_)[0];g.done=d,g.local=c.offline,c.offline||fetch("/api/v1/list/diary/done",{method:"PUT",body:new URLSearchParams({id:_,done:d}),headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":r}}).catch(()=>{})}return t({setSortCategory:E}),oe(z),(I,_)=>(h(),x("table",null,[e("thead",null,[e("tr",{class:P(p.value)},[e("th",xo,[$(Le,{checked:n(k),onClick:m},null,8,["checked"])]),e("th",{class:P(["num sort",{active:o.value=="amount"}]),onClick:_[0]||(_[0]=d=>E("amount"))},[$(ae),U(" "+l(n(a)("food.amount")),1)],2),e("th",{class:P(["name sort",{active:o.value=="name"}]),onClick:_[1]||(_[1]=d=>E("name"))},[U(l(n(a)("food.name"))+" ",1),$(ae)],2),e("th",{class:P(["s sort",{active:o.value=="aisle"}]),onClick:_[2]||(_[2]=d=>E("aisle"))},[U(l(n(a)("food.aisle"))+" ",1),$(ae)],2)],2)]),e("tbody",null,[(h(!0),x(G,null,Q(n(C),d=>(h(),x("tr",{key:d.id,class:P({done:d.done})},[e("td",Co,[$(Le,{"data-id":d.id,checked:d.done,onChange:F},null,8,["data-id","checked"])]),e("td",{class:"num",innerHTML:L(d)},null,8,So),e("td",{class:"name",onClick:g=>I.$emit("selected",d.id)},[e("span",null,l(d.name),1),e("div",Io,l(n(a)("aisle."+d.aisle)),1)],8,Lo),e("td",To,l(n(a)("aisle."+d.aisle)),1)],2))),128))])]))}};const Fo=e("hr",null,null,-1),Mo=e("section",null,null,-1),Do={value:"",disabled:"",selected:"",hidden:""},zo={value:"aisle asc"},Ro={value:"aisle desc"},Oo=e("span",{class:"spacer"},null,-1),Po={setup(s){const{t}=Y(),u=j("log"),c=j("diary"),a=w([]),i=w(!1),r=w(null),o=w(null),p=w(null),v=B(()=>Object.keys(c.value));let C;he(a,d=>F(),{deep:!0});function k(d){if(d.length==0){a.value=[];return}if(i.value)return;let g=new URLSearchParams(d.map(S=>["date",S]));fetch("/api/v1/list/diary?"+g).then(S=>{if(!S.ok)throw t("getlist.err"+S.status);return S.json()}).then(S=>{S.forEach(D=>{D.name=t(D.id.toString());let N=a.value.filter(X=>X.id==D.id)[0];N&&N.local&&(D.local=!0,D.done=N.done)}),a.value=S}).catch(S=>u.err(S))}function L(){i.value||(i.value=!0,u.warn(t("conn.off")))}function E(){i.value&&(i.value=!1,u.msg(t("conn.on")))}function z(d){let[g,S]=d.target.value.split(" ");p.value.setSortCategory(g,S),d.target.selectedIndex=0}function m(d){r.value.showDetails()}function F(){let d=JSON.stringify(a.value);window.localStorage.setItem("listdiary",d)}function I(){let d=window.localStorage.getItem("listdiary")||"[]";a.value=JSON.parse(d)}function _(){return fetch("/ping",{method:"HEAD"}).then(E,L)}return Me(()=>{I()}),oe(()=>{C=setInterval(_,15e3),_().then(()=>k(o.value.selection))}),je(()=>{clearInterval(C)}),(d,g)=>(h(),J(de,{ref_key:"main",ref:r},{filter:A(()=>[e("section",{class:P({offline:i.value})},[e("h2",null,l(n(t)("aria.headcal")),1),$(Ne,{ref_key:"calendar",ref:o,mode:"toggle",storage:"calshop",items:n(v),onSelection:k},null,8,["items"])],2),Fo,Mo]),controls:A(()=>[e("select",{class:"sort s",onChange:z},[e("option",Do,l(n(t)("sort.hint")),1),e("option",zo,l(n(t)("food.aisle"))+" "+l(n(t)("sort.asc")),1),e("option",Ro,l(n(t)("food.aisle"))+" "+l(n(t)("sort.desc")),1)],32),Oo]),main:A(()=>[$(Eo,{ref_key:"list",ref:p,items:a.value,offline:i.value,onSelected:m},null,8,["items","offline"])]),_:1},512))}},Ao=U(" Profile "),No={setup(s){return(t,u)=>(h(),J(de,null,{main:A(()=>[Ao]),_:1}))}},Uo=U(" Settings "),jo={setup(s){return(t,u)=>(h(),J(de,null,{main:A(()=>[Uo]),_:1}))}},Vo=Ve({history:Be(),routes:[{path:"/",name:"diary",component:$o},{path:"/recipes",name:"recipes",component:Ca},{path:"/food",name:"food",component:El},{path:"/shopping",name:"shopping",component:Po},{path:"/profile",name:"profile",component:No},{path:"/settings",name:"settings",component:jo}]});let pe=document.documentElement.lang||navigator.language;!pe&&navigator.languages!=null&&(pe=navigator.languages[0]);He.defaultLocale=pe;const Ie=document.querySelector("meta[name='_csrf']"),Bo=Ie?Ie.content:"",Ho=function(){const s=document.documentElement.dataset.perm||1,t=65536,u=131072;function c(a){return(s&a)==a}return{canCreateFood:c(t),canEditFood:c(u)}}(),Xo=function(){function s(t){return typeof t=="string"?t:"message"in t?t.message:ne.global.t("err.err")}return{msg:function(t){let u={msg:s(t),timeout:3e3};window.dispatchEvent(new CustomEvent("message",{detail:u}))},warn:function(t){let u={msg:s(t),timeout:4e3};window.dispatchEvent(new CustomEvent("warning",{detail:u}))},err:function(t){let u={msg:s(t),timeout:5e3};window.dispatchEvent(new CustomEvent("error",{detail:u}))}}}(),te=Xe(Ft);let ne,ie,me,ue,ve;function Te(s){ne=qe({legacy:!1,locale:pe,fallbackLocale:"en",messages:s}),ie&&me&&ue&&ve&&_e()}function qo(s){ie=s,ne&&me&&ue&&ve&&_e()}function Wo(s){me=s,ne&&ie&&ue&&ve&&_e()}function Jo(s){ue={},s.forEach(t=>ue[t.date]=t),ne&&ie&&me&&ve&&_e()}function Ee(s){ve=s,ne&&ie&&me&&ue&&_e()}function _e(){ie.forEach(s=>{s.name=ne.global.t(s.id.toString()),s.cat=ne.global.t("cat."+s.cat)}),te.provide("csrfToken",Bo),te.provide("perms",Ho),te.provide("food",w(ie)),te.provide("recipes",w(me)),te.provide("diary",w(ue)),te.provide("prefs",w(ve)),te.provide("log",Xo),te.use(Vo),te.use(ne),te.mount("#app")}fetch(`/app/l10n/${pe}.json`).then(s=>s.json()).then(Te).catch(()=>{fetch("/app/l10n/en.json").then(s=>s.json()).then(Te)});fetch("/api/v1/foods").then(s=>s.json()).then(qo);fetch("/api/v1/recipes").then(s=>s.json()).then(Wo);fetch("/api/v1/diary").then(s=>s.json()).then(Jo);fetch("/api/v1/prefs").then(s=>s.json()).then(Ee).catch(()=>{Ee({rdi:{kcal:2e3,fat:60,carb:270,prot:80},ui:{neutralCharts:!1}})});
