import{o as f,c as S,a as e,u as G,i as U,b as $,w as N,d as P,t as a,e as n,R as ie,f as ce,g as J,h as q,n as A,r as C,F as Y,j as te,k as Ae,l as H,m as ue,p as he,q as ge,s as re,v as xe,x as ke,D as V,y as Ee,z as Pe,A as Ne,B as Ue,S as Ve,C as je,E as Be}from"./vendor.js";const He=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))d(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const r of u.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&d(r)}).observe(document,{childList:!0,subtree:!0});function o(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerpolicy&&(u.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?u.credentials="include":l.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function d(l){if(l.ep)return;l.ep=!0;const u=o(l);fetch(l.href,u)}};He();var Q=(i,t)=>{const o=i.__vccOpts||i;for(const[d,l]of t)o[d]=l;return o};const Xe={},qe={width:"512",height:"512",version:"1.1",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},We=e("path",{d:"m114.6 507.3c13.82-0.8729 90.06-3.083 106.2-3.079h13.49l2.639-5.293c5.191-10.41 10.35-29.57 13.13-48.74 1.811-12.5 1.488-16.68-1.826-23.56-2.528-5.249-11.04-13.06-20.54-18.86-28.38-17.32-51.21-34.77-76.05-58.12-6.673-6.272-9.377-8.209-16.08-11.53-12.37-6.124-20.36-12.88-29.19-24.7-1.45-1.941-1.795-2.038-4.695-1.334-1.722 0.4182-7.18 0.8166-12.13 0.8854-19.6 0.2722-38.18-7.715-52.49-22.56-15.97-16.57-23.43-35.49-23.41-59.37 0.01786-16.86 3.547-29.88 11.93-44 9.617-16.19 27.39-30.13 43.89-34.41 2.517-0.653 4.748-1.36 4.958-1.571 0.2103-0.2107-0.05169-3.078-0.5816-6.371-1.41-8.759-0.556-21.84 1.997-30.61 7.023-24.1 24.96-41.95 48.52-48.31 11.42-3.082 29.45-2.167 40.42 2.049 0.919 0.3533 1.637-0.7202 2.994-4.474 6.21-17.18 18.79-33.75 33.11-43.62 35.65-24.56 80.99-19.9 111.3 11.44l5.539 5.719 5.025-1.229c2.764-0.6762 9.075-1.428 14.02-1.672 16.17-0.7944 31.64 3.865 45.31 13.64l5.1 3.647 12.55 0.1171c9.984 0.09312 13.77 0.4491 18.49 1.739 29.1 7.945 50.37 32.58 56 64.86 1.354 7.764 1.096 21.6-0.5502 29.5l-0.916 4.394 5.367 7.086c20.1 26.54 25.52 61.05 14.68 93.52-7.862 23.55-24.99 43.53-46.38 54.11-10.16 5.023-23.1 8.587-31.28 8.613-3.79 0.0118-4.555 0.333-8.217 3.446-6.958 5.916-20.59 13.71-28.3 16.17-1.722 0.551-4.011 1.599-5.087 2.328-1.076 0.7297-8.119 4.802-15.65 9.05-18.57 10.47-37.53 22.69-48.72 31.39-13.27 10.32-16.83 22.63-14.72 50.94 2.648 35.64 8.059 59.41 16.33 71.75l2.89 4.313 29.4 0.4963c34.14 0.5764 92.53 2.291 93.01 2.731 0.1793 0.166-74.3 0.2503-165.5 0.1877-91.21-0.0631-161.4-0.392-156-0.732zm130.9-101.8c-0.1092-1.007-3.147-5.947-6.75-10.98-7.889-11.01-19.71-28.99-22.37-34.01-1.594-3.014-2.402-3.727-4.695-4.139-7.259-1.304-17.91-5.324-27.58-10.41-1.809-0.9509 5.669 20.15 9.032 25.49 4.859 7.714 27.69 24.94 45.08 34 5.177 2.7 7.575 2.715 7.285 0.0442zm6.168-19.46c0.8235-0.9976 1.074-4.638 1.074-15.62 0-7.875-0.1764-14.5-0.3923-14.71-0.2158-0.2163-2.307 0.1044-4.647 0.7128-2.34 0.6082-7 1.335-10.35 1.616-7.067 0.5907-6.896 0-2.984 10.28 2.73 7.17 6.328 12.81 10.4 16.3 3.513 3.013 5.293 3.38 6.908 1.424zm49.91-15.13c3.913-2 11.37-9.412 15.96-15.85 3.982-5.592 8.688-15 8.214-16.42-0.1628-0.49-3.275-1.75-6.916-2.799-3.641-1.049-9.568-3.501-13.17-5.449l-6.551-3.541-2.173 2.087c-2.148 2.062-2.179 2.234-2.645 14.37-0.2592 6.754-0.6282 15.17-0.8198 18.7-0.3026 5.572-0.1405 6.682 1.232 8.43 1.896 2.415 2.946 2.489 6.867 0.484zm-118.1-5.725c-2.19-4.729-6.256-17.66-6.256-19.89 0-0.8683-1.901-1.089-9.391-1.089-5.165 0-9.391 0.2195-9.391 0.488 0 1.561 25.33 25.39 26.99 25.39 0.1762 0-0.7011-2.206-1.949-4.901zm149.8-9.536c5.487-3.687 19.46-14.65 19.07-14.96-0.126-0.1032-4.197-0.3888-9.046-0.6338l-8.816-0.4452-3.967 5.891c-4.284 6.363-7.088 11.99-6.473 12.98 0.9066 1.47 4.434 0.3864 9.228-2.836z",fill:"#13ad73"},null,-1),Je=e("path",{d:"m253.9 167.7c-0.2579 0.0513-1.238 0.5454-4.691 0.5216-3.625-0.0248 4.941 9.227 6.934 34.4-8.031-0.4678-8.408-3.285-24.81-5.999-15.88-2.627-25.28 5.883-29.57 18.88-3.429 10.39-3.592 23.66-1.19 36.39 2.348 12.45 7.148 24.39 13.74 32.65 6.909 8.654 14.05 10.96 20.49 10.82 8.459-0.1842 15.7-4.599 19.58-4.407 6.726 0.3331 13.29 8.894 28.17 2.151 6.047-2.741 12.03-7.819 17.08-14.81 4.984-6.907 9.051-15.68 11.35-25.91 2.018-8.972 2.678-19.07 1.41-30-1.616-13.93-7.519-20.42-14.9-23.01-8.286-2.905-18.43-0.8896-26.46 1.032-4.71 1.127-8.69 2.223-11.14 2.273-0.155 3e-3 -0.2829-4.1e-4 -0.4335 2e-3 -0.01-0.0695-0.0197-0.1385-0.0323-0.2078-2.249-11.58-4.704-29.29-5.401-33.64-0.152-0.9486 0.0845-1.177-0.1162-1.137z",fill:"#f2ac05","fill-rule":"evenodd"},null,-1),Ke=[We,Je];function Ye(i,t){return f(),S("svg",qe,Ke)}var Ge=Q(Xe,[["render",Ye]]);const Qe={},Ze={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},et=e("path",{d:"m12 0c-6.624 0-12 5.376-12 12s5.376 12 12 12 12-5.376 12-12-5.376-12-12-12zm0 3.6c1.992 0 3.6 1.608 3.6 3.6s-1.608 3.6-3.6 3.6-3.6-1.608-3.6-3.6 1.608-3.6 3.6-3.6zm0 17.04c-3 0-5.652-1.536-7.2-3.864 0.036-2.388 4.8-3.696 7.2-3.696 2.388 0 7.164 1.308 7.2 3.696-1.548 2.328-4.2 3.864-7.2 3.864z"},null,-1),tt=[et];function nt(i,t){return f(),S("svg",Ze,tt)}var at=Q(Qe,[["render",nt]]);const lt={},ot={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},st=e("path",{d:"m12 0-2.115 2.115 8.37 8.385h-18.255v3h18.255l-8.37 8.385 2.115 2.115 12-12z"},null,-1),it=[st];function ut(i,t){return f(),S("svg",ot,it)}var be=Q(lt,[["render",ut]]);const rt=e("div",{id:"app-name"},[e("span",null,"Hey"),e("span",null,[P("Apple"),e("sup",null,"beta")])],-1),ct={id:"nav-main"},dt={id:"nav-user"},mt={href:"https://docs.heyapple.org",target:"_blank"},vt={setup(i){const{t}=G(),o=U("csrfToken");function d(u){u.preventDefault(),fetch("/auth/local",{method:"DELETE",headers:{"X-CSRF-Token":o}}).then(r=>{r.ok?window.location="/":window.dispatchEvent(new CustomEvent("error",{detail:{msg:t("signout.err"+r.status)}}))})}function l(u){u.stopPropagation(),document.querySelector("header nav").classList.toggle("open")}return document.addEventListener("click",function(){document.querySelector("header nav").classList.remove("open")}),(u,r)=>(f(),S("header",null,[$(Ge,{id:"logo"}),rt,e("nav",null,[e("button",{onClick:l},[$(be)]),e("ul",ct,[e("li",null,[$(n(ie),{to:"/"},{default:N(()=>[P(a(n(t)("nav.diary")),1)]),_:1})]),e("li",null,[$(n(ie),{to:"/food"},{default:N(()=>[P(a(n(t)("nav.food")),1)]),_:1})]),e("li",null,[$(n(ie),{to:"/recipes"},{default:N(()=>[P(a(n(t)("nav.recipes")),1)]),_:1})]),e("li",null,[$(n(ie),{to:"/shopping"},{default:N(()=>[P(a(n(t)("nav.shopping")),1)]),_:1})])]),e("ul",dt,[e("li",null,[$(n(ie),{to:"/profile"},{default:N(()=>[P(a(n(t)("nav.profile")),1)]),_:1})]),e("li",null,[$(n(ie),{to:"/settings"},{default:N(()=>[P(a(n(t)("nav.settings")),1)]),_:1})]),e("li",null,[e("a",mt,a(n(t)("nav.help")),1)]),e("li",null,[e("a",{href:"#",onClick:d},a(n(t)("nav.signout")),1)])])]),e("button",{onClick:l},[$(at)])]))}},ft={},ht={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},_t=e("path",{d:"m7.6364 17.318-5.7273-5.7273-1.9091 1.9091 7.6364 7.6364 16.364-16.364-1.9091-1.9091z"},null,-1),pt=[_t];function gt(i,t){return f(),S("svg",ht,pt)}var we=Q(ft,[["render",gt]]);const bt={},yt={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},wt=e("path",{d:"m12 1.6364-12 20.727h24zm0 4.353 8.2159 14.192h-16.43zm-1.0909 4.3743v5.4545h2.1818v-5.4545zm0 6.5455v2.1818h2.1818v-2.1818z"},null,-1),$t=[wt];function kt(i,t){return f(),S("svg",yt,$t)}var xt=Q(bt,[["render",kt]]);const Ct={props:["msg"],emits:["timeout"],setup(i,{emit:t}){const o=i;return ce(()=>{setTimeout(function(){t("timeout",o.msg.id)},o.msg.time)}),(d,l)=>(f(),S("div",{class:A(["message",[i.msg.type,i.msg.id]])},[i.msg.type=="message"?(f(),J(we,{key:0})):q("",!0),i.msg.type!="message"?(f(),J(xt,{key:1})):q("",!0),e("p",null,a(i.msg.msg),1)],2))}};const St={id:"messages"},Lt={setup(i){const t=C([]);let o=0;function d(u){t.value.push({id:o++,type:u.type,msg:u.detail.msg,time:u.detail.timeout})}function l(u){t.value=t.value.filter(r=>r.id!=u)}return ce(()=>{window.addEventListener("message",d),window.addEventListener("warning",d),window.addEventListener("error",d)}),(u,r)=>(f(),S("div",St,[(f(!0),S(Y,null,te(t.value,s=>(f(),J(Ct,{key:s.id,msg:s,onTimeout:l},null,8,["msg"]))),128))]))}};const Tt={setup(i){return ce(()=>{document.querySelector("body > .spinner-container").remove()}),(t,o)=>(f(),S(Y,null,[$(vt),$(n(Ae)),$(Lt)],64))}},It={},Et={version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Mt=e("path",{id:"path-top",d:"m0 3v2h24v-2z"},null,-1),Ft=e("path",{id:"path-mid",d:"m0 13h24v-2h-24z"},null,-1),Dt=e("path",{id:"path-bottom",d:"m0 21h24v-2h-24z"},null,-1),zt=[Mt,Ft,Dt];function Rt(i,t){return f(),S("svg",Et,zt)}var Ot=Q(It,[["render",Rt]]);const At={},Pt={width:"512",height:"512",version:"1.1",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},Nt=e("path",{d:"m251.2 4.007c-17.24-0.2277-34.69 4.924-50.29 15.67-14.33 9.866-26.9 26.43-33.11 43.62-1.357 3.754-2.073 4.828-2.992 4.475-10.97-4.217-29-5.131-40.42-2.049-23.57 6.359-41.5 24.22-48.52 48.31-2.553 8.761-3.407 21.84-1.997 30.6 0.5299 3.293 0.7902 6.162 0.5799 6.372-0.2104 0.2108-2.439 0.9186-4.956 1.572-16.5 4.283-34.28 18.21-43.89 34.41-8.382 14.11-11.91 27.14-11.93 44-0.02401 23.88 7.433 42.79 23.41 59.36 14.31 14.85 32.89 22.84 52.49 22.56 4.95-0.0689 10.41-0.4681 12.13-0.8863 2.9-0.7045 3.245-0.6061 4.695 1.334 8.833 11.82 16.82 18.58 29.19 24.7 6.707 3.32 9.412 5.257 16.09 11.53 24.85 23.35 47.68 40.8 76.05 58.12 9.503 5.8 18.01 13.61 20.54 18.86 3.313 6.878 3.637 11.06 1.825 23.56-2.778 19.18-7.936 38.33-13.13 48.74l-2.639 5.295h-13.49c-16.17-3e-3 -92.41 2.205-106.2 3.077l0.01-3e-3c-5.381 0.3399 64.84 0.6684 156 0.7315 91.2 0.0625 165.7-0.0216 165.5-0.1878-0.4753-0.4399-58.86-2.155-93-2.731l-29.4-0.4942-2.89-4.313c-8.274-12.35-13.68-36.12-16.33-71.76-2.105-28.31 1.454-40.62 14.72-50.94 11.18-8.699 30.14-20.92 48.72-31.39 7.533-4.248 14.57-8.318 15.65-9.048 1.076-0.7296 3.366-1.779 5.087-2.33 7.71-2.467 21.34-10.26 28.3-16.17 3.662-3.113 4.427-3.435 8.218-3.446 8.183-0.0267 21.12-3.59 31.28-8.613 21.39-10.58 38.52-30.56 46.38-54.11 10.84-32.47 5.42-66.98-14.68-93.52l-5.364-7.084 0.916-4.395c1.646-7.896 1.904-21.74 0.5502-29.5-5.632-32.29-26.9-56.92-56-64.86-4.726-1.29-8.51-1.647-18.49-1.74l-12.55-0.1186-5.101-3.647c-13.67-9.776-29.15-14.43-45.31-13.64-4.95 0.2432-11.26 0.9944-14.02 1.671l-5.028 1.229-5.539-5.72c-17.07-17.63-38.89-26.81-61.05-27.1zm2.728 163.7c0.2008-0.0398-0.0367 0.1881 0.1154 1.137 0.6972 4.35 3.151 22.06 5.4 33.64 0.0118 0.0694 0.0228 0.138 0.0328 0.2076 0.1506-2e-3 0.2799 9e-5 0.4349-3e-3 2.448-0.0501 6.427-1.143 11.14-2.27 8.028-1.922 18.18-3.94 26.46-1.035 7.379 2.587 13.28 9.078 14.9 23.01 1.268 10.94 0.6106 21.03-1.407 30-2.301 10.23-6.37 19.01-11.35 25.91-5.045 6.991-11.03 12.07-17.07 14.81-14.87 6.743-21.44-1.818-28.16-2.152-3.88-0.1922-11.12 4.224-19.58 4.409-6.437 0.1402-13.58-2.169-20.49-10.82-6.596-8.262-11.39-20.2-13.74-32.65-2.402-12.73-2.24-26 1.189-36.39 4.29-13 13.69-21.51 29.58-18.88 16.41 2.714 16.78 5.532 24.81 6-1.993-25.18-10.56-34.43-6.936-34.4 3.453 0.0238 4.434-0.4726 4.692-0.5239zm45.16 159.1 6.55 3.542c3.603 1.947 9.529 4.401 13.17 5.45 3.641 1.049 6.753 2.307 6.916 2.797 0.4733 1.423-4.232 10.83-8.214 16.42-4.588 6.442-12.05 13.85-15.96 15.86-3.919 2.004-4.971 1.93-6.867-0.4843-1.372-1.748-1.532-2.86-1.229-8.432 0.1916-3.529 0.558-11.94 0.8171-18.7 0.4657-12.13 0.4983-12.3 2.646-14.37zm35.38 12.77 8.817 0.4448c4.849 0.245 8.919 0.5294 9.045 0.6326 0.3835 0.315-13.58 11.27-19.07 14.96-4.795 3.222-8.322 4.307-9.229 2.837-0.6151-0.9971 2.187-6.619 6.471-12.98zm-166.7 4.596c7.489 0 9.391 0.219 9.391 1.087 0 2.234 4.067 15.16 6.257 19.89 1.248 2.694 2.123 4.9 1.947 4.9-1.66 0-26.99-23.83-26.99-25.39 0-0.2685 4.226-0.4876 9.391-0.4876zm16.13 1.727c0.0388-0.0118 0.0851-6e-3 0.1417 0.0231 9.674 5.087 20.32 9.107 27.58 10.41 2.293 0.4121 3.101 1.124 4.695 4.138 2.657 5.026 14.48 23 22.37 34.02 3.603 5.03 6.639 9.968 6.748 10.98 0.2897 2.671-2.108 2.658-7.285-0.0429-17.39-9.068-40.22-26.29-45.07-34.01-3.258-5.172-10.38-25.14-9.173-25.52zm67.9 9.71c0.263-9e-3 0.4337 9e-3 0.4876 0.0625 0.2159 0.2154 0.3921 6.837 0.3921 14.71 0 10.98-0.2506 14.62-1.074 15.62-1.615 1.956-3.397 1.59-6.909-1.423-4.068-3.49-7.665-9.13-10.4-16.3-3.912-10.28-4.082-9.686 2.985-10.28 3.355-0.2804 8.013-1.006 10.35-1.615 1.755-0.4562 3.373-0.7502 4.162-0.7776z"},null,-1),Ut=[Nt];function Vt(i,t){return f(),S("svg",Pt,Ut)}var jt=Q(At,[["render",Vt]]);const Bt={},Ht={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Xt=e("path",{d:"m12 6c1.65 0 3-1.35 3-3s-1.35-3-3-3-3 1.35-3 3 1.35 3 3 3zm0 3c-1.65 0-3 1.35-3 3s1.35 3 3 3 3-1.35 3-3-1.35-3-3-3zm0 9c-1.65 0-3 1.35-3 3s1.35 3 3 3 3-1.35 3-3-1.35-3-3-3z"},null,-1),qt=[Xt];function Wt(i,t){return f(),S("svg",Ht,qt)}var Me=Q(Bt,[["render",Wt]]);const Jt={id:"filter"},Kt=P(" This is the main search & filter area"),Yt={id:"main"},Gt={class:"controls"},Qt=e("span",{class:"spacer"},null,-1),Zt={class:"content"},en=P("This is the main area"),tn={id:"details"},nn={class:"controls"},an=e("span",{class:"spacer"},null,-1),ln={class:"placeholder"},de={emits:["detailVisibility"],setup(i,{expose:t,emit:o}){const{t:d}=G(),l=U("prefs"),u=C(!1),r=C(!1),s=H(()=>({"open-filter":u.value,"open-details":r.value,"neutral-charts":l.value.ui.neutralCharts}));function k(){u.value?u.value=!1:(u.value=!0,r.value=!1,o("detailVisibility"))}function h(){o("detailVisibility"),r.value?r.value=!1:(r.value=!0,u.value=!1)}function x(){o("detailVisibility"),r.value||(r.value=!0,u.value=!1)}return t({showDetails:x}),(_,L)=>(f(),S("main",{class:A(n(s))},[e("div",Jt,[ue(_.$slots,"filter",{},()=>[Kt])]),e("div",Yt,[e("div",Gt,[e("button",{onClick:k,class:"open-filter icon"},[$(Ot)]),Qt,e("button",{onClick:h,class:"open-details icon"},[$(Me)])]),e("div",Zt,[ue(_.$slots,"main",{},()=>[en])])]),e("div",tn,[e("div",nn,[ue(_.$slots,"head-details"),an,e("button",{onClick:h,class:"open-details icon"},[$(be)])]),ue(_.$slots,"details",{},()=>[e("div",ln,[$(jt),e("p",null,a(n(d)("details.noitem")),1)])])])],2))}},on=["placeholder"],sn=P("Additional filters"),Fe={props:["data","placeholder"],emits:["result"],setup(i,{emit:t}){const o=i;var d=void 0;function l(r){r.preventDefault(),clearTimeout(d),d=setTimeout(function(){u(r.target.closest("form"))},500)}function u(r){let s=new FormData(r),k=o.data.filter(h=>{let x=h.size||1;for(let _ of s.keys()){if(_=="name"){let D=s.get(_).toLowerCase();if(!h[_].toLowerCase().includes(D))return!1;continue}let[L,I]=s.getAll(_).map(D=>parseFloat(D));if(!isNaN(L)&&!isNaN(I)&&(h[_]/x<L||I<h[_]/x))return!1}return!0});t("result",k)}return(r,s)=>(f(),S("form",null,[e("input",{type:"text",name:"name",autocomplete:"off",placeholder:i.placeholder,onInput:l},null,40,on),ue(r.$slots,"default",{confirm:l},()=>[sn])]))}};const un={class:"slider"},rn=["name","value"],cn=P(" \xA0\u2013\xA0 "),dn=["name","value"],mn={class:"bar"},vn={class:"slide"},fn=e("div",{class:"interact-area"},null,-1),hn=[fn],_n=e("div",{class:"interact-area"},null,-1),pn=[_n],K={props:["label","name","unit","min","max","frac"],emits:["input"],setup(i,{emit:t}){const o=i,{t:d}=G(),l=C(parseFloat(o.min).toFixed(o.frac)),u=C(parseFloat(o.max).toFixed(o.frac)),r=C(0),s=C(100);he(()=>o.min,(c,E)=>k(c)),he(()=>o.max,(c,E)=>h(c));function k(c){let E=parseFloat(o.min)||0,w=parseFloat(c)||E;l.value=w,u.value=Math.max(l.value,u.value);let p=parseFloat(o.max)||0;r.value=(w-E)*100/(p-E),s.value=Math.max(r.value,s.value)}function h(c){let E=parseFloat(o.max)||0,w=parseFloat(c)||E;u.value=w,l.value=Math.min(l.value,u.value);let p=parseFloat(o.min)||0;s.value=(w-p)*100/(E-p),r.value=Math.min(r.value,s.value)}function x(c){c.target.blur(),k(c.target.value),t("input",c)}function _(c){c.target.blur(),h(c.target.value),t("input",c)}function L(c){let w=c.target.closest(".slide").getBoundingClientRect(),p=c.pageX!==void 0?c.pageX:c.changedTouches[0].pageX;p=Math.min(Math.max(p-w.left,0),w.width);let m=p*100/w.width,b=parseFloat(o.min)||0,M=parseFloat(o.max)||0,R=m/100*(M-b)+b;c.target.closest("button").classList.contains("min")?(l.value=R.toFixed(o.frac),u.value=Math.max(l.value,u.value),r.value=m,s.value=Math.max(r.value,s.value)):(u.value=R.toFixed(o.frac),l.value=Math.min(l.value,u.value),s.value=m,r.value=Math.min(r.value,s.value)),t("input",c)}function I(c){let E=c.target.closest("button");E.addEventListener("mousemove",L),E.addEventListener("touchmove",L),E.addEventListener("mouseup",D),E.addEventListener("touchend",D),E.addEventListener("mouseleave",D),E.addEventListener("touchcancel",D),E.classList.add("active")}function D(c){let E=c.target.closest("button");E.removeEventListener("mousemove",L),E.removeEventListener("touchmove",L),E.removeEventListener("mouseup",D),E.removeEventListener("touchend",D),E.removeEventListener("mouseleave",D),E.removeEventListener("touchcancel",D),E.classList.remove("active")}return(c,E)=>(f(),S("div",un,[e("label",null,[e("span",null,a(i.label)+" ("+a(n(d)("unit."+i.unit))+")",1),e("input",{type:"text",name:i.name,value:l.value,onChange:x},null,40,rn),cn,e("input",{type:"text",name:i.name,value:u.value,onChange:_},null,40,dn)]),e("div",mn,[e("div",vn,[e("div",{class:"overlay",style:ge({left:r.value+"%",right:100-s.value+"%"})},null,4),e("button",{type:"button",class:"handle min",style:ge({left:r.value+"%"}),onMousedown:I,onTouchstart:I},hn,36),e("button",{type:"button",class:"handle max",style:ge({left:s.value+"%"}),onMousedown:I,onTouchstart:I},pn,36)])])]))}};const gn={class:"clickable-input"},bn=["placeholder"],yn=["value"],De={props:["label","placeholder"],emits:["confirm"],setup(i,{emit:t}){const o=C("");function d(l){l.preventDefault(),t("confirm",o.value),o.value=""}return(l,u)=>(f(),S("form",gn,[re(e("input",{type:"text",autocomplete:"off","onUpdate:modelValue":u[0]||(u[0]=r=>o.value=r),placeholder:i.placeholder},null,8,bn),[[xe,o.value]]),e("input",{type:"submit",onClick:d,value:i.label},null,8,yn)]))}};const wn={class:"clickable-select"},$n={value:"0",selected:""},kn=["value"],xn=["disabled"],Cn={props:["label","placeholder","items","disabled"],emits:["confirm"],setup(i,{emit:t}){const o=i,{locale:d}=G(),l=C(0),u=new Intl.Collator(d.value,{numeric:!0}),r=H(()=>[...o.items].sort((k,h)=>u.compare(k.name,h.name)));function s(k){k.preventDefault(),l.value&&t("confirm",l.value)}return(k,h)=>(f(),S("form",wn,[re(e("select",{"onUpdate:modelValue":h[0]||(h[0]=x=>l.value=x)},[e("option",$n,a(i.placeholder),1),(f(!0),S(Y,null,te(n(r),x=>(f(),S("option",{key:x.id,value:x.id},a(x.name),9,kn))),128))],512),[[ke,l.value]]),e("button",{type:"submit",class:"async",onClick:s,disabled:i.disabled},a(i.label),9,xn)]))}};const Sn={class:"clickable-date"},Ln=["value"],Tn=["value"],In=["disabled"],ze={props:["label","date","time","disabled"],emits:["confirm"],setup(i,{emit:t}){function o(d){d.preventDefault();let l=new FormData(d.target.closest("form"));t("confirm",l.get("date"),l.get("time"))}return(d,l)=>(f(),S("form",Sn,[e("input",{type:"date",name:"date",value:i.date},null,8,Ln),e("input",{type:"time",name:"time",value:i.time},null,8,Tn),e("button",{type:"submit",class:"async",onClick:o,disabled:i.disabled},a(i.label),9,In)]))}};const En={},Mn={class:"icon sort-arrow"};function Fn(i,t){return f(),S("span",Mn)}var ae=Q(En,[["render",Fn]]);const Dn=["onClick"],zn={class:"name"},Rn={class:"num"},On={class:"unit"},An={class:"m num"},Pn={class:"unit"},Nn={class:"m num"},Un={class:"unit"},Vn={class:"m num"},jn={class:"unit"},Re={props:["items"],emits:"selected",setup(i,{emit:t}){const o=i,{t:d,locale:l}=G(),u=C("name"),r=C("asc"),s=new Intl.Collator(l.value,{numeric:!0}),k=H(()=>r.value=="asc"?[...o.items].sort((_,L)=>s.compare(_[u.value],L[u.value])):[...o.items].sort((_,L)=>-s.compare(_[u.value],L[u.value])));function h(_,L,I=1){return L?+parseFloat(_/L).toFixed(I):_}function x(_){let L=_.target.dataset.sort;u.value==L?r.value=r.value=="asc"?"desc":"asc":u.value=L}return(_,L)=>(f(),S("table",null,[e("thead",null,[e("tr",{class:A(r.value)},[e("th",{class:A(["name sort",{active:u.value=="name"}]),onClick:x,"data-sort":"name"},[P(a(n(d)("food.name"))+" ",1),$(ae)],2),e("th",{class:A(["num sort",{active:u.value=="kcal"}]),onClick:x,"data-sort":"kcal"},[$(ae),P(" "+a(n(d)("food.energy")),1)],2),e("th",{class:A(["m num sort",{active:u.value=="fat"}]),onClick:x,"data-sort":"fat"},[$(ae),P(" "+a(n(d)("food.fat")),1)],2),e("th",{class:A(["m num sort",{active:u.value=="carb"}]),onClick:x,"data-sort":"carb"},[$(ae),P(" "+a(n(d)("food.carbs2")),1)],2),e("th",{class:A(["m num sort",{active:u.value=="prot"}]),onClick:x,"data-sort":"prot"},[$(ae),P(" "+a(n(d)("food.protein")),1)],2)],2)]),e("tbody",null,[(f(!0),S(Y,null,te(n(k),I=>(f(),S("tr",{key:I.id,onClick:D=>_.$emit("selected",I.id)},[e("td",zn,a(I.name),1),e("td",Rn,[P(a(h(I.kcal,I.size))+" ",1),e("span",On,a(n(d)("unit.cal")),1)]),e("td",An,[P(a(h(I.fat,I.size))+" ",1),e("span",Pn,a(n(d)("unit.g")),1)]),e("td",Nn,[P(a(h(I.carb,I.size))+" ",1),e("span",Un,a(n(d)("unit.g")),1)]),e("td",Vn,[P(a(h(I.prot,I.size))+" ",1),e("span",jn,a(n(d)("unit.g")),1)])],8,Dn))),128))])]))}},Bn={},Hn={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Xn=e("path",{d:"m-7.5e-8 19.001v4.9993h4.9993l14.745-14.745-4.9993-4.9993zm23.61-13.611c0.51993-0.51993 0.51993-1.3598 0-1.8797l-3.1196-3.1196c-0.51993-0.51993-1.3598-0.51993-1.8797 0l-2.4397 2.4397 4.9993 4.9993z"},null,-1),qn=[Xn];function Wn(i,t){return f(),S("svg",Hn,qn)}var Ce=Q(Bn,[["render",Wn]]);const Jn={key:0,class:"new-item"},Kn=e("hr",null,null,-1),Yn=e("section",{class:"subtitle"},"Some food category",-1),Gn={class:"tags"},Qn=e("span",{class:"tag"},"Tag 1",-1),Zn=e("span",{class:"tag"},"Tag 2",-1),ea=e("span",{class:"tag"},"Tag 3",-1),ta=["disabled"],na=e("hr",null,null,-1),aa={class:"tracking no-edit-mode"},la={class:"tracking-amount"},oa={class:"unit"},sa=e("label",null,"Add to recipe",-1),ia=e("label",null,"Add to diary",-1),ua=e("hr",null,null,-1),ra={class:"nutrient-block"},ca=["disabled"],da=["value"],ma={class:"unit"},va=["value"],fa={class:"unit"},ha=["value"],_a={class:"unit"},pa=["value"],ga={class:"unit"},ba=["value"],ya={class:"unit"},wa=["disabled"],$a=["value"],ka={class:"unit"},xa=["value"],Ca={class:"unit"},Sa=["value"],La={class:"unit"},Ta=["value"],Ia={class:"unit"},Ea=["value"],Ma={class:"unit"},Fa={setup(i){const{t}=G(),o=U("log"),d=U("csrfToken"),l=U("perms"),u=U("food"),r=U("recipes"),s=U("diary"),k=C([]),h=C(null),x=C(!1),_=C(!1),L=C(!1),I=C(!1),D=C(100),c=C(V.now().toISODate()),E=C(V.now().toLocaleString(V.TIME_24_SIMPLE)),w=C(null),p=C(null);function m(g){fetch("/api/v1/food",{method:"POST",headers:{"X-CSRF-Token":d}}).then(v=>{if(!v.ok)throw t("createfood.err"+v.status);return v.json()}).then(v=>{v.name=g,u.value.push(v),k.value.push(v),o.msg(t("createfood.ok")),W(v.id)}).catch(v=>o.err(v))}function b(){_.value=!0;let g=h.value.id;fetch("/api/v1/food/"+g,{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":d},body:new URLSearchParams(new FormData(p.value))}).then(v=>{if(!v.ok)throw t("savefood.err"+v.status);return x.value=!1,fetch("/api/v1/food/"+g)}).then(v=>v.json()).then(v=>{v.name=t(v.id.toString()),u.value=u.value.map(y=>v.id==y.id?v:y),k.value=k.value.map(y=>v.id==y.id?v:y),h.value=h.value.id==v.id?v:h.value,o.msg(t("savefood.ok"))}).catch(v=>o.err(v)).finally(()=>{setTimeout(function(){_.value=!1},500)})}function M(g){L.value=!0,fetch(`/api/v1/recipe/${g}/ingredient/${h.value.id}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":d},body:new URLSearchParams({amount:D.value})}).then(v=>{if(!v.ok)throw t("addfood.err"+v.status);return fetch("/api/v1/recipe/"+g)}).then(v=>v.json()).then(v=>{r.value=r.value.map(y=>v.id==y.id?v:y),D.value=100,o.msg(t("addfood.ok"))}).catch(v=>o.err(v)).finally(()=>{setTimeout(function(){L.value=!1},500)})}function R(g,v){I.value=!0,fetch(`/api/v1/diary/${g}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":d},body:new URLSearchParams({id:h.value.id,amount:D.value,time:v,recipe:""})}).then(y=>{if(!y.ok)throw t("savediary.err"+y.status);return fetch("/api/v1/diary/"+g.replaceAll("-","/"))}).then(y=>y.json()).then(y=>{s.value[g]=y[0],D.value=100,o.msg(t("savediary.ok"))}).catch(y=>o.err(y)).finally(()=>{setTimeout(function(){I.value=!1},500)})}function j(g){k.value=g,h.value&&k.value.filter(v=>v.id==h.value.id).length==0&&(h.value=null)}function W(g){h.value=k.value.filter(v=>v.id==g)[0],c.value=V.now().toISODate(),E.value=V.now().toLocaleString(V.TIME_24_SIMPLE),D.value=100,w.value.showDetails()}function B(){x.value?b():x.value=!0}function T(g){g.target.blur(),isNaN(parseFloat(g.target.value))&&(g.target.value=h.value[g.target.name])}return(g,v)=>(f(),J(de,{ref_key:"main",ref:w,onDetailVisibility:v[1]||(v[1]=y=>x.value=!1),class:A({"edit-mode":x.value})},Ee({filter:N(()=>[n(l).canCreateFood?(f(),S("section",Jn,[e("h2",null,a(n(t)("aria.headnew")),1),$(De,{label:n(t)("btn.new"),placeholder:n(t)("food.hintnew"),onConfirm:m},null,8,["label","placeholder"])])):q("",!0),Kn,e("section",null,[e("h2",null,a(n(t)("aria.headsearch")),1),$(Fe,{data:n(u),placeholder:n(t)("food.hintsearch"),onResult:j},{default:N(y=>[e("fieldset",null,[e("legend",null,a(n(t)("aria.headmacro1")),1),$(K,{label:n(t)("food.energy"),onInput:y.confirm,name:"kcal",unit:"cal",min:"0",max:"900",frac:"0"},null,8,["label","onInput"]),$(K,{label:n(t)("food.fat"),onInput:y.confirm,name:"fat",unit:"g",min:"0",max:"100",frac:"0"},null,8,["label","onInput"]),$(K,{label:n(t)("food.carbs"),onInput:y.confirm,name:"carb",unit:"g",min:"0",max:"100",frac:"0"},null,8,["label","onInput"]),$(K,{label:n(t)("food.protein"),onInput:y.confirm,name:"prot",unit:"g",min:"0",max:"89",frac:"0"},null,8,["label","onInput"]),$(K,{label:n(t)("food.fiber"),onInput:y.confirm,name:"fib",unit:"g",min:"0",max:"71",frac:"0"},null,8,["label","onInput"])]),e("fieldset",null,[e("legend",null,a(n(t)("aria.headmacro2")),1),$(K,{label:n(t)("food.fatsat"),onInput:y.confirm,name:"fatsat",unit:"g",min:"0",max:"83",frac:"0"},null,8,["label","onInput"]),$(K,{label:n(t)("food.fato3"),onInput:y.confirm,name:"fato3",unit:"g",min:"0",max:"54",frac:"0"},null,8,["label","onInput"]),$(K,{label:n(t)("food.fato6"),onInput:y.confirm,name:"fato6",unit:"g",min:"0",max:"70",frac:"0"},null,8,["label","onInput"]),$(K,{label:n(t)("food.sugar"),onInput:y.confirm,name:"sug",unit:"g",min:"0",max:"100",frac:"0"},null,8,["label","onInput"]),$(K,{label:n(t)("food.salt"),onInput:y.confirm,name:"salt",unit:"g",min:"0",max:"100",frac:"0"},null,8,["label","onInput"])])]),_:1},8,["data","placeholder"])])]),main:N(()=>[$(Re,{items:k.value,onSelected:W},null,8,["items"])]),_:2},[h.value?{name:"head-details",fn:N(()=>[e("h2",null,a(h.value.name),1)])}:void 0,h.value?{name:"details",fn:N(()=>[Yn,e("section",Gn,[Qn,Zn,ea,n(l).canCreateFood||n(l).canEditFood?(f(),S("button",{key:0,class:"icon async",disabled:_.value,onClick:B},[x.value?q("",!0):(f(),J(Ce,{key:0})),x.value?(f(),J(we,{key:1})):q("",!0)],8,ta)):q("",!0)]),na,e("section",aa,[e("h2",null,a(n(t)("aria.headtrack")),1),e("fieldset",la,[e("div",null,[e("label",null,a(n(t)("food.amount")),1),re(e("input",{type:"number","onUpdate:modelValue":v[0]||(v[0]=y=>D.value=y),name:"amount"},null,512),[[xe,D.value]]),e("span",oa,a(n(t)("unit.g")),1)])]),e("fieldset",null,[sa,$(Cn,{label:n(t)("btn.add"),placeholder:n(t)("food.hintrec"),items:n(r),disabled:L.value,onConfirm:M},null,8,["label","placeholder","items","disabled"])]),e("fieldset",null,[ia,$(ze,{label:n(t)("btn.add"),time:E.value,date:c.value,disabled:I.value,onConfirm:R},null,8,["label","time","date","disabled"])])]),ua,e("section",null,[e("h2",null,a(n(t)("aria.headnutrients")),1),e("form",{ref_key:"form",ref:p},[e("div",ra,[e("fieldset",{disabled:!x.value,class:"col50"},[e("div",null,[e("label",null,a(n(t)("food.energy")),1),e("input",{type:"text",value:h.value.kcal,name:"kcal",onChange:T},null,40,da),e("span",ma,a(n(t)("unit.cal")),1)]),e("div",null,[e("label",null,a(n(t)("food.fat")),1),e("input",{type:"text",value:h.value.fat,name:"fat",onChange:T},null,40,va),e("span",fa,a(n(t)("unit.g")),1)]),e("div",null,[e("label",null,a(n(t)("food.carbs2")),1),e("input",{type:"text",value:h.value.carb,name:"carb",onChange:T},null,40,ha),e("span",_a,a(n(t)("unit.g")),1)]),e("div",null,[e("label",null,a(n(t)("food.protein")),1),e("input",{type:"text",value:h.value.prot,name:"prot",onChange:T},null,40,pa),e("span",ga,a(n(t)("unit.g")),1)]),e("div",null,[e("label",null,a(n(t)("food.fiber")),1),e("input",{type:"text",value:h.value.fib,name:"fib",onChange:T},null,40,ba),e("span",ya,a(n(t)("unit.g")),1)])],8,ca),e("fieldset",{disabled:!x.value,class:"col50"},[e("div",null,[e("label",null,a(n(t)("food.fatsat")),1),e("input",{type:"text",value:h.value.fatsat,name:"fatsat",onChange:T},null,40,$a),e("span",ka,a(n(t)("unit.g")),1)]),e("div",null,[e("label",null,a(n(t)("food.fato3")),1),e("input",{type:"text",value:h.value.fato3,name:"fato3",onChange:T},null,40,xa),e("span",Ca,a(n(t)("unit.g")),1)]),e("div",null,[e("label",null,a(n(t)("food.fato6")),1),e("input",{type:"text",value:h.value.fato6,name:"fato6",onChange:T},null,40,Sa),e("span",La,a(n(t)("unit.g")),1)]),e("div",null,[e("label",null,a(n(t)("food.sugar")),1),e("input",{type:"text",value:h.value.sug,name:"sug",onChange:T},null,40,Ta),e("span",Ia,a(n(t)("unit.g")),1)]),e("div",null,[e("label",null,a(n(t)("food.salt")),1),e("input",{type:"text",value:h.value.salt,name:"salt",onChange:T},null,40,Ea),e("span",Ma,a(n(t)("unit.g")),1)])],8,wa)])],512)])])}:void 0]),1032,["class"]))}};const Da=["disabled"],za=["value"],Ra={class:"unit"},Oa=["value"],Aa={props:["items","disabled"],setup(i,{expose:t}){const o=i,{t:d,locale:l}=G(),u=C("name"),r=C(null),s=new Intl.Collator(l.value,{numeric:!0}),k=H(()=>o.items.map(L=>({id:L.id,amount:L.amount,name:d(L.id.toString())})).sort((L,I)=>s.compare(L[u.value],I[u.value])));function h(_){_.target.blur();let L=parseFloat(_.target.value);(isNaN(L)||L<0)&&(_.target.value=0)}function x(){let _=new FormData(r.value),L=_.getAll("id"),I=_.getAll("amount"),D=[];return o.items.forEach(c=>{let E=parseInt(L.indexOf(c.id.toString())),w=parseFloat(I[E]);w!=c.amount&&D.push({id:c.id,amount:w})}),D}return t({getDiff:x}),(_,L)=>(f(),S("form",{class:"ingredients",ref_key:"form",ref:r},[e("fieldset",{disabled:i.disabled},[(f(!0),S(Y,null,te(n(k),I=>(f(),S("div",{key:I.id},[e("label",null,a(I.name),1),e("input",{type:"number",name:"amount",value:I.amount,onChange:h},null,40,za),e("span",Ra,a(n(d)("unit.g")),1),e("input",{type:"hidden",name:"id",value:I.id},null,8,Oa)]))),128))],8,Da)],512))}},Pa={},Na={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Ua=e("path",{d:"m0 18.316h2.5263v0.63158h-1.2632v1.2632h1.2632v0.63158h-2.5263v1.2632h3.7895v-5.0526h-3.7895zm1.2632-11.368h1.2632v-5.0526h-2.5263v1.2632h1.2632zm-1.2632 3.7895h2.2737l-2.2737 2.6526v1.1368h3.7895v-1.2632h-2.2737l2.2737-2.6526v-1.1368h-3.7895zm6.3158-7.5789v2.5263h17.684v-2.5263zm0 17.684h17.684v-2.5263h-17.684zm0-7.5789h17.684v-2.5263h-17.684z"},null,-1),Va=[Ua];function ja(i,t){return f(),S("svg",Na,Va)}var Ba=Q(Pa,[["render",ja]]);const Ha={class:"new-item"},Xa=e("hr",null,null,-1),qa=["disabled"],Wa=["value"],Ja=["innerHTML"],Ka={class:"tags"},Ya=e("span",{class:"tag no-edit-mode"},"Tag 1",-1),Ga=e("span",{class:"tag no-edit-mode"},"Tag 2",-1),Qa=e("span",{class:"tag no-edit-mode"},"Tag 3",-1),Za=["disabled"],el=e("hr",null,null,-1),tl={key:0,class:"tracking no-edit-mode"},nl={class:"tracking-amount"},al={class:"unit"},ll=e("label",null,"Add to diary",-1),ol=e("hr",null,null,-1),sl=["innerHTML"],il=e("hr",null,null,-1),ul={class:"no-edit-mode"},rl={class:"nutrient-block"},cl={class:"col50"},dl={class:"unit"},ml={class:"unit"},vl={class:"col50"},fl={class:"unit"},hl={class:"unit"},_l=e("hr",null,null,-1),pl={class:"prep"},gl=["disabled"],bl={class:"prep-size"},yl=["value"],wl=["disabled"],$l=["value"],kl={class:"unit"},xl=["value"],Cl={class:"unit"},Sl=["value"],Ll={class:"unit"},Tl=["value"],Il={class:"unit"},El={class:"placeholder"},Ml={setup(i){const{t}=G(),o=U("log"),d=U("csrfToken");U("perms");const l=U("recipes"),u=U("diary"),r=C([]),s=C(null),k=C(!1),h=C(!1),x=C(!1),_=C(1),L=C("&nbsp;"),I=C(V.now().toISODate()),D=C(V.now().toLocaleString(V.TIME_24_SIMPLE)),c=C(null),E=C(null),w=C(null);function p(F,z=2){return+parseFloat(F/(s.value.size||1)).toFixed(z)}function m(F){return Math.min.apply(Math,l.value.map(z=>Math.floor(z[F]/z.size)))}function b(F){return Math.max.apply(Math,l.value.map(z=>Math.ceil(z[F]/z.size)))}function M(F){fetch("/api/v1/recipe",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":d},body:new URLSearchParams({name:F})}).then(z=>{if(!z.ok)throw t("createrec.err"+z.status);return z.json()}).then(z=>{z.isowner=!0,l.value.push(z),r.value.push(z),o.msg(t("createrec.ok")),B(z.id)}).catch(z=>o.err(z))}function R(){h.value=!0;let F=s.value.id,z=s.value.owner,X=s.value.isowner;fetch("/api/v1/recipe/"+F,{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":d},body:new URLSearchParams(new FormData(E.value))}).then(O=>{if(!O.ok)throw t("saverec.err"+O.status);return j(F)}).then(()=>fetch("/api/v1/recipe/"+F)).then(O=>O.json()).then(O=>{O.owner=z,O.isowner=X,l.value=l.value.map(ne=>O.id==ne.id?O:ne),r.value=r.value.map(ne=>O.id==ne.id?O:ne),s.value=s.value.id==O.id?O:s.value,o.msg(t("saverec.ok"))}).catch(O=>o.err(O)).finally(()=>{setTimeout(function(){h.value=!1},500)})}function j(F){let z=w.value.getDiff();return z.length==0?new Promise(X=>{k.value=!1,X()}):new Promise((X,O)=>{let ne=0,$e;z.forEach(Se=>{fetch(`/api/v1/recipe/${F}/ingredient/${Se.id}`,{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":d},body:new URLSearchParams({amount:Se.amount})}).then(pe=>{if(++ne,!pe.ok)throw t("saverec.err"+pe.status)}).catch(pe=>$e=pe).finally(()=>{ne==z.length&&($e?O($e):(k.value=!1,X()))})})})}function W(F,z){x.value=!0;let X=new URLSearchParams;s.value.items.forEach(O=>{X.append("id",O.id),X.append("amount",p(O.amount)*_.value),X.append("time",z),X.append("recipe",s.value.name)}),fetch(`/api/v1/diary/${F}`,{method:"POST",body:X,headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":d}}).then(O=>{if(!O.ok)throw t("savediary.err"+O.status);return fetch("/api/v1/diary/"+F.replaceAll("-","/"))}).then(O=>O.json()).then(O=>{u.value[F]=O[0],_.value=1,o.msg(t("savediary.ok"))}).catch(O=>o.err(O)).finally(()=>{setTimeout(function(){x.value=!1},500)})}function B(F){s.value=r.value.filter(z=>z.id==F)[0],I.value=V.now().toISODate(),D.value=V.now().toLocaleString(V.TIME_24_SIMPLE),_.value=1,c.value.showDetails(),"isowner"in s.value?g():T()}function T(){fetch(`/api/v1/recipe/${s.value.id}/owner`).then(F=>{if(!F.ok)throw F;return F.json()}).then(F=>{s.value.isowner=F.isowner,s.value.owner=F.owner,g()}).catch(()=>{o.err(t("recowner.err")),L.value="&nbsp;"})}function g(){s.value.isowner?L.value=t("recipe.isowner"):s.value.owner?L.value=t("recipe.owner",{name:s.value.owner}):L.value=t("recipe.ispublic")}function v(F){r.value=F,s.value&&r.value.filter(z=>z.id==s.value.id).length==0&&(s.value=null)}function y(){k.value?R():k.value=!0}function Z(F){F.target.blur(),isNaN(parseFloat(F.target.value))&&(F.target.value=s.value[F.target.name])}return ce(()=>r.value=[...l.value]),(F,z)=>(f(),J(de,{ref_key:"main",ref:c,onDetailVisibility:z[1]||(z[1]=X=>k.value=!1),class:A({"edit-mode":k.value})},Ee({filter:N(()=>[e("section",Ha,[e("h2",null,a(n(t)("aria.headnewrec")),1),$(De,{label:n(t)("btn.new"),placeholder:n(t)("recipe.hintnew"),onConfirm:M},null,8,["label","placeholder"])]),Xa,e("section",null,[e("h2",null,a(n(t)("aria.headsearch")),1),$(Fe,{data:n(l),placeholder:n(t)("recipe.hintsearch"),onResult:v},{default:N(X=>[e("fieldset",null,[$(K,{label:n(t)("food.energy"),min:m("kcal"),max:b("kcal"),onInput:X.confirm,name:"kcal",unit:"cal",frac:"0"},null,8,["label","min","max","onInput"]),$(K,{label:n(t)("food.fat"),min:m("fat"),max:b("fat"),onInput:X.confirm,name:"fat",unit:"g",frac:"0"},null,8,["label","min","max","onInput"]),$(K,{label:n(t)("food.carbs"),min:m("carb"),max:b("carb"),onInput:X.confirm,name:"carb",unit:"g",frac:"0"},null,8,["label","min","max","onInput"]),$(K,{label:n(t)("food.protein"),min:m("prot"),max:b("prot"),onInput:X.confirm,name:"prot",unit:"g",frac:"0"},null,8,["label","min","max","onInput"])])]),_:1},8,["data","placeholder"])])]),main:N(()=>[$(Re,{items:r.value,onSelected:B},null,8,["items"])]),_:2},[s.value?{name:"head-details",fn:N(()=>[e("form",{ref_key:"form",ref:E,autocomplete:"off",id:"form-recipe"},[e("fieldset",{disabled:!k.value},[e("input",{type:"text",name:"name",value:s.value.name},null,8,Wa)],8,qa)],512)])}:void 0,s.value?{name:"details",fn:N(()=>[e("section",{class:"subtitle no-edit-mode",innerHTML:L.value},null,8,Ja),e("section",Ka,[Ya,Ga,Qa,s.value.isowner?(f(),S("button",{key:0,class:"icon async",disabled:h.value,onClick:y},[k.value?q("",!0):(f(),J(Ce,{key:0})),k.value?(f(),J(we,{key:1})):q("",!0)],8,Za)):q("",!0)]),el,s.value.items.length?(f(),S("section",tl,[e("h2",null,a(n(t)("aria.headtrack")),1),e("fieldset",nl,[e("div",null,[e("label",null,a(n(t)("food.amount")),1),re(e("input",{type:"number","onUpdate:modelValue":z[0]||(z[0]=X=>_.value=X),name:"amount"},null,512),[[xe,_.value]]),e("span",al,a(n(t)("recipe.size",_.value)),1)])]),e("fieldset",null,[ll,$(ze,{label:n(t)("btn.add"),time:D.value,date:I.value,disabled:x.value,onConfirm:W},null,8,["label","time","date","disabled"])])])):q("",!0),ol,e("section",null,[e("h2",null,a(n(t)("aria.headingred")),1),s.value.items.length?q("",!0):(f(),S("p",{key:0,class:"msg-noitems",innerHTML:n(t)("recipe.noitems")},null,8,sl)),$(Aa,{ref_key:"ingredients",ref:w,items:s.value.items,disabled:!k.value},null,8,["items","disabled"])]),il,e("section",ul,[e("h2",null,a(n(t)("aria.headnutrients")),1),e("div",rl,[e("div",cl,[e("div",null,[e("label",null,a(n(t)("food.energy")),1),e("span",null,a(p(s.value.kcal,1)),1),e("span",dl,a(n(t)("unit.cal")),1)]),e("div",null,[e("label",null,a(n(t)("food.fat")),1),e("span",null,a(p(s.value.fat,1)),1),e("span",ml,a(n(t)("unit.g")),1)])]),e("div",vl,[e("div",null,[e("label",null,a(n(t)("food.carbs2")),1),e("span",null,a(p(s.value.carb,1)),1),e("span",fl,a(n(t)("unit.g")),1)]),e("div",null,[e("label",null,a(n(t)("food.protein")),1),e("span",null,a(p(s.value.prot,1)),1),e("span",hl,a(n(t)("unit.g")),1)])])])]),_l,e("section",pl,[e("h2",null,a(n(t)("aria.headprep")),1),e("div",null,[e("fieldset",{disabled:!k.value,class:"col50"},[e("div",bl,[e("label",null,a(n(t)("recipe.size",2)),1),e("input",{type:"text",name:"size",form:"form-recipe",value:s.value.size,onChange:Z},null,40,yl),e("label",null,a(n(t)("recipe.size",s.value.size)),1)])],8,gl),e("fieldset",{disabled:!k.value,class:"col50"},[e("div",null,[e("label",null,a(n(t)("recipe.time")),1),e("input",{type:"text",disabled:"",value:s.value.preptime+s.value.cooktime+s.value.misctime},null,8,$l),e("span",kl,a(n(t)("unit.min")),1)]),e("div",null,[e("label",null,a(n(t)("recipe.preptime")),1),e("input",{type:"text",name:"preptime",form:"form-recipe",value:s.value.preptime,onChange:Z},null,40,xl),e("span",Cl,a(n(t)("unit.min")),1)]),e("div",null,[e("label",null,a(n(t)("recipe.cooktime")),1),e("input",{type:"text",name:"cooktime",form:"form-recipe",value:s.value.cooktime,onChange:Z},null,40,Sl),e("span",Ll,a(n(t)("unit.min")),1)]),e("div",null,[e("label",null,a(n(t)("recipe.misctime")),1),e("input",{type:"text",name:"misctime",form:"form-recipe",value:s.value.misctime,onChange:Z},null,40,Tl),e("span",Il,a(n(t)("unit.min")),1)])],8,wl)]),e("div",El,[$(Ba),e("p",null,a(n(t)("todo.instructions")),1)])])])}:void 0]),1032,["class"]))}};const Fl=["disabled"],Dl={value:"1"},zl={value:"2"},Rl={value:"3"},Ol={value:"4"},Al={value:"5"},Pl={value:"6"},Nl={value:"7"},Ul={value:"8"},Vl={value:"9"},jl={value:"10"},Bl={value:"11"},Hl={value:"12"},Xl=["value"],ql=["disabled"],Oe={props:["mode","items","storage"],emits:["selection"],setup(i,{expose:t,emit:o}){const d=i,{t:l}=G(),u=C(V.now().month),r=C(V.now().year),s=C(null),k=H(()=>{let p=d.items.map(m=>parseInt(m.split("-")[0])).filter((m,b,M)=>M.indexOf(m)===b);return p.length==0&&(p=[V.now().year]),[Math.min(...p)-1,...p,Math.max(...p)+1]}),h=H(()=>r.value!=k.value[0]||u.value>1),x=H(()=>r.value!=k.value[k.value.length-1]||u.value<12);let _=[];he(()=>d.items,()=>{s.value.querySelectorAll("td>button").forEach(p=>{d.items.indexOf(p.dataset.date)!=-1?p.parentNode.classList.add("has-entries"):p.parentNode.classList.remove("has-entries")})});function L(){let p=V.now().toISODate(),m=V.local(r.value,u.value);m=m.minus({days:m.weekday-1}),!_.length&&d.mode!="toggle"&&(_=[p]),s.value.querySelectorAll("td").forEach(b=>{let M=m.toISODate();b.firstElementChild.textContent=m.day,b.firstElementChild.dataset.date=M,m.month!=u.value?b.classList.add("outside"):b.classList.remove("outside"),M==p?b.classList.add("today"):b.classList.remove("today"),d.items.indexOf(M)!=-1?b.classList.add("has-entries"):b.classList.remove("has-entries"),_.indexOf(M)!=-1?b.classList.add("active"):b.classList.remove("active"),m=m.plus({days:1})})}function I(){--u.value<1&&(u.value=12,--r.value),L()}function D(){++u.value>12&&(u.value=1,++r.value),L()}function c(p){let m=p.target.dataset.date;if(d.mode=="toggle"){let b=_.indexOf(m);b==-1?_.push(m):_.splice(b,1)}else _=[m];s.value.querySelectorAll("td>button").forEach(b=>{_.indexOf(b.dataset.date)!=-1?b.parentNode.classList.add("active"):b.parentNode.classList.remove("active")}),E(),o("selection",_)}function E(){if(d.storage){let p=JSON.stringify(_);window.localStorage.setItem(d.storage,p)}}function w(){if(d.storage){let p=window.localStorage.getItem(d.storage);_=JSON.parse(p)||[]}}return t({onDay:c}),ce(()=>{w(),L(),o("selection",_)}),(p,m)=>(f(),S("div",{class:A(["calendar",[i.mode]])},[e("div",null,[e("button",{class:"prev icon",onClick:I,disabled:!n(h)},[$(be)],8,Fl),e("div",null,[re(e("select",{class:"month","onUpdate:modelValue":m[0]||(m[0]=b=>u.value=b),onChange:L},[e("option",Dl,a(n(l)("month.1")),1),e("option",zl,a(n(l)("month.2")),1),e("option",Rl,a(n(l)("month.3")),1),e("option",Ol,a(n(l)("month.4")),1),e("option",Al,a(n(l)("month.5")),1),e("option",Pl,a(n(l)("month.6")),1),e("option",Nl,a(n(l)("month.7")),1),e("option",Ul,a(n(l)("month.8")),1),e("option",Vl,a(n(l)("month.9")),1),e("option",jl,a(n(l)("month.10")),1),e("option",Bl,a(n(l)("month.11")),1),e("option",Hl,a(n(l)("month.12")),1)],544),[[ke,u.value,void 0,{number:!0}]]),re(e("select",{class:"year","onUpdate:modelValue":m[1]||(m[1]=b=>r.value=b),onChange:L},[(f(!0),S(Y,null,te(n(k),b=>(f(),S("option",{value:b},a(b),9,Xl))),256))],544),[[ke,r.value,void 0,{number:!0}]])]),e("button",{class:"next icon",onClick:D,disabled:!n(x)},[$(be)],8,ql)]),e("table",{ref_key:"calendar",ref:s},[e("thead",null,[e("tr",null,[e("th",null,a(n(l)("day.cal1")),1),e("th",null,a(n(l)("day.cal2")),1),e("th",null,a(n(l)("day.cal3")),1),e("th",null,a(n(l)("day.cal4")),1),e("th",null,a(n(l)("day.cal5")),1),e("th",null,a(n(l)("day.cal6")),1),e("th",null,a(n(l)("day.cal7")),1)])]),e("tbody",null,[e("tr",null,[e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})])]),e("tr",null,[e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})])]),e("tr",null,[e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})])]),e("tr",null,[e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})])]),e("tr",null,[e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})])]),e("tr",null,[e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})]),e("td",null,[e("button",{onClick:c})])])])],512)],2))}};const Wl={class:"unit"},Jl=["disabled"],Kl=["value"],Yl={class:"unit"},Gl=["value"],Ql=["value"],Zl=["value"],eo=["value","disabled"],to={class:"unit"},no=["value"],ao=["value"],lo=["value"],oo={key:0},so={key:1},io={props:["entries","nutrient","disabled"],setup(i,{expose:t}){const o=i,{t:d}=G(),l=U("food"),u=U("prefs"),r=C("hour"),s=C("relative"),k=C(null),h=H(()=>{switch(r.value){case"hour":return _();case"day":return L();default:return[]}}),x=H(()=>{if(s.value=="relative")return"%";switch(o.nutrient){case"kcal":return" "+d("unit.cal");case"fat":case"carb":case"prot":return" "+d("unit.g");default:return" "+d("unit.mg")}});function _(){let m=[];if(o.entries){let b={};o.entries.forEach(M=>{let R=parseInt(M.time),j=V.fromObject({hours:R-R%2}),W=j.toFormat("t")+" - "+j.plus({hours:2}).toFormat("t");W in b||(b[W]={name:W,entries:[]});let B={id:M.food.id,name:d(M.food.id.toString()),amount:M.food.amount,nutrient:I(M.food),recipe:M.recipe,time:M.time,isrec:!1};if(M.recipe){let T=!1;b[W].entries.every(g=>g.isrec&&g.name==M.recipe?(g.entries.push(B),g.amount+=B.amount,g.nutrient+=B.nutrient,T=!0,!1):!0),T||b[W].entries.push({name:M.recipe,isrec:!0,amount:B.amount,nutrient:B.nutrient,entries:[B]})}else b[W].entries.push(B)}),m=Object.values(b)}return m}function L(){return[{name:"Morning",entries:[{type:"recipe"},{type:"single"}]},{name:"Noon",entries:[{type:"recipe"},{type:"single"}]}]}function I(m){let M=l.value.filter(j=>j.id==m.id)[0][o.nutrient]*m.amount*.01;if(s.value=="metric")return Math.round(M);let R=u.value.rdi[o.nutrient];return Math.round(M*100/R)}function D(){s.value=="relative"?s.value="metric":s.value=="metric"&&(s.value="relative")}function c(m){m.target.closest("div").classList.toggle("open")}function E(m){m.key=="Enter"&&(m.preventDefault(),w(m))}function w(m){m.target.blur();let b=parseFloat(m.target.value);(isNaN(b)||b<0)&&(m.target.value=0)}function p(){let m=new FormData(k.value),b=m.getAll("id"),M=m.getAll("amount"),R=m.getAll("recipe"),j=m.getAll("time"),W=[];return o.entries.forEach(B=>{for(let T=0;T<b.length;++T)if(b[T]==B.food.id&&R[T]==B.recipe&&j[T]==B.time){M[T]!=B.food.amount&&W.push({id:b[T],amount:M[T],recipe:R[T],time:j[T]});break}}),W}return t({getDiff:p}),(m,b)=>(f(),S("form",{class:"diary-entry-list",ref_key:"form",ref:k},[(f(!0),S(Y,null,te(n(h),M=>(f(),S("fieldset",{key:M.name},[e("legend",null,a(M.name),1),(f(!0),S(Y,null,te(M.entries,R=>(f(),S("div",{class:A({recipe:R.isrec})},[R.isrec?(f(),S(Y,{key:0},[e("label",null,a(R.name),1),e("button",{class:"icon",type:"button",onClick:c},[$(Me)]),e("span",null,a(R.amount),1),e("span",Wl,a(n(d)("unit.g")),1),e("span",{class:A(["nutrient",[i.nutrient,s.value]])},a(R.nutrient)+a(n(x)),3),e("fieldset",{disabled:i.disabled,style:ge({"--max-height":R.entries.length*41+"px"})},[(f(!0),S(Y,null,te(R.entries,j=>(f(),S("div",{key:j.id},[e("label",null,a(j.name),1),e("input",{type:"number",name:"amount",value:j.amount,onKeydown:E,onChange:w},null,40,Kl),e("span",Yl,a(n(d)("unit.g")),1),e("span",{class:A(["nutrient",[i.nutrient,s.value]])},a(j.nutrient)+a(n(x)),3),e("input",{type:"hidden",name:"id",value:j.id},null,8,Gl),e("input",{type:"hidden",name:"recipe",value:j.recipe},null,8,Ql),e("input",{type:"hidden",name:"time",value:j.time},null,8,Zl)]))),128))],12,Jl)],64)):(f(),S(Y,{key:1},[e("label",null,a(R.name),1),e("input",{type:"number",name:"amount",value:R.amount,disabled:i.disabled,onKeydown:E,onChange:w},null,40,eo),e("span",to,a(n(d)("unit.g")),1),e("span",{class:A(["nutrient",[i.nutrient,s.value]])},a(R.nutrient)+a(n(x)),3),e("input",{type:"hidden",name:"id",value:R.id},null,8,no),e("input",{type:"hidden",name:"recipe",value:R.recipe},null,8,ao),e("input",{type:"hidden",name:"time",value:R.time},null,8,lo)],64))],2))),256))]))),128)),e("button",{type:"button",class:"nutrient-mode-switch icon",onClick:D},[s.value=="relative"?(f(),S("span",oo,"%")):q("",!0),s.value=="metric"?(f(),S("span",so,"g")):q("",!0)])],512))}};const uo={class:"pie-chart"},ro={viewBox:"0 0 256 256"},co=["transform","stroke-dasharray"],mo=["stroke-dasharray","transform"],vo=["stroke-dasharray","transform"],fo=e("hr",null,null,-1),fe={props:["start","range","value","max","label","unit","frac"],setup(i){const t=i,o=112,d=H(()=>+(parseFloat(t.value)||0).toFixed(t.frac||0)),l=H(()=>+(parseFloat(t.max)||0).toFixed(t.frac||0)),u=H(()=>`rotate(${-90+(parseFloat(t.start)||0)} 128 128)`),r=H(()=>{let h=(parseFloat(t.range)||0)/360;return Math.PI*2*o*h+" 710"}),s=H(()=>{let h=(parseFloat(t.value)||0)/(parseFloat(t.max)||1),x=parseFloat(t.range)||0,_=Math.min(h,1)*x/360;return Math.PI*2*o*_+" 710"}),k=H(()=>{let h=(parseFloat(t.value)||0)/(parseFloat(t.max)||1),x=parseFloat(t.range)||0,_=Math.min(Math.max(0,h-1),1)*x/360;return Math.PI*2*o*_+" 710"});return(h,x)=>(f(),S("figure",uo,[(f(),S("svg",ro,[e("circle",{class:"base",r:"112",cx:"128",cy:"128",transform:n(u),"stroke-dasharray":n(r)},null,8,co),e("circle",{class:"good",r:"112",cx:"128",cy:"128","stroke-dasharray":n(s),transform:n(u)},null,8,mo),e("circle",{class:"bad",r:"112",cx:"128",cy:"128","stroke-dasharray":n(k),transform:n(u)},null,8,vo)])),e("div",null,[ue(h.$slots,"details",{},()=>[e("span",null,a(n(d))+" "+a(i.unit),1),fo,e("span",null,a(n(l))+" "+a(i.unit),1)])]),e("figcaption",null,a(i.label),1)]))}};const ho=e("hr",null,null,-1),_o=e("section",null,null,-1),po={id:"charts-week"},go=["data-date"],bo={id:"charts-macro"},yo={class:"no-edit-mode"},wo={class:"subtitle no-edit-mode"},$o={class:"tabs"},ko=["disabled"],xo=e("hr",null,null,-1),Co={key:0},So=["innerHTML"],Lo={setup(i){const{t}=G(),o=U("log"),d=U("csrfToken"),l=U("diary"),u=U("prefs"),r=C(null),s=C(V.now()),k=C("kcal"),h=C(!1),x=C(!1),_=C(null),L=C(null),I=C(null),D=H(()=>Object.keys(l.value)),c=H(()=>{let T=[],g=V.now().toISODate(),v=s.value.toISODate(),y=s.value.minus({days:s.value.weekday-1});for(let Z=0;Z<7;++Z){let F=y.toISODate();T.push({weekday:t("day.cal"+y.weekday),calday:y.day,date:F,active:F==v,today:F==g,value:l.value[F]?l.value[F].kcal:0}),y=y.plus({days:1})}return T});let E=!1;function w(T){T.stopPropagation(),T.preventDefault(),m(T.target.closest("ul"),T.movementX),E=!0}function p(T){T.stopPropagation(),T.preventDefault();let g=Math.max(-16,Math.min(-T.deltaY,16));m(T.target.closest("ul"),g)}function m(T,g){let v=parseInt(T.style.getPropertyValue("--offset"))||0,y=Math.max(T.clientWidth-T.scrollWidth,Math.min(v+g,0));T.style.setProperty("--offset",y+"px")}function b(T){let g=T.target.closest("ul");g.addEventListener("pointermove",w),g.addEventListener("mouseup",M),g.addEventListener("touchend",M),g.addEventListener("mouseleave",M),g.addEventListener("touchcancel",M),E=!1}function M(T){let g=T.target.closest("ul");g.removeEventListener("pointermove",w),g.removeEventListener("mouseup",M),g.removeEventListener("touchend",M),g.removeEventListener("mouseleave",M),g.removeEventListener("touchcancel",M)}function R(T){E||(k.value=T.target.dataset.name)}function j(){r.value&&r.value.entries&&(x.value?W():x.value=!0)}function W(){let T=L.value.getDiff();if(T.length==0){x.value=!1;return}h.value=!0;let g=r.value.date,v=new URLSearchParams;T.forEach(y=>{v.append("id",y.id),v.append("amount",y.amount),v.append("time",y.time),v.append("recipe",y.recipe)}),fetch(`/api/v1/diary/${g}`,{method:"PUT",body:v,headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":d}}).then(y=>{if(!y.ok)throw t("savediary.err"+y.status);return x.value=!1,fetch("/api/v1/diary/"+g.replaceAll("-","/"))}).then(y=>y.json()).then(y=>{y[0]&&y[0].kcal?l.value[g]=y[0]:delete l.value[g],B([g]),o.msg(t("savediary.ok"))}).catch(y=>o.err(y)).finally(()=>{setTimeout(function(){h.value=!1},500)})}function B(T){s.value=V.fromISO(T[0]);let g=s.value.toISODate();if(!l.value[g]){r.value={date:g};return}if(l.value[g].entries){r.value=l.value[g];return}fetch(`/api/v1/diary/${g.replaceAll("-","/")}/entries`).then(v=>v.json()).then(v=>{v.forEach(y=>y.time=y.date.split("T")[1].slice(0,5)),v.sort((y,Z)=>y.time<Z.time?-1:Z.time<y.time?1:0),l.value[g].entries=v}).catch(v=>o.err(v)).finally(()=>r.value=l.value[g])}return(T,g)=>(f(),J(de,{ref_key:"main",ref:I,class:A(["diary",{"edit-mode":x.value}]),onDetailVisibility:g[1]||(g[1]=v=>x.value=!1)},{filter:N(()=>[e("section",null,[e("h2",null,a(n(t)("aria.headcal")),1),$(Oe,{ref_key:"calendar",ref:_,storage:"caldiary",items:n(D),onSelection:B},null,8,["items"])]),ho,_o]),main:N(()=>[e("section",po,[(f(!0),S(Y,null,te(n(c),v=>(f(),S("button",{"data-date":v.date,class:A({today:v.today,active:v.active}),onClick:g[0]||(g[0]=(...y)=>_.value.onDay&&_.value.onDay(...y))},[$(fe,{range:"360",value:v.value,max:n(u).rdi.kcal},{details:N(()=>[e("span",null,a(v.weekday),1),e("span",null,a(v.calday),1)]),_:2},1032,["value","max"])],10,go))),256))]),e("section",bo,[$(fe,{class:"kcal",start:"225",range:"270",frac:"0",label:n(t)("food.energy"),unit:n(t)("unit.cal"),value:r.value?r.value.kcal:0,max:n(u).rdi.kcal},null,8,["label","unit","value","max"]),$(fe,{class:"fat",start:"225",range:"270",frac:"0",label:n(t)("food.fat"),unit:n(t)("unit.g"),value:r.value?r.value.fat:0,max:n(u).rdi.fat},null,8,["label","unit","value","max"]),$(fe,{class:"carb",start:"225",range:"270",frac:"0",label:n(t)("food.carbs2"),unit:n(t)("unit.g"),value:r.value?r.value.carb:0,max:n(u).rdi.carb},null,8,["label","unit","value","max"]),$(fe,{class:"prot",start:"225",range:"270",frac:"0",label:n(t)("food.protein"),unit:n(t)("unit.g"),value:r.value?r.value.prot:0,max:n(u).rdi.prot},null,8,["label","unit","value","max"])])]),"head-details":N(()=>[e("h2",yo,a(s.value.weekdayLong),1)]),details:N(()=>[e("section",wo,a(s.value.toLocaleString(n(V).DATE_FULL)),1),e("section",$o,[e("div",null,[e("ul",{onMousedown:b,onTouchstart:b,onWheel:p},[e("li",{class:A({active:k.value=="kcal"})},[e("button",{"data-name":"kcal",onClick:R},a(n(t)("food.energy")),1)],2),e("li",{class:A({active:k.value=="fat"})},[e("button",{"data-name":"fat",onClick:R},a(n(t)("food.fat")),1)],2),e("li",{class:A({active:k.value=="carb"})},[e("button",{"data-name":"carb",onClick:R},a(n(t)("food.carbs2")),1)],2),e("li",{class:A({active:k.value=="prot"})},[e("button",{"data-name":"prot",onClick:R},a(n(t)("food.protein")),1)],2)],32)]),e("button",{class:"icon async",disabled:h.value,onClick:j},[x.value?q("",!0):(f(),J(Ce,{key:0})),x.value?(f(),J(we,{key:1})):q("",!0)],8,ko)]),xo,r.value?(f(),S("section",Co,[e("h2",null,a(n(t)("aria.headlog")),1),r.value.entries?q("",!0):(f(),S("p",{key:0,class:"msg-noitems",innerHTML:n(t)("diary.noitems")},null,8,So)),r.value.entries?(f(),J(io,{key:1,ref_key:"entries",ref:L,entries:r.value.entries,nutrient:k.value,disabled:!x.value},null,8,["entries","nutrient","disabled"])):q("",!0)])):q("",!0)]),_:1},8,["class"]))}};const To=["checked"],Io=e("div",null,null,-1),Le={props:["checked"],emits:["change","click"],setup(i,{emit:t}){function o(l){t("change",l)}function d(l){t("click",l)}return(l,u)=>(f(),S("label",null,[e("input",{type:"checkbox",checked:i.checked,onChange:o,onClick:d},null,40,To),Io]))}},Eo={class:"select"},Mo={class:"select"},Fo=["innerHTML"],Do=["onClick"],zo={class:"s"},Ro={props:["items","offline"],emits:"selected",setup(i,{emit:t}){const o=i,{t:d,locale:l}=G(),u=U("log"),r=U("csrfToken"),s=C("amount"),k=C("desc"),h=new Intl.Collator(l.value,{numeric:!0}),x=H(()=>k.value=="asc"?[...o.items].sort((w,p)=>h.compare(w[s.value],p[s.value])):[...o.items].sort((w,p)=>-h.compare(w[s.value],p[s.value]))),_=H(()=>o.items&&o.items.length?o.items.length==o.items.filter(w=>w.done).length:!1);he(()=>o.offline,D);function L(w){if(w.amount>999)var p=+parseFloat(w.amount*.001).toFixed(1),m=d("unit.kg");else var p=w.amount,m=d("unit.g");return`${p} <span class="unit">${m}</span>`}function I(w){let p=w.target.dataset.sort;s.value==p?k.value=k.value=="asc"?"desc":"asc":s.value=p}function D(){if(!o.offline){let w=new URLSearchParams;o.items.forEach(p=>{p.local&&(w.append("id",p.id),w.append("done",p.done),p.local=!1)}),w.has("id")&&fetch("/api/v1/list/diary/done",{method:"PUT",body:w,headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":r}}).catch(p=>u.err(p))}}function c(w){let p=w.target.checked,m=new URLSearchParams;o.items.forEach(b=>{b.done=p,b.local=o.offline,m.append("id",b.id),m.append("done",b.done)}),o.offline||fetch("/api/v1/list/diary/done",{method:"PUT",body:m,headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":r}}).catch(()=>{})}function E(w){let p=w.target.closest("label").dataset.id,m=w.target.checked,b=o.items.filter(M=>M.id==p)[0];b.done=m,b.local=o.offline,o.offline||fetch("/api/v1/list/diary/done",{method:"PUT",body:new URLSearchParams({id:p,done:m}),headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":r}}).catch(()=>{})}return(w,p)=>(f(),S("table",null,[e("thead",null,[e("tr",{class:A(k.value)},[e("th",Eo,[$(Le,{checked:n(_),onClick:c},null,8,["checked"])]),e("th",{class:A(["num sort",{active:s.value=="amount"}]),onClick:I,"data-sort":"amount"},[$(ae),P(" "+a(n(d)("food.amount")),1)],2),e("th",{class:A(["name sort",{active:s.value=="name"}]),onClick:I,"data-sort":"name"},[P(a(n(d)("food.name"))+" ",1),$(ae)],2),e("th",{class:A(["s sort",{active:s.value=="aisle"}]),onClick:I,"data-sort":"aisle"},[$(ae),P(" "+a(n(d)("food.aisle")),1)],2)],2)]),e("tbody",null,[(f(!0),S(Y,null,te(n(x),m=>(f(),S("tr",{key:m.id,class:A({done:m.done})},[e("td",Mo,[$(Le,{"data-id":m.id,checked:m.done,onChange:E},null,8,["data-id","checked"])]),e("td",{class:"num",innerHTML:L(m)},null,8,Fo),e("td",{class:"name",onClick:b=>w.$emit("selected",m.id)},a(m.name),9,Do),e("td",zo,a(n(d)("aisle."+m.aisle)),1)],2))),128))])]))}};const Oo=e("hr",null,null,-1),Ao=e("section",null,null,-1),Po={setup(i){const{t}=G(),o=U("log"),d=U("diary"),l=C([]),u=C(!1),r=C(null),s=H(()=>Object.keys(d.value));let k;he(l,c=>I(),{deep:!0});function h(c){if(c.length==0){l.value=[];return}let E=new URLSearchParams(c.map(w=>["date",w]));fetch("/api/v1/list/diary?"+E).then(w=>{if(!w.ok)throw t("getlist.err"+w.status);return w.json()}).then(w=>{w.forEach(p=>p.name=t(p.id.toString())),l.value=w}).catch(w=>{w instanceof TypeError?x():o.err(w)})}function x(){u.value||(u.value=!0,o.warn(t("conn.off")),D())}function _(){u.value&&(u.value=!1,o.msg(t("conn.on")))}function L(c){r.value.showDetails()}function I(){let c=JSON.stringify(l.value);window.localStorage.setItem("listdiary",c)}function D(){let c=window.localStorage.getItem("listdiary")||"[]";l.value=JSON.parse(c)}return ce(()=>{k=setInterval(()=>{fetch("/ping",{method:"HEAD"}).then(_,x)},15e3)}),Pe(()=>{clearInterval(k)}),(c,E)=>(f(),J(de,{ref_key:"main",ref:r},{filter:N(()=>[e("section",{class:A({offline:u.value})},[e("h2",null,a(n(t)("aria.headcal")),1),$(Oe,{mode:"toggle",storage:"calshop",items:n(s),onSelection:h},null,8,["items"])],2),Oo,Ao]),main:N(()=>[$(Ro,{items:l.value,offline:u.value,onSelected:L},null,8,["items","offline"])]),_:1},512))}},No=P(" Profile "),Uo={setup(i){return(t,o)=>(f(),J(de,null,{main:N(()=>[No]),_:1}))}},Vo=P(" Settings "),jo={setup(i){return(t,o)=>(f(),J(de,null,{main:N(()=>[Vo]),_:1}))}},Bo=Ne({history:Ue(),routes:[{path:"/",name:"diary",component:Lo},{path:"/recipes",name:"recipes",component:Ml},{path:"/food",name:"food",component:Fa},{path:"/shopping",name:"shopping",component:Po},{path:"/profile",name:"profile",component:Uo},{path:"/settings",name:"settings",component:jo}]});let ye=document.documentElement.lang||navigator.language;!ye&&navigator.languages!=null&&(ye=navigator.languages[0]);Ve.defaultLocale=ye;const Te=document.querySelector("meta[name='_csrf']"),Ho=Te?Te.content:"",Xo=function(){const i=document.documentElement.dataset.perm||1,t=65536,o=131072;function d(l){return(i&l)==l}return{canCreateFood:d(t),canEditFood:d(o)}}(),qo=function(){function i(t){return typeof t=="string"?t:"message"in t?t.message:le.global.t("err.err")}return{msg:function(t){let o={msg:i(t),timeout:3e3};window.dispatchEvent(new CustomEvent("message",{detail:o}))},warn:function(t){let o={msg:i(t),timeout:4e3};window.dispatchEvent(new CustomEvent("warning",{detail:o}))},err:function(t){let o={msg:i(t),timeout:5e3};window.dispatchEvent(new CustomEvent("error",{detail:o}))}}}(),ee=je(Tt);let le,oe,me,se,ve;function Wo(i){le=Be({legacy:!1,locale:ye.split("-")[0],fallbackLocale:"en",messages:i}),oe&&me&&se&&ve&&_e()}function Jo(i){oe=i,le&&me&&se&&ve&&_e()}function Ko(i){me=i,le&&oe&&se&&ve&&_e()}function Yo(i){se={},i.forEach(t=>se[t.date]=t),le&&oe&&me&&ve&&_e()}function Ie(i){ve=i,le&&oe&&me&&se&&_e()}function _e(){oe.forEach(i=>{i.name=le.global.t(i.id.toString())}),ee.provide("csrfToken",Ho),ee.provide("perms",Xo),ee.provide("food",C(oe)),ee.provide("recipes",C(me)),ee.provide("diary",C(se)),ee.provide("prefs",C(ve)),ee.provide("log",qo),ee.use(Bo),ee.use(le),ee.mount("#app")}fetch("/app/l10n.json").then(i=>i.json()).then(Wo);fetch("/api/v1/foods").then(i=>i.json()).then(Jo);fetch("/api/v1/recipes").then(i=>i.json()).then(Ko);fetch("/api/v1/diary").then(i=>i.json()).then(Yo);fetch("/api/v1/prefs").then(i=>i.json()).then(Ie).catch(()=>{Ie({rdi:{kcal:2e3,fat:60,carb:270,prot:80},ui:{neutralCharts:!1}})});
