import{o as f,c as $,a as e,u as J,i as U,b,w as N,d as P,t as a,e as n,R as ie,f as he,g as K,h as q,n as O,r as k,F as G,j as te,k as Oe,l as ue,m as ke,p as pe,q as re,v as xe,s as X,x as we,D as V,y as Ee,z as Pe,A as Ne,S as Ve,B as je,C as Be}from"./vendor.js";const Ue=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))d(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&d(c)}).observe(document,{childList:!0,subtree:!0});function i(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerpolicy&&(o.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?o.credentials="include":l.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function d(l){if(l.ep)return;l.ep=!0;const o=i(l);fetch(l.href,o)}};Ue();var Q=(s,t)=>{const i=s.__vccOpts||s;for(const[d,l]of t)i[d]=l;return i};const He={},Xe={width:"512",height:"512",version:"1.1",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},qe=e("path",{d:"m114.6 507.3c13.82-0.8729 90.06-3.083 106.2-3.079h13.49l2.639-5.293c5.191-10.41 10.35-29.57 13.13-48.74 1.811-12.5 1.488-16.68-1.826-23.56-2.528-5.249-11.04-13.06-20.54-18.86-28.38-17.32-51.21-34.77-76.05-58.12-6.673-6.272-9.377-8.209-16.08-11.53-12.37-6.124-20.36-12.88-29.19-24.7-1.45-1.941-1.795-2.038-4.695-1.334-1.722 0.4182-7.18 0.8166-12.13 0.8854-19.6 0.2722-38.18-7.715-52.49-22.56-15.97-16.57-23.43-35.49-23.41-59.37 0.01786-16.86 3.547-29.88 11.93-44 9.617-16.19 27.39-30.13 43.89-34.41 2.517-0.653 4.748-1.36 4.958-1.571 0.2103-0.2107-0.05169-3.078-0.5816-6.371-1.41-8.759-0.556-21.84 1.997-30.61 7.023-24.1 24.96-41.95 48.52-48.31 11.42-3.082 29.45-2.167 40.42 2.049 0.919 0.3533 1.637-0.7202 2.994-4.474 6.21-17.18 18.79-33.75 33.11-43.62 35.65-24.56 80.99-19.9 111.3 11.44l5.539 5.719 5.025-1.229c2.764-0.6762 9.075-1.428 14.02-1.672 16.17-0.7944 31.64 3.865 45.31 13.64l5.1 3.647 12.55 0.1171c9.984 0.09312 13.77 0.4491 18.49 1.739 29.1 7.945 50.37 32.58 56 64.86 1.354 7.764 1.096 21.6-0.5502 29.5l-0.916 4.394 5.367 7.086c20.1 26.54 25.52 61.05 14.68 93.52-7.862 23.55-24.99 43.53-46.38 54.11-10.16 5.023-23.1 8.587-31.28 8.613-3.79 0.0118-4.555 0.333-8.217 3.446-6.958 5.916-20.59 13.71-28.3 16.17-1.722 0.551-4.011 1.599-5.087 2.328-1.076 0.7297-8.119 4.802-15.65 9.05-18.57 10.47-37.53 22.69-48.72 31.39-13.27 10.32-16.83 22.63-14.72 50.94 2.648 35.64 8.059 59.41 16.33 71.75l2.89 4.313 29.4 0.4963c34.14 0.5764 92.53 2.291 93.01 2.731 0.1793 0.166-74.3 0.2503-165.5 0.1877-91.21-0.0631-161.4-0.392-156-0.732zm130.9-101.8c-0.1092-1.007-3.147-5.947-6.75-10.98-7.889-11.01-19.71-28.99-22.37-34.01-1.594-3.014-2.402-3.727-4.695-4.139-7.259-1.304-17.91-5.324-27.58-10.41-1.809-0.9509 5.669 20.15 9.032 25.49 4.859 7.714 27.69 24.94 45.08 34 5.177 2.7 7.575 2.715 7.285 0.0442zm6.168-19.46c0.8235-0.9976 1.074-4.638 1.074-15.62 0-7.875-0.1764-14.5-0.3923-14.71-0.2158-0.2163-2.307 0.1044-4.647 0.7128-2.34 0.6082-7 1.335-10.35 1.616-7.067 0.5907-6.896 0-2.984 10.28 2.73 7.17 6.328 12.81 10.4 16.3 3.513 3.013 5.293 3.38 6.908 1.424zm49.91-15.13c3.913-2 11.37-9.412 15.96-15.85 3.982-5.592 8.688-15 8.214-16.42-0.1628-0.49-3.275-1.75-6.916-2.799-3.641-1.049-9.568-3.501-13.17-5.449l-6.551-3.541-2.173 2.087c-2.148 2.062-2.179 2.234-2.645 14.37-0.2592 6.754-0.6282 15.17-0.8198 18.7-0.3026 5.572-0.1405 6.682 1.232 8.43 1.896 2.415 2.946 2.489 6.867 0.484zm-118.1-5.725c-2.19-4.729-6.256-17.66-6.256-19.89 0-0.8683-1.901-1.089-9.391-1.089-5.165 0-9.391 0.2195-9.391 0.488 0 1.561 25.33 25.39 26.99 25.39 0.1762 0-0.7011-2.206-1.949-4.901zm149.8-9.536c5.487-3.687 19.46-14.65 19.07-14.96-0.126-0.1032-4.197-0.3888-9.046-0.6338l-8.816-0.4452-3.967 5.891c-4.284 6.363-7.088 11.99-6.473 12.98 0.9066 1.47 4.434 0.3864 9.228-2.836z",fill:"#13ad73"},null,-1),We=e("path",{d:"m253.9 167.7c-0.2579 0.0513-1.238 0.5454-4.691 0.5216-3.625-0.0248 4.941 9.227 6.934 34.4-8.031-0.4678-8.408-3.285-24.81-5.999-15.88-2.627-25.28 5.883-29.57 18.88-3.429 10.39-3.592 23.66-1.19 36.39 2.348 12.45 7.148 24.39 13.74 32.65 6.909 8.654 14.05 10.96 20.49 10.82 8.459-0.1842 15.7-4.599 19.58-4.407 6.726 0.3331 13.29 8.894 28.17 2.151 6.047-2.741 12.03-7.819 17.08-14.81 4.984-6.907 9.051-15.68 11.35-25.91 2.018-8.972 2.678-19.07 1.41-30-1.616-13.93-7.519-20.42-14.9-23.01-8.286-2.905-18.43-0.8896-26.46 1.032-4.71 1.127-8.69 2.223-11.14 2.273-0.155 3e-3 -0.2829-4.1e-4 -0.4335 2e-3 -0.01-0.0695-0.0197-0.1385-0.0323-0.2078-2.249-11.58-4.704-29.29-5.401-33.64-0.152-0.9486 0.0845-1.177-0.1162-1.137z",fill:"#f2ac05","fill-rule":"evenodd"},null,-1),Ke=[qe,We];function Ye(s,t){return f(),$("svg",Xe,Ke)}var Ge=Q(He,[["render",Ye]]);const Je={},Qe={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Ze=e("path",{d:"m12 0c-6.624 0-12 5.376-12 12s5.376 12 12 12 12-5.376 12-12-5.376-12-12-12zm0 3.6c1.992 0 3.6 1.608 3.6 3.6s-1.608 3.6-3.6 3.6-3.6-1.608-3.6-3.6 1.608-3.6 3.6-3.6zm0 17.04c-3 0-5.652-1.536-7.2-3.864 0.036-2.388 4.8-3.696 7.2-3.696 2.388 0 7.164 1.308 7.2 3.696-1.548 2.328-4.2 3.864-7.2 3.864z"},null,-1),et=[Ze];function tt(s,t){return f(),$("svg",Qe,et)}var nt=Q(Je,[["render",tt]]);const at={},lt={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},ot=e("path",{d:"m12 0-2.115 2.115 8.37 8.385h-18.255v3h18.255l-8.37 8.385 2.115 2.115 12-12z"},null,-1),st=[ot];function it(s,t){return f(),$("svg",lt,st)}var ge=Q(at,[["render",it]]);const ut=e("div",{id:"app-name"},[e("span",null,"Hey"),e("span",null,[P("Apple"),e("sup",null,"beta")])],-1),rt={id:"nav-main"},ct={id:"nav-user"},dt={href:"https://docs.heyapple.org",target:"_blank"},mt={setup(s){const{t}=J(),i=U("csrfToken");function d(o){o.preventDefault(),fetch("/auth/local",{method:"DELETE",headers:{"X-CSRF-Token":i}}).then(c=>{c.ok?window.location="/":window.dispatchEvent(new CustomEvent("error",{detail:{msg:t("signout.err"+c.status)}}))})}function l(o){o.stopPropagation(),document.querySelector("header nav").classList.toggle("open")}return document.addEventListener("click",function(){document.querySelector("header nav").classList.remove("open")}),(o,c)=>(f(),$("header",null,[b(Ge,{id:"logo"}),ut,e("nav",null,[e("button",{onClick:l},[b(ge)]),e("ul",rt,[e("li",null,[b(n(ie),{to:"/"},{default:N(()=>[P(a(n(t)("nav.diary")),1)]),_:1})]),e("li",null,[b(n(ie),{to:"/food"},{default:N(()=>[P(a(n(t)("nav.food")),1)]),_:1})]),e("li",null,[b(n(ie),{to:"/recipes"},{default:N(()=>[P(a(n(t)("nav.recipes")),1)]),_:1})]),e("li",null,[b(n(ie),{to:"/shopping"},{default:N(()=>[P(a(n(t)("nav.shopping")),1)]),_:1})])]),e("ul",ct,[e("li",null,[b(n(ie),{to:"/profile"},{default:N(()=>[P(a(n(t)("nav.profile")),1)]),_:1})]),e("li",null,[b(n(ie),{to:"/settings"},{default:N(()=>[P(a(n(t)("nav.settings")),1)]),_:1})]),e("li",null,[e("a",dt,a(n(t)("nav.help")),1)]),e("li",null,[e("a",{href:"#",onClick:d},a(n(t)("nav.signout")),1)])])]),e("button",{onClick:l},[b(nt)])]))}},vt={},ht={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},ft=e("path",{d:"m7.6364 17.318-5.7273-5.7273-1.9091 1.9091 7.6364 7.6364 16.364-16.364-1.9091-1.9091z"},null,-1),_t=[ft];function pt(s,t){return f(),$("svg",ht,_t)}var ye=Q(vt,[["render",pt]]);const gt={},bt={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},yt=e("path",{d:"m12 1.6364-12 20.727h24zm0 4.353 8.2159 14.192h-16.43zm-1.0909 4.3743v5.4545h2.1818v-5.4545zm0 6.5455v2.1818h2.1818v-2.1818z"},null,-1),$t=[yt];function kt(s,t){return f(),$("svg",bt,$t)}var wt=Q(gt,[["render",kt]]);const xt={props:["msg"],emits:["timeout"],setup(s,{emit:t}){const i=s;return he(()=>{setTimeout(function(){t("timeout",i.msg.id)},i.msg.time)}),(d,l)=>(f(),$("div",{class:O(["message",[s.msg.type,s.msg.id]])},[s.msg.type=="message"?(f(),K(ye,{key:0})):q("",!0),s.msg.type!="message"?(f(),K(wt,{key:1})):q("",!0),e("p",null,a(s.msg.msg),1)],2))}};const Ct={id:"messages"},Lt={setup(s){const t=k([]);let i=0;function d(o){t.value.push({id:i++,type:o.type,msg:o.detail.msg,time:o.detail.timeout})}function l(o){t.value=t.value.filter(c=>c.id!=o)}return he(()=>{window.addEventListener("message",d),window.addEventListener("warning",d),window.addEventListener("error",d)}),(o,c)=>(f(),$("div",Ct,[(f(!0),$(G,null,te(t.value,u=>(f(),K(xt,{key:u.id,msg:u,onTimeout:l},null,8,["msg"]))),128))]))}};const It={setup(s){return he(()=>{document.querySelector("body > .spinner-container").remove()}),(t,i)=>(f(),$(G,null,[b(mt),b(n(Oe)),b(Lt)],64))}},St={},Tt={version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Et=e("path",{id:"path-top",d:"m0 3v2h24v-2z"},null,-1),Mt=e("path",{id:"path-mid",d:"m0 13h24v-2h-24z"},null,-1),Ft=e("path",{id:"path-bottom",d:"m0 21h24v-2h-24z"},null,-1),Dt=[Et,Mt,Ft];function zt(s,t){return f(),$("svg",Tt,Dt)}var At=Q(St,[["render",zt]]);const Rt={},Ot={width:"512",height:"512",version:"1.1",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},Pt=e("path",{d:"m251.2 4.007c-17.24-0.2277-34.69 4.924-50.29 15.67-14.33 9.866-26.9 26.43-33.11 43.62-1.357 3.754-2.073 4.828-2.992 4.475-10.97-4.217-29-5.131-40.42-2.049-23.57 6.359-41.5 24.22-48.52 48.31-2.553 8.761-3.407 21.84-1.997 30.6 0.5299 3.293 0.7902 6.162 0.5799 6.372-0.2104 0.2108-2.439 0.9186-4.956 1.572-16.5 4.283-34.28 18.21-43.89 34.41-8.382 14.11-11.91 27.14-11.93 44-0.02401 23.88 7.433 42.79 23.41 59.36 14.31 14.85 32.89 22.84 52.49 22.56 4.95-0.0689 10.41-0.4681 12.13-0.8863 2.9-0.7045 3.245-0.6061 4.695 1.334 8.833 11.82 16.82 18.58 29.19 24.7 6.707 3.32 9.412 5.257 16.09 11.53 24.85 23.35 47.68 40.8 76.05 58.12 9.503 5.8 18.01 13.61 20.54 18.86 3.313 6.878 3.637 11.06 1.825 23.56-2.778 19.18-7.936 38.33-13.13 48.74l-2.639 5.295h-13.49c-16.17-3e-3 -92.41 2.205-106.2 3.077l0.01-3e-3c-5.381 0.3399 64.84 0.6684 156 0.7315 91.2 0.0625 165.7-0.0216 165.5-0.1878-0.4753-0.4399-58.86-2.155-93-2.731l-29.4-0.4942-2.89-4.313c-8.274-12.35-13.68-36.12-16.33-71.76-2.105-28.31 1.454-40.62 14.72-50.94 11.18-8.699 30.14-20.92 48.72-31.39 7.533-4.248 14.57-8.318 15.65-9.048 1.076-0.7296 3.366-1.779 5.087-2.33 7.71-2.467 21.34-10.26 28.3-16.17 3.662-3.113 4.427-3.435 8.218-3.446 8.183-0.0267 21.12-3.59 31.28-8.613 21.39-10.58 38.52-30.56 46.38-54.11 10.84-32.47 5.42-66.98-14.68-93.52l-5.364-7.084 0.916-4.395c1.646-7.896 1.904-21.74 0.5502-29.5-5.632-32.29-26.9-56.92-56-64.86-4.726-1.29-8.51-1.647-18.49-1.74l-12.55-0.1186-5.101-3.647c-13.67-9.776-29.15-14.43-45.31-13.64-4.95 0.2432-11.26 0.9944-14.02 1.671l-5.028 1.229-5.539-5.72c-17.07-17.63-38.89-26.81-61.05-27.1zm2.728 163.7c0.2008-0.0398-0.0367 0.1881 0.1154 1.137 0.6972 4.35 3.151 22.06 5.4 33.64 0.0118 0.0694 0.0228 0.138 0.0328 0.2076 0.1506-2e-3 0.2799 9e-5 0.4349-3e-3 2.448-0.0501 6.427-1.143 11.14-2.27 8.028-1.922 18.18-3.94 26.46-1.035 7.379 2.587 13.28 9.078 14.9 23.01 1.268 10.94 0.6106 21.03-1.407 30-2.301 10.23-6.37 19.01-11.35 25.91-5.045 6.991-11.03 12.07-17.07 14.81-14.87 6.743-21.44-1.818-28.16-2.152-3.88-0.1922-11.12 4.224-19.58 4.409-6.437 0.1402-13.58-2.169-20.49-10.82-6.596-8.262-11.39-20.2-13.74-32.65-2.402-12.73-2.24-26 1.189-36.39 4.29-13 13.69-21.51 29.58-18.88 16.41 2.714 16.78 5.532 24.81 6-1.993-25.18-10.56-34.43-6.936-34.4 3.453 0.0238 4.434-0.4726 4.692-0.5239zm45.16 159.1 6.55 3.542c3.603 1.947 9.529 4.401 13.17 5.45 3.641 1.049 6.753 2.307 6.916 2.797 0.4733 1.423-4.232 10.83-8.214 16.42-4.588 6.442-12.05 13.85-15.96 15.86-3.919 2.004-4.971 1.93-6.867-0.4843-1.372-1.748-1.532-2.86-1.229-8.432 0.1916-3.529 0.558-11.94 0.8171-18.7 0.4657-12.13 0.4983-12.3 2.646-14.37zm35.38 12.77 8.817 0.4448c4.849 0.245 8.919 0.5294 9.045 0.6326 0.3835 0.315-13.58 11.27-19.07 14.96-4.795 3.222-8.322 4.307-9.229 2.837-0.6151-0.9971 2.187-6.619 6.471-12.98zm-166.7 4.596c7.489 0 9.391 0.219 9.391 1.087 0 2.234 4.067 15.16 6.257 19.89 1.248 2.694 2.123 4.9 1.947 4.9-1.66 0-26.99-23.83-26.99-25.39 0-0.2685 4.226-0.4876 9.391-0.4876zm16.13 1.727c0.0388-0.0118 0.0851-6e-3 0.1417 0.0231 9.674 5.087 20.32 9.107 27.58 10.41 2.293 0.4121 3.101 1.124 4.695 4.138 2.657 5.026 14.48 23 22.37 34.02 3.603 5.03 6.639 9.968 6.748 10.98 0.2897 2.671-2.108 2.658-7.285-0.0429-17.39-9.068-40.22-26.29-45.07-34.01-3.258-5.172-10.38-25.14-9.173-25.52zm67.9 9.71c0.263-9e-3 0.4337 9e-3 0.4876 0.0625 0.2159 0.2154 0.3921 6.837 0.3921 14.71 0 10.98-0.2506 14.62-1.074 15.62-1.615 1.956-3.397 1.59-6.909-1.423-4.068-3.49-7.665-9.13-10.4-16.3-3.912-10.28-4.082-9.686 2.985-10.28 3.355-0.2804 8.013-1.006 10.35-1.615 1.755-0.4562 3.373-0.7502 4.162-0.7776z"},null,-1),Nt=[Pt];function Vt(s,t){return f(),$("svg",Ot,Nt)}var jt=Q(Rt,[["render",Vt]]);const Bt={},Ut={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Ht=e("path",{d:"m12 6c1.65 0 3-1.35 3-3s-1.35-3-3-3-3 1.35-3 3 1.35 3 3 3zm0 3c-1.65 0-3 1.35-3 3s1.35 3 3 3 3-1.35 3-3-1.35-3-3-3zm0 9c-1.65 0-3 1.35-3 3s1.35 3 3 3 3-1.35 3-3-1.35-3-3-3z"},null,-1),Xt=[Ht];function qt(s,t){return f(),$("svg",Ut,Xt)}var Me=Q(Bt,[["render",qt]]);const Wt={id:"filter"},Kt=P(" This is the main search & filter area"),Yt={id:"main"},Gt={class:"controls"},Jt=e("span",{class:"spacer"},null,-1),Qt={class:"content"},Zt=P("This is the main area"),en={id:"details"},tn={class:"controls"},nn=e("span",{class:"spacer"},null,-1),an={class:"placeholder"},ce={emits:["detailVisibility"],setup(s,{expose:t,emit:i}){const{t:d}=J(),l=k(""),o=k("");function c(){l.value==""?(l.value="open-filter",o.value="",i("detailVisibility")):l.value=""}function u(){i("detailVisibility"),o.value==""?(o.value="open-details",l.value=""):o.value=""}function w(){i("detailVisibility"),o.value==""&&(o.value="open-details",l.value="")}return t({showDetails:w}),(m,y)=>(f(),$("main",{class:O([l.value,o.value])},[e("div",Wt,[ue(m.$slots,"filter",{},()=>[Kt])]),e("div",Yt,[e("div",Gt,[e("button",{onClick:c,class:"open-filter icon"},[b(At)]),Jt,e("button",{onClick:u,class:"open-details icon"},[b(Me)])]),e("div",Qt,[ue(m.$slots,"main",{},()=>[Zt])])]),e("div",en,[e("div",tn,[ue(m.$slots,"head-details"),nn,e("button",{onClick:u,class:"open-details icon"},[b(ge)])]),ue(m.$slots,"details",{},()=>[e("div",an,[b(jt),e("p",null,a(n(d)("details.noitem")),1)])])])],2))}},ln=["placeholder"],on=P("Additional filters"),Fe={props:["data","placeholder"],emits:["result"],setup(s,{emit:t}){const i=s;var d=void 0;function l(c){c.preventDefault(),clearTimeout(d),d=setTimeout(function(){o(c.target.closest("form"))},500)}function o(c){let u=new FormData(c),w=i.data.filter(m=>{let y=m.size||1;for(let v of u.keys()){if(v=="name"){let L=u.get(v).toLowerCase();if(!m[v].toLowerCase().includes(L))return!1;continue}let[x,T]=u.getAll(v).map(L=>parseFloat(L));if(!isNaN(x)&&!isNaN(T)&&(m[v]/y<x||T<m[v]/y))return!1}return!0});t("result",w)}return(c,u)=>(f(),$("form",null,[e("input",{type:"text",name:"name",autocomplete:"off",placeholder:s.placeholder,onInput:l},null,40,ln),ue(c.$slots,"default",{confirm:l},()=>[on])]))}};const sn={class:"slider"},un=["name","value"],rn=P(" \xA0\u2013\xA0 "),cn=["name","value"],dn={class:"bar"},mn={class:"slide"},vn=e("div",{class:"interact-area"},null,-1),hn=[vn],fn=e("div",{class:"interact-area"},null,-1),_n=[fn],Y={props:["label","name","unit","min","max","frac"],emits:["input"],setup(s,{emit:t}){const i=s,{t:d}=J(),l=k(parseFloat(i.min).toFixed(i.frac)),o=k(parseFloat(i.max).toFixed(i.frac)),c=k(0),u=k(100);ke(()=>i.min,(r,_)=>w(r)),ke(()=>i.max,(r,_)=>m(r));function w(r){let _=parseFloat(i.min)||0,I=parseFloat(r)||_;l.value=I,o.value=Math.max(l.value,o.value);let S=parseFloat(i.max)||0;c.value=(I-_)*100/(S-_),u.value=Math.max(c.value,u.value)}function m(r){let _=parseFloat(i.max)||0,I=parseFloat(r)||_;o.value=I,l.value=Math.min(l.value,o.value);let S=parseFloat(i.min)||0;u.value=(I-S)*100/(_-S),c.value=Math.min(c.value,u.value)}function y(r){r.target.blur(),w(r.target.value),t("input",r)}function v(r){r.target.blur(),m(r.target.value),t("input",r)}function x(r){let I=r.target.closest(".slide").getBoundingClientRect(),S=r.pageX!==void 0?r.pageX:r.changedTouches[0].pageX;S=Math.min(Math.max(S-I.left,0),I.width);let E=S*100/I.width,A=parseFloat(i.min)||0,F=parseFloat(i.max)||0,z=E/100*(F-A)+A;r.target.closest("button").classList.contains("min")?(l.value=z.toFixed(i.frac),o.value=Math.max(l.value,o.value),c.value=E,u.value=Math.max(c.value,u.value)):(o.value=z.toFixed(i.frac),l.value=Math.min(l.value,o.value),u.value=E,c.value=Math.min(c.value,u.value)),t("input",r)}function T(r){let _=r.target.closest("button");_.addEventListener("mousemove",x),_.addEventListener("touchmove",x),_.addEventListener("mouseup",L),_.addEventListener("touchend",L),_.addEventListener("mouseleave",L),_.addEventListener("touchcancel",L),_.classList.add("active")}function L(r){let _=r.target.closest("button");_.removeEventListener("mousemove",x),_.removeEventListener("touchmove",x),_.removeEventListener("mouseup",L),_.removeEventListener("touchend",L),_.removeEventListener("mouseleave",L),_.removeEventListener("touchcancel",L),_.classList.remove("active")}return(r,_)=>(f(),$("div",sn,[e("label",null,[e("span",null,a(s.label)+" ("+a(n(d)("unit."+s.unit))+")",1),e("input",{type:"text",name:s.name,value:l.value,onChange:y},null,40,un),rn,e("input",{type:"text",name:s.name,value:o.value,onChange:v},null,40,cn)]),e("div",dn,[e("div",mn,[e("div",{class:"overlay",style:pe({left:c.value+"%",right:100-u.value+"%"})},null,4),e("button",{type:"button",class:"handle min",style:pe({left:c.value+"%"}),onMousedown:T,onTouchstart:T},hn,36),e("button",{type:"button",class:"handle max",style:pe({left:u.value+"%"}),onMousedown:T,onTouchstart:T},_n,36)])])]))}};const pn={class:"clickable-input"},gn=["placeholder"],bn=["value"],De={props:["label","placeholder"],emits:["confirm"],setup(s,{emit:t}){const i=k("");function d(l){l.preventDefault(),t("confirm",i.value),i.value=""}return(l,o)=>(f(),$("form",pn,[re(e("input",{type:"text",autocomplete:"off","onUpdate:modelValue":o[0]||(o[0]=c=>i.value=c),placeholder:s.placeholder},null,8,gn),[[xe,i.value]]),e("input",{type:"submit",onClick:d,value:s.label},null,8,bn)]))}};const yn={class:"clickable-select"},$n={value:"0",selected:""},kn=["value"],wn=["disabled"],xn={props:["label","placeholder","items","disabled"],emits:["confirm"],setup(s,{emit:t}){const i=s,{locale:d}=J(),l=k(0),o=new Intl.Collator(d.value,{numeric:!0}),c=X(()=>[...i.items].sort((w,m)=>o.compare(w.name,m.name)));function u(w){w.preventDefault(),l.value&&t("confirm",l.value)}return(w,m)=>(f(),$("form",yn,[re(e("select",{"onUpdate:modelValue":m[0]||(m[0]=y=>l.value=y)},[e("option",$n,a(s.placeholder),1),(f(!0),$(G,null,te(n(c),y=>(f(),$("option",{key:y.id,value:y.id},a(y.name),9,kn))),128))],512),[[we,l.value]]),e("button",{type:"submit",class:"async",onClick:u,disabled:s.disabled},a(s.label),9,wn)]))}};const Cn={class:"clickable-date"},Ln=["value"],In=["value"],Sn=["disabled"],ze={props:["label","date","time","disabled"],emits:["confirm"],setup(s,{emit:t}){function i(d){d.preventDefault();let l=new FormData(d.target.closest("form"));t("confirm",l.get("date"),l.get("time"))}return(d,l)=>(f(),$("form",Cn,[e("input",{type:"date",name:"date",value:s.date},null,8,Ln),e("input",{type:"time",name:"time",value:s.time},null,8,In),e("button",{type:"submit",class:"async",onClick:i,disabled:s.disabled},a(s.label),9,Sn)]))}};const Tn={},En={class:"icon sort-arrow"};function Mn(s,t){return f(),$("span",En)}var ae=Q(Tn,[["render",Mn]]);const Fn=["onClick"],Dn={class:"name"},zn={class:"num"},An={class:"unit"},Rn={class:"m num"},On={class:"unit"},Pn={class:"m num"},Nn={class:"unit"},Vn={class:"m num"},jn={class:"unit"},Ae={props:["items"],emits:"selected",setup(s,{emit:t}){const i=s,{t:d,locale:l}=J(),o=k("name"),c=k("asc"),u=new Intl.Collator(l.value,{numeric:!0}),w=X(()=>c.value=="asc"?[...i.items].sort((v,x)=>u.compare(v[o.value],x[o.value])):[...i.items].sort((v,x)=>-u.compare(v[o.value],x[o.value])));function m(v,x,T=1){return x?+parseFloat(v/x).toFixed(T):v}function y(v){let x=v.target.dataset.sort;o.value==x?c.value=c.value=="asc"?"desc":"asc":o.value=x}return(v,x)=>(f(),$("table",null,[e("thead",null,[e("tr",{class:O(c.value)},[e("th",{class:O(["name sort",{active:o.value=="name"}]),onClick:y,"data-sort":"name"},[P(a(n(d)("food.name"))+" ",1),b(ae)],2),e("th",{class:O(["num sort",{active:o.value=="kcal"}]),onClick:y,"data-sort":"kcal"},[b(ae),P(" "+a(n(d)("food.energy")),1)],2),e("th",{class:O(["m num sort",{active:o.value=="fat"}]),onClick:y,"data-sort":"fat"},[b(ae),P(" "+a(n(d)("food.fat")),1)],2),e("th",{class:O(["m num sort",{active:o.value=="carb"}]),onClick:y,"data-sort":"carb"},[b(ae),P(" "+a(n(d)("food.carbs2")),1)],2),e("th",{class:O(["m num sort",{active:o.value=="prot"}]),onClick:y,"data-sort":"prot"},[b(ae),P(" "+a(n(d)("food.protein")),1)],2)],2)]),e("tbody",null,[(f(!0),$(G,null,te(n(w),T=>(f(),$("tr",{key:T.id,onClick:L=>v.$emit("selected",T.id)},[e("td",Dn,a(T.name),1),e("td",zn,[P(a(m(T.kcal,T.size))+" ",1),e("span",An,a(n(d)("unit.cal")),1)]),e("td",Rn,[P(a(m(T.fat,T.size))+" ",1),e("span",On,a(n(d)("unit.g")),1)]),e("td",Pn,[P(a(m(T.carb,T.size))+" ",1),e("span",Nn,a(n(d)("unit.g")),1)]),e("td",Vn,[P(a(m(T.prot,T.size))+" ",1),e("span",jn,a(n(d)("unit.g")),1)])],8,Fn))),128))])]))}},Bn={},Un={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Hn=e("path",{d:"m-7.5e-8 19.001v4.9993h4.9993l14.745-14.745-4.9993-4.9993zm23.61-13.611c0.51993-0.51993 0.51993-1.3598 0-1.8797l-3.1196-3.1196c-0.51993-0.51993-1.3598-0.51993-1.8797 0l-2.4397 2.4397 4.9993 4.9993z"},null,-1),Xn=[Hn];function qn(s,t){return f(),$("svg",Un,Xn)}var Ce=Q(Bn,[["render",qn]]);const Wn={key:0,class:"new-item"},Kn=e("hr",null,null,-1),Yn=e("section",{class:"subtitle"},"Some food category",-1),Gn={class:"tags"},Jn=e("span",{class:"tag"},"Tag 1",-1),Qn=e("span",{class:"tag"},"Tag 2",-1),Zn=e("span",{class:"tag"},"Tag 3",-1),ea=["disabled"],ta=e("hr",null,null,-1),na={class:"tracking no-edit-mode"},aa={class:"tracking-amount"},la={class:"unit"},oa=e("label",null,"Add to recipe",-1),sa=e("label",null,"Add to diary",-1),ia=e("hr",null,null,-1),ua={class:"nutrient-block"},ra=["disabled"],ca=["value"],da={class:"unit"},ma=["value"],va={class:"unit"},ha=["value"],fa={class:"unit"},_a=["value"],pa={class:"unit"},ga=["value"],ba={class:"unit"},ya=["disabled"],$a=["value"],ka={class:"unit"},wa=["value"],xa={class:"unit"},Ca=["value"],La={class:"unit"},Ia=["value"],Sa={class:"unit"},Ta=["value"],Ea={class:"unit"},Ma={setup(s){const{t}=J(),i=U("log"),d=U("csrfToken"),l=U("perms"),o=U("food"),c=U("recipes"),u=U("diary"),w=k([]),m=k(null),y=k(!1),v=k(!1),x=k(!1),T=k(!1),L=k(100),r=k(V.now().toISODate()),_=k(V.now().toLocaleString(V.TIME_24_SIMPLE)),I=k(null),S=k(null);function E(p){fetch("/api/v1/food",{method:"POST",headers:{"X-CSRF-Token":d}}).then(h=>{if(!h.ok)throw t("createfood.err"+h.status);return h.json()}).then(h=>{h.name=p,o.value.push(h),w.value.push(h),i.msg(t("createfood.ok")),W(h.id)}).catch(h=>i.err(h))}function A(){v.value=!0;let p=m.value.id;fetch("/api/v1/food/"+p,{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":d},body:new URLSearchParams(new FormData(S.value))}).then(h=>{if(!h.ok)throw t("savefood.err"+h.status);return y.value=!1,fetch("/api/v1/food/"+p)}).then(h=>h.json()).then(h=>{h.name=t(h.id.toString()),o.value=o.value.map(g=>h.id==g.id?h:g),w.value=w.value.map(g=>h.id==g.id?h:g),m.value=m.value.id==h.id?h:m.value,i.msg(t("savefood.ok"))}).catch(h=>i.err(h)).finally(()=>{setTimeout(function(){v.value=!1},500)})}function F(p){x.value=!0,fetch(`/api/v1/recipe/${p}/ingredient/${m.value.id}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":d},body:new URLSearchParams({amount:L.value})}).then(h=>{if(!h.ok)throw t("addfood.err"+h.status);return fetch("/api/v1/recipe/"+p)}).then(h=>h.json()).then(h=>{c.value=c.value.map(g=>h.id==g.id?h:g),L.value=100,i.msg(t("addfood.ok"))}).catch(h=>i.err(h)).finally(()=>{setTimeout(function(){x.value=!1},500)})}function z(p,h){T.value=!0,fetch(`/api/v1/diary/${p}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":d},body:new URLSearchParams({id:m.value.id,amount:L.value,time:h,recipe:""})}).then(g=>{if(!g.ok)throw t("savediary.err"+g.status);return fetch("/api/v1/diary/"+p.replaceAll("-","/"))}).then(g=>g.json()).then(g=>{u.value[p]=g[0],L.value=100,i.msg(t("savediary.ok"))}).catch(g=>i.err(g)).finally(()=>{setTimeout(function(){T.value=!1},500)})}function j(p){w.value=p,m.value&&w.value.filter(h=>h.id==m.value.id).length==0&&(m.value=null)}function W(p){m.value=w.value.filter(h=>h.id==p)[0],r.value=V.now().toISODate(),_.value=V.now().toLocaleString(V.TIME_24_SIMPLE),L.value=100,I.value.showDetails()}function B(){y.value?A():y.value=!0}function C(p){p.target.blur(),isNaN(parseFloat(p.target.value))&&(p.target.value=m.value[p.target.name])}return(p,h)=>(f(),K(ce,{ref_key:"main",ref:I,onDetailVisibility:h[1]||(h[1]=g=>y.value=!1),class:O({"edit-mode":y.value})},Ee({filter:N(()=>[n(l).canCreateFood?(f(),$("section",Wn,[e("h2",null,a(n(t)("aria.headnew")),1),b(De,{label:n(t)("btn.new"),placeholder:n(t)("food.hintnew"),onConfirm:E},null,8,["label","placeholder"])])):q("",!0),Kn,e("section",null,[e("h2",null,a(n(t)("aria.headsearch")),1),b(Fe,{data:n(o),placeholder:n(t)("food.hintsearch"),onResult:j},{default:N(g=>[e("fieldset",null,[e("legend",null,a(n(t)("aria.headmacro1")),1),b(Y,{label:n(t)("food.energy"),onInput:g.confirm,name:"kcal",unit:"cal",min:"0",max:"900",frac:"0"},null,8,["label","onInput"]),b(Y,{label:n(t)("food.fat"),onInput:g.confirm,name:"fat",unit:"g",min:"0",max:"100",frac:"0"},null,8,["label","onInput"]),b(Y,{label:n(t)("food.carbs"),onInput:g.confirm,name:"carb",unit:"g",min:"0",max:"100",frac:"0"},null,8,["label","onInput"]),b(Y,{label:n(t)("food.protein"),onInput:g.confirm,name:"prot",unit:"g",min:"0",max:"89",frac:"0"},null,8,["label","onInput"]),b(Y,{label:n(t)("food.fiber"),onInput:g.confirm,name:"fib",unit:"g",min:"0",max:"71",frac:"0"},null,8,["label","onInput"])]),e("fieldset",null,[e("legend",null,a(n(t)("aria.headmacro2")),1),b(Y,{label:n(t)("food.fatsat"),onInput:g.confirm,name:"fatsat",unit:"g",min:"0",max:"83",frac:"0"},null,8,["label","onInput"]),b(Y,{label:n(t)("food.fato3"),onInput:g.confirm,name:"fato3",unit:"g",min:"0",max:"54",frac:"0"},null,8,["label","onInput"]),b(Y,{label:n(t)("food.fato6"),onInput:g.confirm,name:"fato6",unit:"g",min:"0",max:"70",frac:"0"},null,8,["label","onInput"]),b(Y,{label:n(t)("food.sugar"),onInput:g.confirm,name:"sug",unit:"g",min:"0",max:"100",frac:"0"},null,8,["label","onInput"]),b(Y,{label:n(t)("food.salt"),onInput:g.confirm,name:"salt",unit:"g",min:"0",max:"100",frac:"0"},null,8,["label","onInput"])])]),_:1},8,["data","placeholder"])])]),main:N(()=>[b(Ae,{items:w.value,onSelected:W},null,8,["items"])]),_:2},[m.value?{name:"head-details",fn:N(()=>[e("h2",null,a(m.value.name),1)])}:void 0,m.value?{name:"details",fn:N(()=>[Yn,e("section",Gn,[Jn,Qn,Zn,n(l).canCreateFood||n(l).canEditFood?(f(),$("button",{key:0,class:"icon async",disabled:v.value,onClick:B},[y.value?q("",!0):(f(),K(Ce,{key:0})),y.value?(f(),K(ye,{key:1})):q("",!0)],8,ea)):q("",!0)]),ta,e("section",na,[e("h2",null,a(n(t)("aria.headtrack")),1),e("fieldset",aa,[e("div",null,[e("label",null,a(n(t)("food.amount")),1),re(e("input",{type:"number","onUpdate:modelValue":h[0]||(h[0]=g=>L.value=g),name:"amount"},null,512),[[xe,L.value]]),e("span",la,a(n(t)("unit.g")),1)])]),e("fieldset",null,[oa,b(xn,{label:n(t)("btn.add"),placeholder:n(t)("food.hintrec"),items:n(c),disabled:x.value,onConfirm:F},null,8,["label","placeholder","items","disabled"])]),e("fieldset",null,[sa,b(ze,{label:n(t)("btn.add"),time:_.value,date:r.value,disabled:T.value,onConfirm:z},null,8,["label","time","date","disabled"])])]),ia,e("section",null,[e("h2",null,a(n(t)("aria.headnutrients")),1),e("form",{ref_key:"form",ref:S},[e("div",ua,[e("fieldset",{disabled:!y.value,class:"col50"},[e("div",null,[e("label",null,a(n(t)("food.energy")),1),e("input",{type:"text",value:m.value.kcal,name:"kcal",onChange:C},null,40,ca),e("span",da,a(n(t)("unit.cal")),1)]),e("div",null,[e("label",null,a(n(t)("food.fat")),1),e("input",{type:"text",value:m.value.fat,name:"fat",onChange:C},null,40,ma),e("span",va,a(n(t)("unit.g")),1)]),e("div",null,[e("label",null,a(n(t)("food.carbs2")),1),e("input",{type:"text",value:m.value.carb,name:"carb",onChange:C},null,40,ha),e("span",fa,a(n(t)("unit.g")),1)]),e("div",null,[e("label",null,a(n(t)("food.protein")),1),e("input",{type:"text",value:m.value.prot,name:"prot",onChange:C},null,40,_a),e("span",pa,a(n(t)("unit.g")),1)]),e("div",null,[e("label",null,a(n(t)("food.fiber")),1),e("input",{type:"text",value:m.value.fib,name:"fib",onChange:C},null,40,ga),e("span",ba,a(n(t)("unit.g")),1)])],8,ra),e("fieldset",{disabled:!y.value,class:"col50"},[e("div",null,[e("label",null,a(n(t)("food.fatsat")),1),e("input",{type:"text",value:m.value.fatsat,name:"fatsat",onChange:C},null,40,$a),e("span",ka,a(n(t)("unit.g")),1)]),e("div",null,[e("label",null,a(n(t)("food.fato3")),1),e("input",{type:"text",value:m.value.fato3,name:"fato3",onChange:C},null,40,wa),e("span",xa,a(n(t)("unit.g")),1)]),e("div",null,[e("label",null,a(n(t)("food.fato6")),1),e("input",{type:"text",value:m.value.fato6,name:"fato6",onChange:C},null,40,Ca),e("span",La,a(n(t)("unit.g")),1)]),e("div",null,[e("label",null,a(n(t)("food.sugar")),1),e("input",{type:"text",value:m.value.sug,name:"sug",onChange:C},null,40,Ia),e("span",Sa,a(n(t)("unit.g")),1)]),e("div",null,[e("label",null,a(n(t)("food.salt")),1),e("input",{type:"text",value:m.value.salt,name:"salt",onChange:C},null,40,Ta),e("span",Ea,a(n(t)("unit.g")),1)])],8,ya)])],512)])])}:void 0]),1032,["class"]))}};const Fa=["disabled"],Da=["value"],za={class:"unit"},Aa=["value"],Ra={props:["items","disabled"],setup(s,{expose:t}){const i=s,{t:d,locale:l}=J(),o=k("name"),c=k(null),u=new Intl.Collator(l.value,{numeric:!0}),w=X(()=>i.items.map(x=>({id:x.id,amount:x.amount,name:d(x.id.toString())})).sort((x,T)=>u.compare(x[o.value],T[o.value])));function m(v){v.target.blur();let x=parseFloat(v.target.value);(isNaN(x)||x<0)&&(v.target.value=0)}function y(){let v=new FormData(c.value),x=v.getAll("id"),T=v.getAll("amount"),L=[];return i.items.forEach(r=>{let _=parseInt(x.indexOf(r.id.toString())),I=parseFloat(T[_]);I!=r.amount&&L.push({id:r.id,amount:I})}),L}return t({getDiff:y}),(v,x)=>(f(),$("form",{class:"ingredients",ref_key:"form",ref:c},[e("fieldset",{disabled:s.disabled},[(f(!0),$(G,null,te(n(w),T=>(f(),$("div",{key:T.id},[e("label",null,a(T.name),1),e("input",{type:"number",name:"amount",value:T.amount,onChange:m},null,40,Da),e("span",za,a(n(d)("unit.g")),1),e("input",{type:"hidden",name:"id",value:T.id},null,8,Aa)]))),128))],8,Fa)],512))}},Oa={},Pa={width:"24",height:"24",version:"1.1",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Na=e("path",{d:"m0 18.316h2.5263v0.63158h-1.2632v1.2632h1.2632v0.63158h-2.5263v1.2632h3.7895v-5.0526h-3.7895zm1.2632-11.368h1.2632v-5.0526h-2.5263v1.2632h1.2632zm-1.2632 3.7895h2.2737l-2.2737 2.6526v1.1368h3.7895v-1.2632h-2.2737l2.2737-2.6526v-1.1368h-3.7895zm6.3158-7.5789v2.5263h17.684v-2.5263zm0 17.684h17.684v-2.5263h-17.684zm0-7.5789h17.684v-2.5263h-17.684z"},null,-1),Va=[Na];function ja(s,t){return f(),$("svg",Pa,Va)}var Ba=Q(Oa,[["render",ja]]);const Ua={class:"new-item"},Ha=e("hr",null,null,-1),Xa=["disabled"],qa=["value"],Wa=["innerHTML"],Ka={class:"tags"},Ya=e("span",{class:"tag no-edit-mode"},"Tag 1",-1),Ga=e("span",{class:"tag no-edit-mode"},"Tag 2",-1),Ja=e("span",{class:"tag no-edit-mode"},"Tag 3",-1),Qa=["disabled"],Za=e("hr",null,null,-1),el={key:0,class:"tracking no-edit-mode"},tl={class:"tracking-amount"},nl={class:"unit"},al=e("label",null,"Add to diary",-1),ll=e("hr",null,null,-1),ol=["innerHTML"],sl=e("hr",null,null,-1),il={class:"no-edit-mode"},ul={class:"nutrient-block"},rl={class:"col50"},cl={class:"unit"},dl={class:"unit"},ml={class:"col50"},vl={class:"unit"},hl={class:"unit"},fl=e("hr",null,null,-1),_l={class:"prep"},pl=["disabled"],gl={class:"prep-size"},bl=["value"],yl=["disabled"],$l=["value"],kl={class:"unit"},wl=["value"],xl={class:"unit"},Cl=["value"],Ll={class:"unit"},Il=["value"],Sl={class:"unit"},Tl={class:"placeholder"},El={setup(s){const{t}=J(),i=U("log"),d=U("csrfToken");U("perms");const l=U("recipes"),o=U("diary"),c=k([]),u=k(null),w=k(!1),m=k(!1),y=k(!1),v=k(1),x=k("&nbsp;"),T=k(V.now().toISODate()),L=k(V.now().toLocaleString(V.TIME_24_SIMPLE)),r=k(null),_=k(null),I=k(null);function S(M,D=2){return+parseFloat(M/(u.value.size||1)).toFixed(D)}function E(M){return Math.min.apply(Math,l.value.map(D=>Math.floor(D[M]/D.size)))}function A(M){return Math.max.apply(Math,l.value.map(D=>Math.ceil(D[M]/D.size)))}function F(M){fetch("/api/v1/recipe",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":d},body:new URLSearchParams({name:M})}).then(D=>{if(!D.ok)throw t("createrec.err"+D.status);return D.json()}).then(D=>{D.isowner=!0,l.value.push(D),c.value.push(D),i.msg(t("createrec.ok")),B(D.id)}).catch(D=>i.err(D))}function z(){m.value=!0;let M=u.value.id,D=u.value.owner,H=u.value.isowner;fetch("/api/v1/recipe/"+M,{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":d},body:new URLSearchParams(new FormData(_.value))}).then(R=>{if(!R.ok)throw t("saverec.err"+R.status);return j(M)}).then(()=>fetch("/api/v1/recipe/"+M)).then(R=>R.json()).then(R=>{R.owner=D,R.isowner=H,l.value=l.value.map(ne=>R.id==ne.id?R:ne),c.value=c.value.map(ne=>R.id==ne.id?R:ne),u.value=u.value.id==R.id?R:u.value,i.msg(t("saverec.ok"))}).catch(R=>i.err(R)).finally(()=>{setTimeout(function(){m.value=!1},500)})}function j(M){let D=I.value.getDiff();return D.length==0?new Promise(H=>{w.value=!1,H()}):new Promise((H,R)=>{let ne=0,$e;D.forEach(Le=>{fetch(`/api/v1/recipe/${M}/ingredient/${Le.id}`,{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":d},body:new URLSearchParams({amount:Le.amount})}).then(_e=>{if(++ne,!_e.ok)throw t("saverec.err"+_e.status)}).catch(_e=>$e=_e).finally(()=>{ne==D.length&&($e?R($e):(w.value=!1,H()))})})})}function W(M,D){y.value=!0;let H=new URLSearchParams;u.value.items.forEach(R=>{H.append("id",R.id),H.append("amount",S(R.amount)*v.value),H.append("time",D),H.append("recipe",u.value.name)}),fetch(`/api/v1/diary/${M}`,{method:"POST",body:H,headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":d}}).then(R=>{if(!R.ok)throw t("savediary.err"+R.status);return fetch("/api/v1/diary/"+M.replaceAll("-","/"))}).then(R=>R.json()).then(R=>{o.value[M]=R[0],v.value=1,i.msg(t("savediary.ok"))}).catch(R=>i.err(R)).finally(()=>{setTimeout(function(){y.value=!1},500)})}function B(M){u.value=c.value.filter(D=>D.id==M)[0],T.value=V.now().toISODate(),L.value=V.now().toLocaleString(V.TIME_24_SIMPLE),v.value=1,r.value.showDetails(),"isowner"in u.value?p():C()}function C(){fetch(`/api/v1/recipe/${u.value.id}/owner`).then(M=>{if(!M.ok)throw M;return M.json()}).then(M=>{u.value.isowner=M.isowner,u.value.owner=M.owner,p()}).catch(()=>{i.err(t("recowner.err")),x.value="&nbsp;"})}function p(){u.value.isowner?x.value=t("recipe.isowner"):u.value.owner?x.value=t("recipe.owner",{name:u.value.owner}):x.value=t("recipe.ispublic")}function h(M){c.value=M,u.value&&c.value.filter(D=>D.id==u.value.id).length==0&&(u.value=null)}function g(){w.value?z():w.value=!0}function Z(M){M.target.blur(),isNaN(parseFloat(M.target.value))&&(M.target.value=u.value[M.target.name])}return he(()=>c.value=[...l.value]),(M,D)=>(f(),K(ce,{ref_key:"main",ref:r,onDetailVisibility:D[1]||(D[1]=H=>w.value=!1),class:O({"edit-mode":w.value})},Ee({filter:N(()=>[e("section",Ua,[e("h2",null,a(n(t)("aria.headnewrec")),1),b(De,{label:n(t)("btn.new"),placeholder:n(t)("recipe.hintnew"),onConfirm:F},null,8,["label","placeholder"])]),Ha,e("section",null,[e("h2",null,a(n(t)("aria.headsearch")),1),b(Fe,{data:n(l),placeholder:n(t)("recipe.hintsearch"),onResult:h},{default:N(H=>[e("fieldset",null,[b(Y,{label:n(t)("food.energy"),min:E("kcal"),max:A("kcal"),onInput:H.confirm,name:"kcal",unit:"cal",frac:"0"},null,8,["label","min","max","onInput"]),b(Y,{label:n(t)("food.fat"),min:E("fat"),max:A("fat"),onInput:H.confirm,name:"fat",unit:"g",frac:"0"},null,8,["label","min","max","onInput"]),b(Y,{label:n(t)("food.carbs"),min:E("carb"),max:A("carb"),onInput:H.confirm,name:"carb",unit:"g",frac:"0"},null,8,["label","min","max","onInput"]),b(Y,{label:n(t)("food.protein"),min:E("prot"),max:A("prot"),onInput:H.confirm,name:"prot",unit:"g",frac:"0"},null,8,["label","min","max","onInput"])])]),_:1},8,["data","placeholder"])])]),main:N(()=>[b(Ae,{items:c.value,onSelected:B},null,8,["items"])]),_:2},[u.value?{name:"head-details",fn:N(()=>[e("form",{ref_key:"form",ref:_,autocomplete:"off",id:"form-recipe"},[e("fieldset",{disabled:!w.value},[e("input",{type:"text",name:"name",value:u.value.name},null,8,qa)],8,Xa)],512)])}:void 0,u.value?{name:"details",fn:N(()=>[e("section",{class:"subtitle no-edit-mode",innerHTML:x.value},null,8,Wa),e("section",Ka,[Ya,Ga,Ja,u.value.isowner?(f(),$("button",{key:0,class:"icon async",disabled:m.value,onClick:g},[w.value?q("",!0):(f(),K(Ce,{key:0})),w.value?(f(),K(ye,{key:1})):q("",!0)],8,Qa)):q("",!0)]),Za,u.value.items.length?(f(),$("section",el,[e("h2",null,a(n(t)("aria.headtrack")),1),e("fieldset",tl,[e("div",null,[e("label",null,a(n(t)("food.amount")),1),re(e("input",{type:"number","onUpdate:modelValue":D[0]||(D[0]=H=>v.value=H),name:"amount"},null,512),[[xe,v.value]]),e("span",nl,a(n(t)("recipe.size",v.value)),1)])]),e("fieldset",null,[al,b(ze,{label:n(t)("btn.add"),time:L.value,date:T.value,disabled:y.value,onConfirm:W},null,8,["label","time","date","disabled"])])])):q("",!0),ll,e("section",null,[e("h2",null,a(n(t)("aria.headingred")),1),u.value.items.length?q("",!0):(f(),$("p",{key:0,class:"msg-noitems",innerHTML:n(t)("recipe.noitems")},null,8,ol)),b(Ra,{ref_key:"ingredients",ref:I,items:u.value.items,disabled:!w.value},null,8,["items","disabled"])]),sl,e("section",il,[e("h2",null,a(n(t)("aria.headnutrients")),1),e("div",ul,[e("div",rl,[e("div",null,[e("label",null,a(n(t)("food.energy")),1),e("span",null,a(S(u.value.kcal,1)),1),e("span",cl,a(n(t)("unit.cal")),1)]),e("div",null,[e("label",null,a(n(t)("food.fat")),1),e("span",null,a(S(u.value.fat,1)),1),e("span",dl,a(n(t)("unit.g")),1)])]),e("div",ml,[e("div",null,[e("label",null,a(n(t)("food.carbs2")),1),e("span",null,a(S(u.value.carb,1)),1),e("span",vl,a(n(t)("unit.g")),1)]),e("div",null,[e("label",null,a(n(t)("food.protein")),1),e("span",null,a(S(u.value.prot,1)),1),e("span",hl,a(n(t)("unit.g")),1)])])])]),fl,e("section",_l,[e("h2",null,a(n(t)("aria.headprep")),1),e("div",null,[e("fieldset",{disabled:!w.value,class:"col50"},[e("div",gl,[e("label",null,a(n(t)("recipe.size",2)),1),e("input",{type:"text",name:"size",form:"form-recipe",value:u.value.size,onChange:Z},null,40,bl),e("label",null,a(n(t)("recipe.size",u.value.size)),1)])],8,pl),e("fieldset",{disabled:!w.value,class:"col50"},[e("div",null,[e("label",null,a(n(t)("recipe.time")),1),e("input",{type:"text",disabled:"",value:u.value.preptime+u.value.cooktime+u.value.misctime},null,8,$l),e("span",kl,a(n(t)("unit.min")),1)]),e("div",null,[e("label",null,a(n(t)("recipe.preptime")),1),e("input",{type:"text",name:"preptime",form:"form-recipe",value:u.value.preptime,onChange:Z},null,40,wl),e("span",xl,a(n(t)("unit.min")),1)]),e("div",null,[e("label",null,a(n(t)("recipe.cooktime")),1),e("input",{type:"text",name:"cooktime",form:"form-recipe",value:u.value.cooktime,onChange:Z},null,40,Cl),e("span",Ll,a(n(t)("unit.min")),1)]),e("div",null,[e("label",null,a(n(t)("recipe.misctime")),1),e("input",{type:"text",name:"misctime",form:"form-recipe",value:u.value.misctime,onChange:Z},null,40,Il),e("span",Sl,a(n(t)("unit.min")),1)])],8,yl)]),e("div",Tl,[b(Ba),e("p",null,a(n(t)("todo.instructions")),1)])])])}:void 0]),1032,["class"]))}};const Ml=["disabled"],Fl={value:"1"},Dl={value:"2"},zl={value:"3"},Al={value:"4"},Rl={value:"5"},Ol={value:"6"},Pl={value:"7"},Nl={value:"8"},Vl={value:"9"},jl={value:"10"},Bl={value:"11"},Ul={value:"12"},Hl=["value"],Xl=["disabled"],Re={props:["mode","items"],emits:["selection"],setup(s,{expose:t,emit:i}){const d=s,{t:l}=J(),o=k(V.now().month),c=k(V.now().year),u=k(null),w=X(()=>{let _=d.items.map(I=>parseInt(I.split("-")[0])).filter((I,S,E)=>E.indexOf(I)===S);return _.length==0&&(_=[V.now().year]),[Math.min(..._)-1,..._,Math.max(..._)+1]}),m=X(()=>c.value!=w.value[0]||o.value>1),y=X(()=>c.value!=w.value[w.value.length-1]||o.value<12);let v=[];ke(()=>d.items,()=>{u.value.querySelectorAll("td>button").forEach(_=>{d.items.indexOf(_.dataset.date)!=-1?_.parentNode.classList.add("has-entries"):_.parentNode.classList.remove("has-entries")})});function x(){let _=V.now().toISODate(),I=V.local(c.value,o.value);I=I.minus({days:I.weekday-1}),!v.length&&d.mode!="toggle"&&(v=[_]),u.value.querySelectorAll("td").forEach(S=>{let E=I.toISODate();S.firstElementChild.textContent=I.day,S.firstElementChild.dataset.date=E,I.month!=o.value?S.classList.add("outside"):S.classList.remove("outside"),E==_?S.classList.add("today"):S.classList.remove("today"),d.items.indexOf(E)!=-1?S.classList.add("has-entries"):S.classList.remove("has-entries"),v.indexOf(E)!=-1?S.classList.add("active"):S.classList.remove("active"),I=I.plus({days:1})})}function T(){--o.value<1&&(o.value=12,--c.value),x()}function L(){++o.value>12&&(o.value=1,++c.value),x()}function r(_){let I=_.target.dataset.date;if(d.mode=="toggle"){let S=v.indexOf(I);S==-1?v.push(I):v.splice(S,1)}else v=[I];u.value.querySelectorAll("td>button").forEach(S=>{v.indexOf(S.dataset.date)!=-1?S.parentNode.classList.add("active"):S.parentNode.classList.remove("active")}),i("selection",v)}return t({onDay:r}),he(()=>{x(),i("selection",v)}),(_,I)=>(f(),$("div",{class:O(["calendar",[s.mode]])},[e("div",null,[e("button",{class:"prev icon",onClick:T,disabled:!n(m)},[b(ge)],8,Ml),e("div",null,[re(e("select",{class:"month","onUpdate:modelValue":I[0]||(I[0]=S=>o.value=S),onChange:x},[e("option",Fl,a(n(l)("month.1")),1),e("option",Dl,a(n(l)("month.2")),1),e("option",zl,a(n(l)("month.3")),1),e("option",Al,a(n(l)("month.4")),1),e("option",Rl,a(n(l)("month.5")),1),e("option",Ol,a(n(l)("month.6")),1),e("option",Pl,a(n(l)("month.7")),1),e("option",Nl,a(n(l)("month.8")),1),e("option",Vl,a(n(l)("month.9")),1),e("option",jl,a(n(l)("month.10")),1),e("option",Bl,a(n(l)("month.11")),1),e("option",Ul,a(n(l)("month.12")),1)],544),[[we,o.value,void 0,{number:!0}]]),re(e("select",{class:"year","onUpdate:modelValue":I[1]||(I[1]=S=>c.value=S),onChange:x},[(f(!0),$(G,null,te(n(w),S=>(f(),$("option",{value:S},a(S),9,Hl))),256))],544),[[we,c.value,void 0,{number:!0}]])]),e("button",{class:"next icon",onClick:L,disabled:!n(y)},[b(ge)],8,Xl)]),e("table",{ref_key:"calendar",ref:u},[e("thead",null,[e("tr",null,[e("th",null,a(n(l)("day.cal1")),1),e("th",null,a(n(l)("day.cal2")),1),e("th",null,a(n(l)("day.cal3")),1),e("th",null,a(n(l)("day.cal4")),1),e("th",null,a(n(l)("day.cal5")),1),e("th",null,a(n(l)("day.cal6")),1),e("th",null,a(n(l)("day.cal7")),1)])]),e("tbody",null,[e("tr",null,[e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})])]),e("tr",null,[e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})])]),e("tr",null,[e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})])]),e("tr",null,[e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})])]),e("tr",null,[e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})])]),e("tr",null,[e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})]),e("td",null,[e("button",{onClick:r})])])])],512)],2))}};const ql={class:"unit"},Wl=["disabled"],Kl=["value"],Yl={class:"unit"},Gl=["value"],Jl=["value"],Ql=["value"],Zl=["value","disabled"],eo={class:"unit"},to=["value"],no=["value"],ao=["value"],lo={key:0},oo={key:1},so={props:["entries","nutrient","disabled"],setup(s,{expose:t}){const i=s,{t:d}=J(),l=U("food"),o=U("prefs"),c=k("hour"),u=k("relative"),w=k(null),m=X(()=>{switch(c.value){case"hour":return v();case"day":return x();default:return[]}}),y=X(()=>{if(u.value=="relative")return"%";switch(i.nutrient){case"kcal":return" "+d("unit.cal");case"fat":case"carb":case"prot":return" "+d("unit.g");default:return" "+d("unit.mg")}});function v(){let E=[];if(i.entries){let A={};i.entries.forEach(F=>{let z=parseInt(F.time),j=V.fromObject({hours:z-z%2}),W=j.toFormat("t")+" - "+j.plus({hours:2}).toFormat("t");W in A||(A[W]={name:W,entries:[]});let B={id:F.food.id,name:d(F.food.id.toString()),amount:F.food.amount,nutrient:T(F.food),recipe:F.recipe,time:F.time,isrec:!1};if(F.recipe){let C=!1;A[W].entries.every(p=>p.isrec&&p.name==F.recipe?(p.entries.push(B),p.amount+=B.amount,p.nutrient+=B.nutrient,C=!0,!1):!0),C||A[W].entries.push({name:F.recipe,isrec:!0,amount:B.amount,nutrient:B.nutrient,entries:[B]})}else A[W].entries.push(B)}),E=Object.values(A)}return E}function x(){return[{name:"Morning",entries:[{type:"recipe"},{type:"single"}]},{name:"Noon",entries:[{type:"recipe"},{type:"single"}]}]}function T(E){let F=l.value.filter(j=>j.id==E.id)[0][i.nutrient]*E.amount*.01;if(u.value=="metric")return Math.round(F);let z=o.value.rdi[i.nutrient];return Math.round(F*100/z)}function L(){u.value=="relative"?u.value="metric":u.value=="metric"&&(u.value="relative")}function r(E){E.target.closest("div").classList.toggle("open")}function _(E){E.key=="Enter"&&(E.preventDefault(),I(E))}function I(E){E.target.blur();let A=parseFloat(E.target.value);(isNaN(A)||A<0)&&(E.target.value=0)}function S(){let E=new FormData(w.value),A=E.getAll("id"),F=E.getAll("amount"),z=E.getAll("recipe"),j=E.getAll("time"),W=[];return i.entries.forEach(B=>{for(let C=0;C<A.length;++C)if(A[C]==B.food.id&&z[C]==B.recipe&&j[C]==B.time){F[C]!=B.food.amount&&W.push({id:A[C],amount:F[C],recipe:z[C],time:j[C]});break}}),W}return t({getDiff:S}),(E,A)=>(f(),$("form",{class:"diary-entry-list",ref_key:"form",ref:w},[(f(!0),$(G,null,te(n(m),F=>(f(),$("fieldset",{key:F.name},[e("legend",null,a(F.name),1),(f(!0),$(G,null,te(F.entries,z=>(f(),$("div",{class:O({recipe:z.isrec})},[z.isrec?(f(),$(G,{key:0},[e("label",null,a(z.name),1),e("button",{class:"icon",type:"button",onClick:r},[b(Me)]),e("span",null,a(z.amount),1),e("span",ql,a(n(d)("unit.g")),1),e("span",{class:O(["nutrient",[s.nutrient,u.value]])},a(z.nutrient)+a(n(y)),3),e("fieldset",{disabled:s.disabled,style:pe({"--max-height":z.entries.length*41+"px"})},[(f(!0),$(G,null,te(z.entries,j=>(f(),$("div",{key:j.id},[e("label",null,a(j.name),1),e("input",{type:"number",name:"amount",value:j.amount,onKeydown:_,onChange:I},null,40,Kl),e("span",Yl,a(n(d)("unit.g")),1),e("span",{class:O(["nutrient",[s.nutrient,u.value]])},a(j.nutrient)+a(n(y)),3),e("input",{type:"hidden",name:"id",value:j.id},null,8,Gl),e("input",{type:"hidden",name:"recipe",value:j.recipe},null,8,Jl),e("input",{type:"hidden",name:"time",value:j.time},null,8,Ql)]))),128))],12,Wl)],64)):(f(),$(G,{key:1},[e("label",null,a(z.name),1),e("input",{type:"number",name:"amount",value:z.amount,disabled:s.disabled,onKeydown:_,onChange:I},null,40,Zl),e("span",eo,a(n(d)("unit.g")),1),e("span",{class:O(["nutrient",[s.nutrient,u.value]])},a(z.nutrient)+a(n(y)),3),e("input",{type:"hidden",name:"id",value:z.id},null,8,to),e("input",{type:"hidden",name:"recipe",value:z.recipe},null,8,no),e("input",{type:"hidden",name:"time",value:z.time},null,8,ao)],64))],2))),256))]))),128)),e("button",{type:"button",class:"nutrient-mode-switch icon",onClick:L},[u.value=="relative"?(f(),$("span",lo,"%")):q("",!0),u.value=="metric"?(f(),$("span",oo,"g")):q("",!0)])],512))}};const io={class:"pie-chart"},uo={viewBox:"0 0 256 256"},ro=["transform","stroke-dasharray"],co=["stroke-dasharray","transform"],mo=["stroke-dasharray","transform"],vo=e("hr",null,null,-1),ve={props:["start","range","value","max","label","unit","frac"],setup(s){const t=s,i=112,d=X(()=>+(parseFloat(t.value)||0).toFixed(t.frac||0)),l=X(()=>+(parseFloat(t.max)||0).toFixed(t.frac||0)),o=X(()=>`rotate(${-90+(parseFloat(t.start)||0)} 128 128)`),c=X(()=>{let m=(parseFloat(t.range)||0)/360;return Math.PI*2*i*m+" 710"}),u=X(()=>{let m=(parseFloat(t.value)||0)/(parseFloat(t.max)||1),y=parseFloat(t.range)||0,v=Math.min(m,1)*y/360;return Math.PI*2*i*v+" 710"}),w=X(()=>{let m=(parseFloat(t.value)||0)/(parseFloat(t.max)||1),y=parseFloat(t.range)||0,v=Math.min(Math.max(0,m-1),1)*y/360;return Math.PI*2*i*v+" 710"});return(m,y)=>(f(),$("figure",io,[(f(),$("svg",uo,[e("circle",{class:"base",r:"112",cx:"128",cy:"128",transform:n(o),"stroke-dasharray":n(c)},null,8,ro),e("circle",{class:"good",r:"112",cx:"128",cy:"128","stroke-dasharray":n(u),transform:n(o)},null,8,co),e("circle",{class:"bad",r:"112",cx:"128",cy:"128","stroke-dasharray":n(w),transform:n(o)},null,8,mo)])),e("div",null,[ue(m.$slots,"details",{},()=>[e("span",null,a(n(d))+" "+a(s.unit),1),vo,e("span",null,a(n(l))+" "+a(s.unit),1)])]),e("figcaption",null,a(s.label),1)]))}};const ho=e("hr",null,null,-1),fo=e("section",null,null,-1),_o={id:"charts-week"},po=["data-date"],go={id:"charts-macro"},bo={class:"no-edit-mode"},yo={class:"subtitle no-edit-mode"},$o={class:"tabs"},ko=["disabled"],wo=e("hr",null,null,-1),xo={key:0},Co=["innerHTML"],Lo={setup(s){const{t}=J(),i=U("log"),d=U("csrfToken"),l=U("diary"),o=U("prefs"),c=k(null),u=k(V.now()),w=k("kcal"),m=k(!1),y=k(!1),v=k(null),x=k(null),T=k(null),L=X(()=>Object.keys(l.value)),r=X(()=>{let C=[],p=V.now().toISODate(),h=u.value.toISODate(),g=u.value.minus({days:u.value.weekday-1});for(let Z=0;Z<7;++Z){let M=g.toISODate();C.push({weekday:t("day.cal"+g.weekday),calday:g.day,date:M,active:M==h,today:M==p,value:l.value[M]?l.value[M].kcal:0}),g=g.plus({days:1})}return C});let _=!1;function I(C){C.stopPropagation(),C.preventDefault(),E(C.target.closest("ul"),C.movementX),_=!0}function S(C){C.stopPropagation(),C.preventDefault();let p=Math.max(-16,Math.min(-C.deltaY,16));E(C.target.closest("ul"),p)}function E(C,p){let h=parseInt(C.style.getPropertyValue("--offset"))||0,g=Math.max(C.clientWidth-C.scrollWidth,Math.min(h+p,0));C.style.setProperty("--offset",g+"px")}function A(C){let p=C.target.closest("ul");p.addEventListener("pointermove",I),p.addEventListener("mouseup",F),p.addEventListener("touchend",F),p.addEventListener("mouseleave",F),p.addEventListener("touchcancel",F),_=!1}function F(C){let p=C.target.closest("ul");p.removeEventListener("pointermove",I),p.removeEventListener("mouseup",F),p.removeEventListener("touchend",F),p.removeEventListener("mouseleave",F),p.removeEventListener("touchcancel",F)}function z(C){_||(w.value=C.target.dataset.name)}function j(){c.value&&c.value.entries&&(y.value?W():y.value=!0)}function W(){let C=x.value.getDiff();if(C.length==0){y.value=!1;return}m.value=!0;let p=c.value.date,h=new URLSearchParams;C.forEach(g=>{h.append("id",g.id),h.append("amount",g.amount),h.append("time",g.time),h.append("recipe",g.recipe)}),fetch(`/api/v1/diary/${p}`,{method:"PUT",body:h,headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":d}}).then(g=>{if(!g.ok)throw t("savediary.err"+g.status);return y.value=!1,fetch("/api/v1/diary/"+p.replaceAll("-","/"))}).then(g=>g.json()).then(g=>{g[0]&&g[0].kcal?l.value[p]=g[0]:delete l.value[p],B([p]),i.msg(t("savediary.ok"))}).catch(g=>i.err(g)).finally(()=>{setTimeout(function(){m.value=!1},500)})}function B(C){u.value=V.fromISO(C[0]);let p=u.value.toISODate();if(!l.value[p]){c.value={date:p};return}if(l.value[p].entries){c.value=l.value[p];return}fetch(`/api/v1/diary/${p.replaceAll("-","/")}/entries`).then(h=>h.json()).then(h=>{h.forEach(g=>g.time=g.date.split("T")[1].slice(0,5)),h.sort((g,Z)=>g.time<Z.time?-1:Z.time<g.time?1:0),l.value[p].entries=h}).catch(h=>i.err(h)).finally(()=>c.value=l.value[p])}return(C,p)=>(f(),K(ce,{ref_key:"main",ref:T,class:O(["diary",{"edit-mode":y.value}]),onDetailVisibility:p[1]||(p[1]=h=>y.value=!1)},{filter:N(()=>[e("section",null,[e("h2",null,a(n(t)("aria.headcal")),1),b(Re,{ref_key:"calendar",ref:v,items:n(L),onSelection:B},null,8,["items"])]),ho,fo]),main:N(()=>[e("section",_o,[(f(!0),$(G,null,te(n(r),h=>(f(),$("button",{"data-date":h.date,class:O({today:h.today,active:h.active}),onClick:p[0]||(p[0]=(...g)=>v.value.onDay&&v.value.onDay(...g))},[b(ve,{range:"360",value:h.value,max:n(o).rdi.kcal},{details:N(()=>[e("span",null,a(h.weekday),1),e("span",null,a(h.calday),1)]),_:2},1032,["value","max"])],10,po))),256))]),e("section",go,[b(ve,{class:"kcal",start:"225",range:"270",frac:"0",label:n(t)("food.energy"),unit:n(t)("unit.cal"),value:c.value?c.value.kcal:0,max:n(o).rdi.kcal},null,8,["label","unit","value","max"]),b(ve,{class:"fat",start:"225",range:"270",frac:"0",label:n(t)("food.fat"),unit:n(t)("unit.g"),value:c.value?c.value.fat:0,max:n(o).rdi.fat},null,8,["label","unit","value","max"]),b(ve,{class:"carb",start:"225",range:"270",frac:"0",label:n(t)("food.carbs2"),unit:n(t)("unit.g"),value:c.value?c.value.carb:0,max:n(o).rdi.carb},null,8,["label","unit","value","max"]),b(ve,{class:"prot",start:"225",range:"270",frac:"0",label:n(t)("food.protein"),unit:n(t)("unit.g"),value:c.value?c.value.prot:0,max:n(o).rdi.prot},null,8,["label","unit","value","max"])])]),"head-details":N(()=>[e("h2",bo,a(u.value.weekdayLong),1)]),details:N(()=>[e("section",yo,a(u.value.toLocaleString(n(V).DATE_FULL)),1),e("section",$o,[e("div",null,[e("ul",{onMousedown:A,onTouchstart:A,onWheel:S},[e("li",{class:O({active:w.value=="kcal"})},[e("button",{"data-name":"kcal",onClick:z},a(n(t)("food.energy")),1)],2),e("li",{class:O({active:w.value=="fat"})},[e("button",{"data-name":"fat",onClick:z},a(n(t)("food.fat")),1)],2),e("li",{class:O({active:w.value=="carb"})},[e("button",{"data-name":"carb",onClick:z},a(n(t)("food.carbs2")),1)],2),e("li",{class:O({active:w.value=="prot"})},[e("button",{"data-name":"prot",onClick:z},a(n(t)("food.protein")),1)],2)],32)]),e("button",{class:"icon async",disabled:m.value,onClick:j},[y.value?q("",!0):(f(),K(Ce,{key:0})),y.value?(f(),K(ye,{key:1})):q("",!0)],8,ko)]),wo,c.value?(f(),$("section",xo,[e("h2",null,a(n(t)("aria.headlog")),1),c.value.entries?q("",!0):(f(),$("p",{key:0,class:"msg-noitems",innerHTML:n(t)("diary.noitems")},null,8,Co)),c.value.entries?(f(),K(so,{key:1,ref_key:"entries",ref:x,entries:c.value.entries,nutrient:w.value,disabled:!y.value},null,8,["entries","nutrient","disabled"])):q("",!0)])):q("",!0)]),_:1},8,["class"]))}};const Io=["checked"],So=e("div",null,null,-1),Ie={props:["checked"],emits:["change","click"],setup(s,{emit:t}){function i(l){t("change",l)}function d(l){t("click",l)}return(l,o)=>(f(),$("label",null,[e("input",{type:"checkbox",checked:s.checked,onChange:i,onClick:d},null,40,Io),So]))}},To={class:"select"},Eo={class:"select"},Mo=["innerHTML"],Fo=["onClick"],Do={class:"s"},zo={props:["items"],emits:"selected",setup(s,{emit:t}){const i=s,{t:d,locale:l}=J(),o=k("amount"),c=k("desc"),u=new Intl.Collator(l.value,{numeric:!0}),w=X(()=>c.value=="asc"?[...i.items].sort((L,r)=>u.compare(L[o.value],r[o.value])):[...i.items].sort((L,r)=>-u.compare(L[o.value],r[o.value]))),m=X(()=>i.items.length&&i.items.length==i.items.filter(L=>L.done).length);function y(L){if(L.amount>999)var r=+parseFloat(L.amount*.001).toFixed(1),_=d("unit.kg");else var r=L.amount,_=d("unit.g");return`${r} <span class="unit">${_}</span>`}function v(L){let r=L.target.dataset.sort;o.value==r?c.value=c.value=="asc"?"desc":"asc":o.value=r}function x(L){let r=L.target.checked;i.items.forEach(_=>_.done=r)}function T(L){let r=L.target.closest("label").dataset.id,_=L.target.checked;i.items.filter(I=>I.id==r)[0].done=_}return(L,r)=>(f(),$("table",null,[e("thead",null,[e("tr",{class:O(c.value)},[e("th",To,[b(Ie,{checked:n(m),onClick:x},null,8,["checked"])]),e("th",{class:O(["num sort",{active:o.value=="amount"}]),onClick:v,"data-sort":"amount"},[b(ae),P(" "+a(n(d)("food.amount")),1)],2),e("th",{class:O(["name sort",{active:o.value=="name"}]),onClick:v,"data-sort":"name"},[P(a(n(d)("food.name"))+" ",1),b(ae)],2),e("th",{class:O(["s sort",{active:o.value=="aisle"}]),onClick:v,"data-sort":"aisle"},[b(ae),P(" "+a(n(d)("food.aisle")),1)],2)],2)]),e("tbody",null,[(f(!0),$(G,null,te(n(w),_=>(f(),$("tr",{key:_.id,class:O({done:_.done})},[e("td",Eo,[b(Ie,{"data-id":_.id,checked:_.done,onChange:T},null,8,["data-id","checked"])]),e("td",{class:"num",innerHTML:y(_)},null,8,Mo),e("td",{class:"name",onClick:I=>L.$emit("selected",_.id)},a(_.name),9,Fo),e("td",Do,a(n(d)("aisle."+_.aisle)),1)],2))),128))])]))}},Ao=e("hr",null,null,-1),Ro=e("section",null,null,-1),Oo={setup(s){const{t}=J(),i=U("log"),d=U("diary"),l=k([]),o=k(null),c=X(()=>Object.keys(d.value));function u(m){if(m.length==0){l.value=[];return}let y=new URLSearchParams(m.map(v=>["date",v]));fetch("/api/v1/list/diary?"+y).then(v=>{if(!v.ok)throw t("getlist.err"+v.status);return v.json()}).then(v=>{v.forEach(x=>x.name=t(x.id.toString())),l.value=v}).catch(v=>i.err(v))}function w(m){o.value.showDetails()}return(m,y)=>(f(),K(ce,{ref_key:"main",ref:o},{filter:N(()=>[e("section",null,[e("h2",null,a(n(t)("aria.headcal")),1),b(Re,{mode:"toggle",items:n(c),onSelection:u},null,8,["items"])]),Ao,Ro]),main:N(()=>[b(zo,{items:l.value,onSelected:w},null,8,["items"])]),_:1},512))}},Po=P(" Profile "),No={setup(s){return(t,i)=>(f(),K(ce,null,{main:N(()=>[Po]),_:1}))}},Vo=P(" Settings "),jo={setup(s){return(t,i)=>(f(),K(ce,null,{main:N(()=>[Vo]),_:1}))}},Bo=Pe({history:Ne(),routes:[{path:"/",name:"diary",component:Lo},{path:"/recipes",name:"recipes",component:El},{path:"/food",name:"food",component:Ma},{path:"/shopping",name:"shopping",component:Oo},{path:"/profile",name:"profile",component:No},{path:"/settings",name:"settings",component:jo}]});let be=document.documentElement.lang||navigator.language;!be&&navigator.languages!=null&&(be=navigator.languages[0]);Ve.defaultLocale=be;const Se=document.querySelector("meta[name='_csrf']"),Uo=Se?Se.content:"",Ho=function(){const s=document.documentElement.dataset.perm||1,t=65536,i=131072;function d(l){return(s&l)==l}return{canCreateFood:d(t),canEditFood:d(i)}}(),Xo=function(){function s(t){return typeof t=="string"?t:"message"in t?t.message:le.global.t("err.err")}return{msg:function(t){let i={msg:s(t),timeout:3e3};window.dispatchEvent(new CustomEvent("message",{detail:i}))},warn:function(t){let i={msg:s(t),timeout:4e3};window.dispatchEvent(new CustomEvent("warning",{detail:i}))},err:function(t){let i={msg:s(t),timeout:5e3};window.dispatchEvent(new CustomEvent("error",{detail:i}))}}}(),ee=je(It);let le,oe,de,se,me;function qo(s){le=Be({legacy:!1,locale:be.split("-")[0],fallbackLocale:"en",messages:s}),oe&&de&&se&&me&&fe()}function Wo(s){oe=s,le&&de&&se&&me&&fe()}function Ko(s){de=s,le&&oe&&se&&me&&fe()}function Yo(s){se={},s.forEach(t=>se[t.date]=t),le&&oe&&de&&me&&fe()}function Te(s){me=s,le&&oe&&de&&se&&fe()}function fe(){oe.forEach(s=>{s.name=le.global.t(s.id.toString())}),ee.provide("csrfToken",Uo),ee.provide("perms",Ho),ee.provide("food",k(oe)),ee.provide("recipes",k(de)),ee.provide("diary",k(se)),ee.provide("prefs",k(me)),ee.provide("log",Xo),ee.use(Bo),ee.use(le),ee.mount("#app")}fetch("/app/l10n.json").then(s=>s.json()).then(qo);fetch("/api/v1/foods").then(s=>s.json()).then(Wo);fetch("/api/v1/recipes").then(s=>s.json()).then(Ko);fetch("/api/v1/diary").then(s=>s.json()).then(Yo);fetch("/api/v1/prefs").then(s=>s.json()).then(Te).catch(()=>{Te({rdi:{kcal:2e3,fat:60,carb:270,prot:80}})});
